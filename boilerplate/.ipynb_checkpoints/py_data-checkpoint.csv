Commit ID,Commit Message,Author Name,Author Email,Date of Commit,Files Changed,All Checks Passed
d4d0469b476f567839640fb49c7dbe3a288bc561,"Ensures Prefetcher shuts down properly (#1166)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1166

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D45967152

Pulled By: NivekT

fbshipit-source-id: b957804cf3e34e443bbc8b9bc301de39cb6ea722",Kevin Tse,ktse@fb.com,2023-05-24 14:07:58,"['test/test_distributed.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
ba3174519d1a7f050c4e47492c20114f5d1404a5,"Prevent `in_memory_cache` from yielding from `source_dp` when it's fully cached (#1160)

Summary:
Fixes https://github.com/pytorch/data/issues/1159.

Pull Request resolved: https://github.com/pytorch/data/pull/1160

Reviewed By: NivekT

Differential Revision: D45883150

Pulled By: ejguan

fbshipit-source-id: 8aa15294bf32559334817a1b8ec8b88b2807fd5a",hirayaku,hth.harold@gmail.com,2023-05-16 14:09:17,['torchdata/datapipes/iter/util/cacheholder.py'],True
0b39117b8a40a4070e2315e3728713afba1f3ac0,"Fix FullSync shutdown hanging issue while paused (#1153)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1153

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D45610885

Pulled By: NivekT

fbshipit-source-id: c7e5d6675664ec44ea5d73f7464a1f43ad1d9282",Kevin Tse,ktse@fb.com,2023-05-15 15:50:04,"['test/test_distributed.py', 'torchdata/datapipes/iter/util/distributed.py']",False
65e2edea3db1e025bfcf80196f75149a48971c1d,"Fix pin_memory to support single-element batch (#1158)

Summary:
Fixes https://github.com/pytorch/data/issues/1157

Pull Request resolved: https://github.com/pytorch/data/pull/1158

Reviewed By: NivekT

Differential Revision: D45815548

Pulled By: ejguan

fbshipit-source-id: 317e279e831f5995bedc3cdd3e01be2b08b70dc1",erjia,erjia@fb.com,2023-05-12 20:21:47,"['test/test_iterdatapipe.py', 'torchdata/datapipes/utils/pin_memory.py']",False
e9d5bd153eab23c46cbd3f28d771bd9e703d2453,"Fix a word in WebDS DataPipe (#1156)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1156

Fixes #1144

Note that the description is already correct in the [docstring of the DataPipe](https://github.com/pytorch/data/blob/483274f17a3244d14de886652ce8b35512fb7763/torchdata/datapipes/iter/util/webdataset.py#L52). This merely fixes the docstring of the helper function.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D45754064

Pulled By: NivekT

fbshipit-source-id: 98ed63066a250c51ff788bc1193b4f8e45aa319e",Kevin Tse,ktse@fb.com,2023-05-11 18:54:23,['torchdata/datapipes/iter/util/webdataset.py'],False
fec1e5850a3a46d1db8f2c44be23b1255b27dd3a,"Add `handler` argument to iopath DataPipes (#1154)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1154

A lot of use cases currently looks like:
```python
dp = IoPathFileOpener(dp, mode=""rb"")
dp.register_handler(handler)
```

This allows users to `register_handler` within `__init__`:
```python
dp = IoPathFileOpener(dp, mode=""rb"", handler=handler)
```

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D45667135

Pulled By: NivekT

fbshipit-source-id: 25b9ab38ecce584b766371619a0e32dccf3ef4d5",Kevin Tse,ktse@fb.com,2023-05-09 17:52:49,['torchdata/datapipes/iter/load/iopath.py'],False
bda2c18808ffce0bccc7a3b104982204a2db5fca,"Back out ""Enable miniepoch for MultiProcessingReadingService""

Summary:
Original commit changeset: a0591873c792

Original Phabricator Diff: D45289736

Reviewed By: NivekT

Differential Revision: D45658597

fbshipit-source-id: 32a191172eefafbce1e1f064a4dbab9be2ccde7e",Erjia Guan,erjia@meta.com,2023-05-08 17:00:29,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
11bb5b847ea8b9e0d9bb82db3304daf383008d3f,"Enable miniepoch for MultiProcessingReadingService (#1147)

Summary:
Add `pause`, `resume`, `limit` API to `MultiProcessingReadingService` to support miniepoch API.
- Adding a function as the input to make sure it working with internal ReadingService to control miniepoch within the worker/dispatching process

All tests should be passing in `test/dataloader2/test_mrps.py`

Pull Request resolved: https://github.com/pytorch/data/pull/1147

Reviewed By: NivekT

Differential Revision: D45289736

Pulled By: ejguan

fbshipit-source-id: a0591873c7928f903ac90deb1792d62ad2ca0abb",erjia@fb.com,erjia@fb.com,2023-05-04 13:35:39,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
33ec1596a7c2bb3c54eb43f79bf0084a44f898c0,"Reland: [DataLoader2] Removing delegation for 'pause', 'limit', and 'resume' (#1067)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1067

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43773101

Pulled By: NivekT

fbshipit-source-id: 2b454a87a70ecf378416a6d458ec3f810eb9e3fb",Kevin Tse,ktse@fb.com,2023-05-01 22:47:09,"['torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
3e7eaaeece366da60506ebcef964e52cdc29e60c,"Implement `pause`/`resume` for FullSync (#1130)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1130

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D45015591

Pulled By: NivekT

fbshipit-source-id: 6ff38037d18d35aec8bc0a33727fc78f6746256f",Kevin Tse,ktse@fb.com,2023-05-01 22:47:09,['torchdata/datapipes/iter/util/distributed.py'],True
85d54a5dc5397a7cdc7bbff5f1e490ddf2c02f12,"Handle `MapDataPipe` by converting to `IterDataPipe` internally by default (#1146)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1146

Fixes #1143

I believe since `DataLoader2` would always call `iter(map_data_pipe)` at some point anyway, it should make no different to perform the conversion with `to_iter_datapipe()` within `__init__`.

This will also allow prefetchers to be attached to the DataPipe.

Please let me know if this may be BC-breaking.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D45452068

Pulled By: NivekT

fbshipit-source-id: 608dc000735b16641e41e442553fe9283a1b8829",Kevin Tse,ktse@fb.com,2023-05-01 22:40:04,['torchdata/dataloader2/dataloader2.py'],False
bddf38432ac5154cd50c4bbcc810fb5b51c50ab8,"M1 Builds on Nova GHA (#1128)

Summary:
As part of the move to Nova, this PR adds Wheels/Conda builds for M1 Macs for torchdata. It includes smoke-test support and the logic for uploading nightlies/release builds in the reusable workflows. If these builds run smoothly over the next 1-2 weeks, we can start deprecating the old release workflows. Until then, these Nova workflows do not upload any binaries to anaconda/pypi indices - they just run the build and verify with smoke tests. Would love any feedback from the data team about missing functionality/concerns/etc. regarding this move.

Pull Request resolved: https://github.com/pytorch/data/pull/1128

Reviewed By: NivekT

Differential Revision: D45162566

Pulled By: osalpekar

fbshipit-source-id: 807b658a935fdfe30477faed010d151e9d8757e4",Omkar Salpekar,osalpekar@fb.com,2023-04-21 19:04:50,"['.github/workflows/build-conda-m1.yml', '.github/workflows/build-wheels-m1.yml', 'packaging/env-var-script.txt']",False
036d51f376db37076607f7bf496fcdf24a5d5546,"Remove temporary channel for python 3.11 (#1135)

Summary:
Remove temporary channel for python 3.11

Pull Request resolved: https://github.com/pytorch/data/pull/1135

Reviewed By: NivekT

Differential Revision: D45127216

Pulled By: ejguan

fbshipit-source-id: 5ff8463122cf9176eaaff1394fc416c48d63f9a4",erjia,erjia@fb.com,2023-04-19 21:39:19,['packaging/build_conda.sh'],False
20935038ccc58240fbd0b29a7ef2a6002bb2906a,"Skip FullSync operation when world_size == 1 (#1065)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1065

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43751382

Pulled By: NivekT

fbshipit-source-id: cd85e6dc360494289b82facb0cee34502a178c27",Kevin Tse,ktse@fb.com,2023-04-19 20:38:12,"['test/test_distributed.py', 'torchdata/datapipes/iter/util/distributed.py']",False
d13a7e1b08d90badd18e5f15be64267e1b3a3dc8,"Add __len__ implementation for BatchAsyncMapper (#1121)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1121

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D44717404

Pulled By: NivekT

fbshipit-source-id: c0e6691f87e975e2c88fad0f66d1cdc5e639d1ca",Kevin Tse,ktse@fb.com,2023-04-18 22:59:13,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/callable.py']",False
f2bfd3db8a70ea3ae1bef55188b4bd478436a7aa,"Make flatten operation optional in BatchAsyncMapper (#1127)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1127

Test Plan: Imported from OSS

Reviewed By: bearzx

Differential Revision: D44937179

Pulled By: NivekT

fbshipit-source-id: bd1f79883b794f59180fd0cdea76cea0bd2f561c",Kevin Tse,ktse@fb.com,2023-04-13 21:45:46,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/callable.py']",False
95e4f58702732533a736178fb5701929614109db,"Fix/add __len__ implementation of Prefetcher and WebDataset (#1120)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1120

Test Plan: Imported from OSS

Reviewed By: bearzx

Differential Revision: D44717406

Pulled By: NivekT

fbshipit-source-id: 3d1ed5e113936932a46af7a5ad9eddf90a7a8c16",Kevin Tse,ktse@fb.com,2023-04-10 22:17:12,"['test/test_huggingface_datasets.py', 'test/test_iterdatapipe.py', 'torchdata/datapipes/iter/util/prefetcher.py', 'torchdata/datapipes/iter/util/webdataset.py']",False
851e26a0297e22c73f133b40e462cc42f868c885,"Saving and restoring initial seed generator (#1124)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1124

Reland of #998 with added guard while loading randomness state in `DataLoader2` for backward compatibility

Changes to `DataLoader2`:
- Modifying `state_dict` to store `randomness_state`, which includes:
    - `_seed: int`
    - `_reset_seed: bool` - flag indicating whether `_seed` needs to be set
    - `_seed_generator` - the latest version at the time when `state_dict` is called
    - `_initial_seed_generator` - the versopm that is saved at the beginning of very epoch
- Modifying `from_state` and `load_state_dict` to restore `randomness_state`
- Adding a method `_restore_checkpoint_beginning_of_epoch`
    -  This sets `self._seed_generator = self._initial_seed_generator`, allowing users to re-create an epoch from the beginning.

 ---
### Considerations

Storing the randomness states provide more flexibility for users to restore as they see fit. The decision to do that should not be controversial.

I decided to make add a new method for checkpointing at the beginning of the epoch, ensure that users are not confused about what randomness is restored by default.

The basic idea is that we want to allow users to restore `dl2._seed_generator` to the previously saved version. From that point on, they can create a new `__iter__` and continue from the beginning of the epoch.
- Note that since `_seed` and `_reset_seed` are also saved, if the users were planning to use a different seed or if there was a need to re-seed, those remain valid after restoring the checkpoint.
- Finally, if users change their mind at any point (after restoring) and want to manual set `seed`. That `seed` will override any other behavior and the `seed` will be used.

Test Plan:
Imported from OSS

f425956975

Reviewed By: bearzx

Differential Revision: D44748514

Pulled By: NivekT

fbshipit-source-id: 8713592902b1e0680e46e4db4280c84c708dbf55",Kevin Tse,ktse@fb.com,2023-04-10 18:42:42,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/random/seed_generator.py', 'torchdata/dataloader2/reading_service.py']",True
0f2a039a0835ccf847195c49f1b98df64039d7cb,"Fix copyright header for make file (#1126)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1126

Test Plan: Imported from OSS

Reviewed By: kurman

Differential Revision: D44802524

Pulled By: NivekT

fbshipit-source-id: 6a350635bb6e3969eb4ecaf66e67fe0cdf930700",Kevin Tse,ktse@fb.com,2023-04-07 21:48:45,['docs/make.bat'],False
f6f5cb2cd8b0e50fb79678fe7e3904d7a66ce1c3,"Back out ""Saving and restoring initial seed generator""

Summary:
Original commit changeset: 0faa3d7aef23

Original Phabricator Diff: D44390519

Differential Revision: D44735942

fbshipit-source-id: ec680340550dc57aa805e49918275c40073d3014",John Lee,johnjlee@meta.com,2023-04-06 13:20:41,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/random/seed_generator.py', 'torchdata/dataloader2/reading_service.py']",False
837ede1e1a4faf282db755f0236a8ac322b107f0,"Migrate docstrings to doctests (#901)

Summary:
### Changes
Migrate docstrings to doctest
- torchdata/dataloader2/adapter.py
- torchdata/datapipes/iter/load/*

Use PEP8 style in code examples, e.g. add newlines between defs:
```
  from torchdata.datapipes.iter import IterableWrapper

  def filepath_fn(name: str) -> str:
      return dir_path + name

  name_to_data = {""1.txt"": b""DATA1"", ""2.txt"": b""DATA2"", ""3.txt"": b""DATA3""}
  source_dp = IterableWrapper(sorted(name_to_data.items()))
  fsspec_saver_dp = source_dp.save_by_fsspec(filepath_fn=filepath_fn, mode=""wb"")
  res_file_paths = list(fsspec_saver_dp)`
```

Pull Request resolved: https://github.com/pytorch/data/pull/901

Reviewed By: bdhirsh

Differential Revision: D44518888

Pulled By: NivekT

fbshipit-source-id: 787a91c4b83a73140c83c198e5c24c82407a5fdb",Mathias Burger,mathias.burger@tngtech.com,2023-03-31 18:04:09,"['torchdata/dataloader2/adapter.py', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/load/s3io.py', 'torchdata/datapipes/iter/util/combining.py']",False
4ba17dd76d92e8bef993a14bb93cfa945ea8d7f5,"Saving and restoring initial seed generator (#998)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/998

Changes to `DataLoader2`:
- Modifying `state_dict` to store `randomness_state`, which includes:
    - `_seed: int`
    - `_reset_seed: bool` - flag indicating whether `_seed` needs to be set
    - `_seed_generator` - the latest version at the time when `state_dict` is called
    - `_initial_seed_generator` - the versopm that is saved at the beginning of very epoch
- Modifying `from_state` and `load_state_dict` to restore `randomness_state`
- Adding a method `_restore_checkpoint_beginning_of_epoch`
    -  This sets `self._seed_generator = self._initial_seed_generator`, allowing users to re-create an epoch from the beginning.

 ---
### Considerations

Storing the randomness states provide more flexibility for users to restore as they see fit. The decision to do that should not be controversial.

I decided to make add a new method for checkpointing at the beginning of the epoch, ensure that users are not confused about what randomness is restored by default.

The basic idea is that we want to allow users to restore `dl2._seed_generator` to the previously saved version. From that point on, they can create a new `__iter__` and continue from the beginning of the epoch.
- Note that since `_seed` and `_reset_seed` are also saved, if the users were planning to use a different seed or if there was a need to re-seed, those remain valid after restoring the checkpoint.
- Finally, if users change their mind at any point (after restoring) and want to manual set `seed`. That `seed` will override any other behavior and the `seed` will be used.

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D44390519

Pulled By: NivekT

fbshipit-source-id: 0faa3d7aef23463e86765571018f83384bcb31e1",Kevin Tse,ktse@fb.com,2023-03-28 03:00:54,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/random/seed_generator.py', 'torchdata/dataloader2/reading_service.py']",False
aeda9877a560b201d2035cc827430d1845129feb,"Prevent overwrite (#1076)

Summary:
Fixes https://github.com/pytorch/data/issues/886

### Changes
Add `final` decorators to reset and resume methods in datapipies. Mypy gives a soft hint when overriding these methods.

CLA is in progress.

In collaboration with thomasdick

Pull Request resolved: https://github.com/pytorch/data/pull/1076

Reviewed By: ejguan

Differential Revision: D44109506

Pulled By: NivekT

fbshipit-source-id: f215a6e473a44c527dc53c9ee6a026b7126b9825",Carlos Schmidt Muniz,carlos.schmidtmuniz@tngtech.com,2023-03-27 21:29:27,"['torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/distributed.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/prefetcher.py', 'torchdata/datapipes/iter/util/randomsplitter.py']",True
e78ab6c9ec94f05f0a350ced7fe571f6863c20ec,"Fix `worker_init_fn` to update DataPipe graph and move worker prefetch to the end of Worker pipeline (#1100)

Summary:
Fixes https://github.com/pytorch/data/issues/1083

### Changes

- Fix worker loop to update the DataPipe graph with `worker_init_fn`
  - Add corresponding Tests
- Since `worker_init_fn` function might attach new DataPipe to worker graph, guarantee `prefetch` in worker attached to the end of the pipeline in worker process

Pull Request resolved: https://github.com/pytorch/data/pull/1100

Reviewed By: NivekT

Differential Revision: D44221216

Pulled By: ejguan

fbshipit-source-id: dfcbaa3e8a0d82df6dd21d308cc94f6d06bcf8f4",erjia,erjia@fb.com,2023-03-21 02:04:43,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py']",False
fd51f952a7a8bc950057e6b6d9d597c9c1aa6ce5,"Fix DataLoader2 seed = 0 bug and clean up unused codes (#1098)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1098

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D44184683

Pulled By: NivekT

fbshipit-source-id: d8f5391f5aeb68ebb066133d0f04541ee5bfe89c",Kevin Tse,ktse@fb.com,2023-03-20 18:10:55,"['torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
f2f7dae5549ccfce472d1fc85bbcb961e96e732e,"HuggingFaceHubReader better align with default values of datasets.load_dataset() (#1074)

Summary:
### Changes

- Change default value of HuggingFaceHubReader parameters
- Remove legacy `source_datapipe` attribute

A quick search on Github reveals no usage of this dp outside torchdata.

Pull Request resolved: https://github.com/pytorch/data/pull/1074

Reviewed By: ejguan

Differential Revision: D44116245

Pulled By: NivekT

fbshipit-source-id: f35f97a154e0d1c4bb2ac1964d75ab3270eb09b6",SvenDS9,sven.braun@tngtech.com,2023-03-20 18:10:34,"['test/test_huggingface_datasets.py', 'torchdata/datapipes/iter/load/huggingface.py']",True
f3fdf144ae2442da55275fd00ee2417c9f04d986,"Fix typo for portalocker (#1099)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/1099

Reviewed By: NivekT

Differential Revision: D44217648

Pulled By: ejguan

fbshipit-source-id: 7403f880484bc24cb1538fb21ad6cd18ab785826",erjia,erjia@fb.com,2023-03-20 17:46:50,['torchdata/datapipes/iter/util/cacheholder.py'],False
4e8573f8131e7575adea58b6867a6f299beb3ab0,"Add long description to setup.py (#1094)

Summary:
Fixes https://github.com/pytorch/data/issues/1088

### Changes

- Added the README.md as a long description in the `setup.py`
- Added `long_description_content_type` field

Co-Authored by:
Martin Achtner <martin.achtner@tngtech.com>
Jad Saliba <jad.saliba@tngtech.com>

Pull Request resolved: https://github.com/pytorch/data/pull/1094

Reviewed By: NivekT

Differential Revision: D44166989

Pulled By: ejguan

fbshipit-source-id: 24fafc170a825372356aba8c3f086a360902b6c9",Moritz Huebner,moritz.huebner@tngtech.com,2023-03-20 17:06:53,['setup.py'],False
0061177c2e45da97934e3963ab671a9515f28418,"Shuffled flatmap (#1062)

Summary:
Closes https://github.com/pytorch/data/issues/1043

### Changes

- Adds new datapipe `ShuffledFlatMapper`/`shuffled_flatmap`

Pull Request resolved: https://github.com/pytorch/data/pull/1062

Reviewed By: NivekT

Differential Revision: D44176076

Pulled By: ejguan

fbshipit-source-id: a75f88fa3d28591d59f758d5affd6b1909841564",PierreGtch,pierre.guetschel@gmail.com,2023-03-18 01:21:52,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/callable.py']",False
8a9b9631efd193fa6dea6598f8cbea890158e738,"Properly cleanup processes and queues for MPRS and Fix `pause` for prefetch (#1096)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1096

Fixes issue about `MPRS.finalize` when `dataloader2.shutdown()` is called

### Changes

- DataLoader2 should always clean up `datapipe_iter` at shutdown
- Guard `MPRS` to finalize once
- Fix the problem of `ConnectionError` when DataLoader early exits
  - This is caused by `queue` is joined when main/worker/dispatching process exits. No more request/response can be passed across processes.
    - Consumer process shouldn't join the `req_queue` at exit to make sure producer process can still access the remaining request. And, consumer will close `req_queue` after clean up to prevent any further request sent to queue.
    - Produce process shouldn't join the `res_queue` at exit to make sure consumer process can still access response. And, producer will close `res_queue` after clean up to prevent any further response sent to queue.
       - Main (Consumer) <-> Worker (Producer)
       - Worker (Consumer) -> Dispatching (Producer)
- Fix `pause` API for DataLoader2
    - Invoke `pause` lazily until the `limit+1` iteration is reached to align with python's iterator behavior.
    - Make `prefetch.pause` blocking unless there might be potential racing issue. Main thread is paused but prefetch worker is still trying to fetch data from `iter`.
- Add tests to validate

Pull Request resolved: https://github.com/pytorch/data/pull/1075

Reviewed By: NivekT

Differential Revision: D44168655

Pulled By: ejguan

fbshipit-source-id: fdfee5c27b512b5c0d5308e53a81b1cb2db70a43",erjia,erjia@fb.com,2023-03-18 00:12:43,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
7d9747588173f38e3ce0d5c58ba3746dacb4438f,"Revert D43994511: Properly cleanup processes and queues for MPRS and Fix `pause` for prefetch

Differential Revision:
D43994511

Original commit changeset: a11bc3f54c61

Original Phabricator Diff: D43994511

fbshipit-source-id: d2275d92684fc38ea5a5773a44cd3e3b0292e999",Erjia Guan,erjia@fb.com,2023-03-17 14:07:58,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
8eecb77ed0053b5d86537d500c1184898afecfa7,"Properly cleanup processes and queues for MPRS and Fix `pause` for prefetch (#1075)

Summary:
Fixes issue about `MPRS.finalize` when `dataloader2.shutdown()` is called

### Changes

- DataLoader2 should always clean up `datapipe_iter` at shutdown
- Guard `MPRS` to finalize once
- Fix the problem of `ConnectionError` when DataLoader early exits
  - This is caused by `queue` is joined when main/worker/dispatching process exits. No more request/response can be passed across processes.
    - Consumer process shouldn't join the `req_queue` at exit to make sure producer process can still access the remaining request. And, consumer will close `req_queue` after clean up to prevent any further request sent to queue.
    - Produce process shouldn't join the `res_queue` at exit to make sure consumer process can still access response. And, producer will close `res_queue` after clean up to prevent any further response sent to queue.
       - Main (Consumer) <-> Worker (Producer)
       - Worker (Consumer) -> Dispatching (Producer)
- Fix `pause` API for DataLoader2
    - Invoke `pause` lazily until the `limit+1` iteration is reached to align with python's iterator behavior.
    - Make `prefetch.pause` blocking unless there might be potential racing issue. Main thread is paused but prefetch worker is still trying to fetch data from `iter`.
- Add tests to validate

Pull Request resolved: https://github.com/pytorch/data/pull/1075

Reviewed By: NivekT

Differential Revision: D43994511

Pulled By: ejguan

fbshipit-source-id: a11bc3f54c6151a3c1c85511042d536c631f6cf5",erjia,erjia@fb.com,2023-03-17 06:55:20,"['test/dataloader2/test_mprs.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
1472157b9c77429f6df788be36b3a0f8171f073b,"Fix pin_memory_fn for NamedTuple (#1086)

Summary:
Fixes https://github.com/pytorch/data/issues/1085

Per title. And, even though I can add a test, this test won't be executed as we don't have a GPU CI machine yet.

I have tested on my local machine though

Pull Request resolved: https://github.com/pytorch/data/pull/1086

Reviewed By: NivekT

Differential Revision: D44094225

Pulled By: ejguan

fbshipit-source-id: 9c8414c31b76c93cee7e31c4e2da14076e9792bf",erjia,erjia@fb.com,2023-03-16 03:18:27,"['test/test_iterdatapipe.py', 'torchdata/datapipes/utils/pin_memory.py']",False
f2a1051b61f6f5143f610e129a8b5f4c28e69e76,"Use 'index-url' instead of 'find-links' to install domain libraries during CI testing (#1091)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1091

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D44111515

Pulled By: NivekT

fbshipit-source-id: 1d585f52908d65467eeaa6999b905317eb546c2c",Kevin Tse,ktse@fb.com,2023-03-16 00:32:00,['.github/workflows/domain_ci.yml'],False
1f5a28bd02dbec7eae40682c8d5be48108e60ebb,"Update version compatility after release 0.6.0 (#1090)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1090

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D44107011

Pulled By: NivekT

fbshipit-source-id: 1e1efda61f9cdbfa3212a484ac2d465d744d43e9",Kevin Tse,ktse@fb.com,2023-03-15 22:25:42,"['README.md', 'setup.py']",False
fea20d416cd40e23ee949e09f0f5a7858fcc3542,"Add ThreadPoolMapper (#1052)

Summary:
Fixes https://github.com/pytorch/data/issues/1045

### Changes

- Add ThreadPoolMapper datapipe
- Add tests

Pull Request resolved: https://github.com/pytorch/data/pull/1052

Reviewed By: NivekT

Differential Revision: D44033894

Pulled By: ejguan

fbshipit-source-id: 608b70a857e4610fc6616a53711c706207ce696a",SvenDS9,sven.braun@tngtech.com,2023-03-14 15:26:45,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/callable.py']",False
f1283ebcd0675a08e3d8f238b0d717a349f621c8,"CI test: check if documentation is complete (#1070)

Summary:
Fixes https://github.com/pytorch/data/issues/1047

Basic but should do the trick. Not sure about the Github/actions part (never used this before)

### Changes

- Add CI test that checks if all exported dps have documentation

Pull Request resolved: https://github.com/pytorch/data/pull/1070

Reviewed By: NivekT

Differential Revision: D43876159

Pulled By: ejguan

fbshipit-source-id: 3b77416ca8f082cff90abec981aa00ddc4232db8",SvenDS9,sven.braun@tngtech.com,2023-03-07 23:18:05,"['.github/scripts/check_complete_doc.py', '.github/workflows/lint.yml', 'docs/source/torchdata.datapipes.utils.rst', 'torchdata/datapipes/utils/__init__.py']",False
431ca6fe0277bc917d08978678294ed699b34bff,"Fix DataPipe tutorial linting (#1071)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1071

Fixes linting (stye) error introduced by #946

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43883135

Pulled By: NivekT

fbshipit-source-id: b48709c280f4999b07ca84af7e9fafea329fa6a5",Kevin Tse,ktse@fb.com,2023-03-07 20:14:31,['docs/source/dp_tutorial.rst'],False
1eae1270ae077f2172acc6a7f566ec77c68b1121,"azureml datastore example (#946)

Summary:
### Changes

- added a section to the tutorial documentation on Accessing Azure ML Datastores with `fsspec` DataPipes.

Fixes https://github.com/pytorch/data/issues/946

Pull Request resolved: https://github.com/pytorch/data/pull/946

Reviewed By: ejguan

Differential Revision: D43875104

Pulled By: NivekT

fbshipit-source-id: fa88b8540700a91a15c11dc718b29bd4f8638f46",Sam Kemp,samkemp@microsoft.com,2023-03-07 18:16:39,['docs/source/dp_tutorial.rst'],False
1d81a61aa27944c197475e004ebe5ea0ce69cffd,"ci: Do not install conda-build from conda-forge (#1064)

Summary:
This create a bad dependency chain, do not do that please

Tested on my local mac

Pull Request resolved: https://github.com/pytorch/data/pull/1064

Reviewed By: seemethere, NivekT

Differential Revision: D43780624

Pulled By: atalman

fbshipit-source-id: c61b1887881a91c41702ba2efbd1246b753ec99f",Eli Uriegas,1700823+seemethere@users.noreply.github.com,2023-03-03 21:04:46,['.github/workflows/_build_test_upload.yml'],False
c5a61eab8d591282e87a25d69bd3abf6ea4700dc,"Add missing datapipes to datapipes.iter.rst (#1066)

Summary:
Some datapipes weren't listed in the rst-file.

### Changes

- Add missing dps to rst file

Pull Request resolved: https://github.com/pytorch/data/pull/1066

Reviewed By: ejguan

Differential Revision: D43772420

Pulled By: NivekT

fbshipit-source-id: 9394ae070a60d252a42d6892ddcdc4b34de77c79",SvenDS9,sven.braun@tngtech.com,2023-03-03 18:25:25,['docs/source/torchdata.datapipes.iter.rst'],True
e74ed435b8eae3293bfe6b51cdf09859eedcd2cc,"Revert D43251818: Multisect successfully blamed D43251818 for test or build failures

Summary:
This diff is reverting D43251818 (https://github.com/pytorch/data/commit/d7835c0673ea67e7ed5ec0902e9873ea7648b250)
D43251818 (https://github.com/pytorch/data/commit/d7835c0673ea67e7ed5ec0902e9873ea7648b250): [DataLoader2] Removing delegation for 'pause', 'limit', and 'resume' by NivekT has been identified to be causing the following test or build failures:

Tests affected:
- [pytorch/data/fb/onbox/tests:onbox_dpp_reading_service_test - test_mini_epoch_0 (pytorch.data.fb.onbox.tests.onbox_dpp_reading_service_test.DataLoaderTest)](https://www.internalfb.com/intern/test/281475060062655/)
- [pytorch/data/fb/onbox/tests:onbox_dpp_reading_service_test - test_delegation_2 (pytorch.data.fb.onbox.tests.onbox_dpp_reading_service_test.DataLoaderTest)](https://www.internalfb.com/intern/test/281475060062662/)
- [pytorch/data/fb/onbox/tests:onbox_dpp_reading_service_test - test_delegation_0 (pytorch.data.fb.onbox.tests.onbox_dpp_reading_service_test.DataLoaderTest)](https://www.internalfb.com/intern/test/562950036789111/)
- [pytorch/data/fb/onbox/tests:onbox_dpp_reading_service_test - test_mini_epoch_2 (pytorch.data.fb.onbox.tests.onbox_dpp_reading_service_test.DataLoaderTest)](https://www.internalfb.com/intern/test/562950036789122/)

Here's the Multisect link:
https://www.internalfb.com/intern/testinfra/multisect/1605964
Here are the tasks that are relevant to this breakage:
T144250729: 16 tests started failing for oncall mldp_control in the last 2 weeks
We're generating a revert to back out the changes in this diff, please note the backout may land if someone accepts it.

Reviewed By: ejguan

Differential Revision: D43659172

fbshipit-source-id: 65d508fb31eeb300dacdb003b45edc74be527d31",generatedunixname89002005232357,generatedunixname89002005232357@fb.com,2023-02-28 20:50:36,"['torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
0fef12a2473ea33bb6a04aa6492c9d96558f8c24,"Single key option for Slicer and doc improvements (#1041)

Summary:
Single key option for Slicer and doc improvements

### Changes

- Enable Slicer to also work for a single key + functional test
- Fix typos in doc
- Add laion-example to examples page

Pull Request resolved: https://github.com/pytorch/data/pull/1041

Reviewed By: NivekT

Differential Revision: D43622504

Pulled By: ejguan

fbshipit-source-id: b656082598f4a790dc457dddb0213a1a180239fd",SvenDS9,sven.braun@tngtech.com,2023-02-28 01:50:27,"['docs/source/dp_tutorial.rst', 'docs/source/examples.rst', 'docs/source/reading_service.rst', 'docs/source/torchdata.datapipes.utils.rst', 'test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/callable.py', 'torchdata/datapipes/map/util/unzipper.py']",False
f30281b6b16480e6867bc39ed7cf5ce7f8c9cf62,"Create new eventloop to run coroutines (#1055)

Summary:
Prevent calling `asyncio.run` within `__iter__` function. New event loop would be created rather than reusing the global event loop.
Using policy for the case of custom policy is used as suggested in https://docs.python.org/3.8/library/asyncio-eventloop.html#event-loop

Address the [comment](https://docs.python.org/3/library/asyncio-runner.html#:~:text=It%20should%20be%20used%20as,ideally%20only%20be%20called%20once.&text=New%20in%20version%203.7.)

Pull Request resolved: https://github.com/pytorch/data/pull/1055

Reviewed By: wenleix, dracifer

Differential Revision: D43630185

Pulled By: ejguan

fbshipit-source-id: 2dbaffb379971433e29dfcbaa936064c4ce0a44b",erjia,erjia@fb.com,2023-02-28 01:48:51,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/callable.py']",False
d7835c0673ea67e7ed5ec0902e9873ea7648b250,"Removing delegation for 'pause', 'limit', and 'resume' (#1011)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1011

Test Plan: Imported from OSS

Reviewed By: mingyuzh, ejguan

Differential Revision: D43251818

Pulled By: NivekT

fbshipit-source-id: 5c34e1a71438308366b473c5d4d075a8158088f1",Kevin Tse,ktse@fb.com,2023-02-27 23:14:54,"['torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",True
f4cf810195deff1b3a8e4c481d8d84d37e9c60e3,"Add round robin sharding documentation (#1050)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1050

Also fixed some wording and typos

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43625322

Pulled By: NivekT

fbshipit-source-id: 37adee2d72fdf20c12560eb2134ef93749ac0293",Kevin Tse,ktse@fb.com,2023-02-27 19:46:15,"['docs/source/dlv2_tutorial.rst', 'docs/source/dp_tutorial.rst', 'docs/source/reading_service.rst', 'docs/source/torchdata.datapipes.iter.rst', 'torchdata/datapipes/iter/util/sharding.py']",True
61bd6d1ef297bc2c988e5f0f6e15306f2c659043,"Update C++ standard to 17 (#1051)

Summary:
Following the change in PyTorch core.

https://github.com/pytorch/pytorch/commit/87e4a087784c805312a2b48bb063d2400df26c5e

Pull Request resolved: https://github.com/pytorch/data/pull/1051

Reviewed By: NivekT

Differential Revision: D43629811

Pulled By: ejguan

fbshipit-source-id: 9fb43b055ec5731c5854f69e9902d46764411092",cyy,cyyever@outlook.com,2023-02-27 19:29:22,['CMakeLists.txt'],True
42e34ff27521a1d139a6598bb376e14a7adec7a3,"keep_key in MapKeyZipper (#1042)

Summary:
As mentioned in https://github.com/pytorch/data/issues/256 it would be useful to have this in all dp that use a `key_fn`.

### Changes

- Add keep_key option to `MapKeyZipper`
- Test for the new option
- Improve example in documentation by using sphinx doctest

Pull Request resolved: https://github.com/pytorch/data/pull/1042

Reviewed By: ejguan

Differential Revision: D43550124

Pulled By: NivekT

fbshipit-source-id: 453418560dd586ebb9ce42dd27eb1bc86eb734d0",SvenDS9,sven.braun@tngtech.com,2023-02-27 18:53:04,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/util/combining.py']",False
e1b906b4f1efac6613d6f5bf323b3c324a18c7bf,"Fix links in CONTRIBUTING.md (#1053)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/1053

Reviewed By: NivekT

Differential Revision: D43622310

Pulled By: ejguan

fbshipit-source-id: e1aa3c8f507bec0b5b87c1b4293ae9f6ce277436",SvenDS9,sven.braun@tngtech.com,2023-02-27 18:46:07,['CONTRIBUTING.md'],True
daabdacecc13dfbc07a1e5f47b4778590aaf9b1e,"Implement BatchAsyncMapper (#1044)

Summary:
### Changes

- Add `BatchAsyncMapper` to support async processing
  - Add syntax sugar to combine `batch().async_map().flatmap()`
  - `input_col`/`output_col` are added to align the behavior to `Mapper`
  - Add unit tests

Pull Request resolved: https://github.com/pytorch/data/pull/1044

Reviewed By: wenleix, NivekT

Differential Revision: D43573398

Pulled By: ejguan

fbshipit-source-id: 8a933c381c35d76712500e551c78047681e6e8cb",erjia,erjia@fb.com,2023-02-25 05:37:44,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'tools/gen_pyi.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/callable.py']",False
ca83b845ca6a333ad50c9acbaf88d4d7dc7f523e,"Add pin_memory to online doc (#1046)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/1046

Reviewed By: NivekT

Differential Revision: D43579347

Pulled By: ejguan

fbshipit-source-id: 622fd646c377f8b32e11f08fd765b123cee5532f",erjia,erjia@fb.com,2023-02-24 22:19:26,['docs/source/torchdata.datapipes.iter.rst'],True
328a89f6de6c3c10e974df778c5daa3d7e28db96,"Add malfet channel for 3.11 installs (#1029)

Summary:
Add malfet channel for 3.11 installs

Pull Request resolved: https://github.com/pytorch/data/pull/1029

Reviewed By: weiwangmeta, NivekT, ejguan

Differential Revision: D43377665

Pulled By: atalman

fbshipit-source-id: 90adaea00e02f34c6720887b241b9a42148b03b6",atalman,atalman@fb.com,2023-02-23 14:36:42,['.github/scripts/validate_binaries.sh'],False
f083d5213338c3b57f8a8bcc7ff62ba462aa6684,"Attach traceback to Exception & Test disatpching process (#1036)

Summary:
Partially fixes https://github.com/pytorch/data/issues/969

### Changes

- Add `ExceptionWrapper` to attach traceback to the Exception
  - Reason: traceback is unserializable. So, it has to be passed by string
  - In order to provide informative Error message, pass name for each process like `dispatching process` and `worker process <id>`.
- Add tests to validate Error propagation from the dispatching process
  - parametrize the tests
- Fix a bug for `round_robin_demux` to return a list of DataPipe rather than a single DataPipe when `num_of_instances` is 1.

Pull Request resolved: https://github.com/pytorch/data/pull/1036

Reviewed By: NivekT

Differential Revision: D43472709

Pulled By: ejguan

fbshipit-source-id: e5c9e581ca881f523fb568b6f46bf16ecfc243d2",erjia,erjia@fb.com,2023-02-22 03:27:11,"['test/dataloader2/test_dataloader2.py', 'torchdata/_utils.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/map.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/combining.py']",False
6ca4402b0c42e598b9ee658d69d3a00e834158df,"Add laion5b-example with Dataloader2 (#1034)

Summary:
This is an example that uses Datapipes to download and preprocess the [laion5b](https://laion.ai/blog/laion-5b/)-dataset (to be more precise [this subset](https://huggingface.co/datasets/laion/laion2B-en-joined)). Also uses Dataloader2 for multiprocessing.

### Changes
- Load metadata from Huggingface and filter
- Load images from the urls
- access metadata of image and print out label and copyright information

Unfortunately I made a mistake while rebasing in https://github.com/pytorch/data/issues/1017 so I had to reopen the PR.

Pull Request resolved: https://github.com/pytorch/data/pull/1034

Reviewed By: NivekT

Differential Revision: D43463022

Pulled By: ejguan

fbshipit-source-id: 2f1f2b8bcb3abee15a1935431a497532b95b1c8d",SvenDS9,sven.braun@tngtech.com,2023-02-21 16:55:40,['examples/vision/laion5b.py'],False
a3b34a00e7d2b6694ea0d5e21fcc084080a3abae,"Update Prefetcher and Implement PinMemory IterDataPipe (#1014)

Summary:
Fixes https://github.com/pytorch/data/issues/1013

## Changes

- Simplify the control flow of prefetcher
  - Delay Exception raised from thread worker to main thread in `__iter__`
  - Stop prefetching whenever Exception is received
  - As long as `stop_iteration` is not turned on or `buffer` is not empty, continue yielding data from `__iter__`.
  - Add serialization test
- Add `PinMemory` DataPipe
  -  `is_replciable() -> False` to keep it in the main process
  - Add unit tests
- Update `test_proto_multi_rs.py` to `test_mprs.py`

Pull Request resolved: https://github.com/pytorch/data/pull/1014

Reviewed By: NivekT

Differential Revision: D43329696

Pulled By: ejguan

fbshipit-source-id: da4326dbe2388f4e23b9a1a3a5c43da09d29185a",erjia,erjia@fb.com,2023-02-17 21:17:13,"['docs/source/index.rst', 'docs/source/torchdata.datapipes.utils.rst', 'test/dataloader2/test_mprs.py', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/prefetcher.py', 'torchdata/datapipes/utils/__init__.py', 'torchdata/datapipes/utils/pin_memory.py']",False
efcc766df4390fe205a6db90a342abe5aa927438,"Bump version to 0.7.0 (#1028)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1028

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43370795

Pulled By: NivekT

fbshipit-source-id: f052b80c0b51c65b8735a381e8d4d239be9e5dba",Kevin Tse,ktse@fb.com,2023-02-16 22:47:23,"['README.md', 'version.txt']",False
4ab0b45d56057540f59bfc821e6338267f58baa1,"Reland 3.11 Conda for Mac/Windows (#1022)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1022

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43367475

Pulled By: NivekT

fbshipit-source-id: 3087326aab04efbc4e7dde3232302903d3e4eb9e",Kevin Tse,ktse@fb.com,2023-02-16 20:12:11,"['.github/workflows/_build_test_upload.yml', 'packaging/build_conda.sh']",False
1774c4889ea94e9a8fc2a3378dc136dac074b5ea,"Revert ""3.11 Conda for Mac/Windows (#1020)"" (#1021)

This reverts commit 1e60010f04ab49bc574537b2de8b8f412d7f425f.",Erjia Guan,68879799+ejguan@users.noreply.github.com,2023-02-16 15:28:55,"['.github/workflows/_build_test_upload.yml', 'packaging/build_conda.sh']",False
1e60010f04ab49bc574537b2de8b8f412d7f425f,3.11 Conda for Mac/Windows (#1020),Omkar Salpekar,osalpekar@fb.com,2023-02-16 03:10:03,"['.github/workflows/_build_test_upload.yml', 'packaging/build_conda.sh']",True
b717187f3336015d7591bbb2a9ac90003f151ec5,"Forward worker exceptions and exit with it (#1003)

Summary:
When a worker thread fails in PrototypeMultiProcessingReadingService, exception was silently neglected and the thread hanged. This PR fixes that by catching and propagating exception to response queue, showing that to user and exiting the process instead of hanging.

Pull Request resolved: https://github.com/pytorch/data/pull/1003

Reviewed By: ejguan

Differential Revision: D43327742

Pulled By: priyaramani

fbshipit-source-id: 7a1f6bed2d3baab04912df2b8456dbb940c3e663",Priya Ramani,priyaramani@fb.com,2023-02-16 02:32:43,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/datapipes/iter/util/prefetcher.py']",True
6714306c7f59256b4b2258a42bfe5255ef103713,"Forward fix of 'limit' delegation (#1019)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/1019

Test Plan:
Imported from OSS

 ---
Ran this on devvm:

```
buck2 test mode/dev-nosan //caffe2/torch/fb/trainer/data_modules/tests:test_full_sync_data_module_data_loader_v2_compatibility -- --exact 'caffe2/torch/fb/trainer/data_modules/tests:test_full_sync_data_module_data_loader_v2_compatibility - test_full_sync_data_module_data_reading_checkpoint_read_beyond_data_length (caffe2.torch.fb.trainer.data_modules.tests.test_full_sync_data_module_data_loader_v2_compatibility.FullSyncDataModuleDataLoaderV2CompatibilityTest)'
```

Reviewed By: ejguan

Differential Revision: D43312918

Pulled By: NivekT

fbshipit-source-id: f4766c4aec1adfd23f2b5aadf4a26905ba8716c9",Kevin Tse,ktse@fb.com,2023-02-15 22:23:03,['torchdata/dataloader2/dataloader2.py'],False
a19c6f8238f027724260d0aba9be8353bff0f9a2,"Fix mypy after updates from `types_requests` (#1018)

Summary:
Fix the mypy Error after `types_requests` is released to `2.28.11.13`

Pull Request resolved: https://github.com/pytorch/data/pull/1018

Reviewed By: NivekT

Differential Revision: D43309767

Pulled By: ejguan

fbshipit-source-id: 1990ec809156c961ebf32d6f3b16b67071cc1303",erjia,erjia@fb.com,2023-02-15 20:18:17,['torchdata/datapipes/iter/load/online.py'],False
226d4dda3c13967f798a84ef1a36926043079778,"Remove fsspec from conda build test for Python 3.11 (#1015)

Summary:
`fsspec` doesn't support python 3.11 for now. In order to enable TorchData conda release for python 3.11, I have to remove `fsspec` from `meta.yml` to prevent installation during building process.
See: https://anaconda.org/anaconda/fsspec/files

You can find failing release workflow in https://github.com/pytorch/data/actions/runs/4183212525

Pull Request resolved: https://github.com/pytorch/data/pull/1015

Reviewed By: atalman

Differential Revision: D43307022

Pulled By: ejguan

fbshipit-source-id: 2da8022705d503ff8a75ec3e5e8766d7d5592d82",erjia,erjia@fb.com,2023-02-15 17:44:30,['packaging/torchdata/meta.yaml'],False
73d3aa922a8e1aeccf8433c52e76abdc5f01e3de,"Officially graduate ProtypeMPRS to MPRS (#1009)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1009

Fixes: https://github.com/pytorch/data/issues/932

- Convert all references from `ProtypeMPRS` to `MPRS`
- Remove usage of `MPRS`

Reviewed By: wenleix, NivekT

Differential Revision: D43245136

fbshipit-source-id: 1fd67f0e9d55a984209b8e58edecdb6070d919cd",Erjia Guan,erjia@meta.com,2023-02-14 19:27:06,"['benchmarks/cloud/aws_s3.py', 'docs/source/dataloader2.rst', 'docs/source/dlv2_tutorial.rst', 'docs/source/reading_service.rst', 'test/dataloader2/test_dataloader2.py', 'test/dataloader2/test_random.py', 'test/test_distributed.py', 'test/test_graph.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
b43c07d0b46c374ea5e4710d846db33a6ab77c40,"Add conda python 3.11 builds (#1010)

Summary:
Adding conda 3.11 builds

Pull Request resolved: https://github.com/pytorch/data/pull/1010

Reviewed By: malfet

Differential Revision: D43257982

Pulled By: atalman

fbshipit-source-id: b6e8f1c496844432be660308a17eb6dd47a37b42",atalman,atalman@fb.com,2023-02-14 13:03:14,['.github/workflows/_build_test_upload.yml'],True
cfcdf6e081f77c23087912c21f78921c34f7c0b3,"Adding 'pause' and 'resume' operations to halt DataPipes (#879)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/879

The goal of this PR is fully stop DataPipe activities in preparation of snapshotting (which requires a halted state), so buffers will not be changing while we record the snapshot.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D41744759

Pulled By: NivekT

fbshipit-source-id: 7045a23ea2fa7499184b50c09f706f46472e88ec",Kevin Tse,ktse@fb.com,2023-02-14 04:16:06,"['test/dataloader2/test_dataloader2.py', 'test/dataloader2/test_proto_multi_rs.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/distributed.py', 'torchdata/datapipes/iter/util/prefetcher.py']",True
e9083303fe9fa0408919ab254408ddc0ca3f546c,"Make SeqRS invokes checkpoint/restore only when they are available (#1008)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/1008

Reviewed By: mingyuzh

Differential Revision: D43243392

Pulled By: ejguan

fbshipit-source-id: cad70b7a859481bc293a95e45979c98b589bb90a",erjia,erjia@fb.com,2023-02-14 04:04:00,['torchdata/dataloader2/reading_service.py'],True
657b1dd401771b0a97f6bcba356077d0498ffca6,"Make portalocker optional dependency (#1007)

Summary:
Fixes https://github.com/pytorch/data/issues/940 #978

## Changes:
- Make portalocker optional
- Add `workflow_dispatch` to `pull_release.yml` to enable manual triggering on nightly release testing.
- Remove unused `test/requirements.yml`

Pull Request resolved: https://github.com/pytorch/data/pull/1007

Reviewed By: wenleix, NivekT

Differential Revision: D43238384

Pulled By: ejguan

fbshipit-source-id: b23bdd558bb2d97ba90c3297ac7d93ea8adafe5f",erjia,erjia@fb.com,2023-02-14 03:51:59,"['.github/workflows/pull_release.yml', 'mypy.ini', 'packaging/torchdata/meta.yaml', 'requirements.txt', 'test/requirements.txt', 'test/requirements.yml', 'test/test_local_io.py', 'test/test_remote_io.py', 'torchdata/datapipes/iter/util/cacheholder.py']",False
ee5b18aa9eea6257a2eeba462b3775d08ac41853,"Insert/Extract from Serialization Wrapper only if it is necessary (#1001)

Summary:
Fixes https://github.com/pytorch/data/issues/960

### Changes
- Remove `SerializationWrapper` from the graph. When serialization is needed like multiprocess, we attach the wrapper before serialization and remove the wrapper after deserialization
- When `clone`, we don't need to rely on `SerializationWrapper` to do all `dill` trick. We can do it within `clone` function

Pull Request resolved: https://github.com/pytorch/data/pull/1001

Reviewed By: wenleix

Differential Revision: D43156547

Pulled By: ejguan

fbshipit-source-id: cfcd9cc03e8ad4f12575d198d3234d6964039293",erjia,erjia@fb.com,2023-02-11 04:04:07,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/graph/_serialization.py', 'torchdata/dataloader2/reading_service.py']",False
05d1cd8f89ca93b92ba71183e068cbddb3b80d5a,"Safeguarding DL2Iterator's `__getattr__` (#1004)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/1004

Fixes #1000

As reported in the issue, in some uncommon cases, it is possible for the attribute to be missing, leading to infinite recursion. This should prevent it.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D43197744

Pulled By: NivekT

fbshipit-source-id: 64e6edfe129dcca06f5cf3054bb7f8c2e510536c",Kevin Tse,ktse@fb.com,2023-02-11 02:52:56,['torchdata/dataloader2/dataloader2.py'],True
90fdad713cbd4a2e7325569a7aff069f958c4c1c,"Add target os check if TARGET_OS is not set (#1002)

Summary:
Fixes crash when TARGET_OS is not set

Pull Request resolved: https://github.com/pytorch/data/pull/1002

Reviewed By: NivekT, ejguan

Differential Revision: D43164646

Pulled By: atalman

fbshipit-source-id: 5ac4ef1a5bf4250db1314e9cca3250a75687450b",atalman,atalman@fb.com,2023-02-09 20:18:12,['.github/scripts/validate_binaries.sh'],False
c109c3a107a434db1904cd3ed0e9acab585508cc,"Fix test_remote_io.py due to mutating public s3 bucket (#997)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes https://github.com/pytorch/data/issues/984

### Changes
- Add a private function to TestDataPipeRemoteIO in test_remote_io.py to get s3 objects count label through aws cli
- add awscli in requirements

Pull Request resolved: https://github.com/pytorch/data/pull/997

Reviewed By: ejguan

Differential Revision: D43157757

Pulled By: NivekT

fbshipit-source-id: 7e9ee8299a28a087f88024c3b3e77be3bfe5adf0",Shibo Xing,shibox@amazon.com,2023-02-09 16:33:49,"['test/requirements.txt', 'test/test_remote_io.py']",False
b450cfd8b9f54ff4de211d104c3a9694dc5fe347,"Guarantee datapipe being reset iterator when all loops have received reset request in the dispatching process (#994)

Summary:
### Changes

- ~Fix S3 Tests~ in https://github.com/pytorch/data/issues/997
- Ignore AttributeError for ReadingService when `gc` gets involved
- Add a reset_iterator_counter to dispatching process to guarantee that the datapipe is reset when all loops have received the request. Otherwise, datapipe can be reset in the middle of iteration of the other loops.
- Remove reference of the `thread` from `Prefetcher`. This would prevent racing condition when both `finally` in generator and `reset` function are accessing the same `thread`.

Pull Request resolved: https://github.com/pytorch/data/pull/994

Reviewed By: NivekT

Differential Revision: D43094081

Pulled By: ejguan

fbshipit-source-id: 3065bc6a994cc0ff5047d9b71970abc4c8d3e369",erjia,erjia@fb.com,2023-02-09 13:50:46,"['test/dataloader2/test_dataloader2.py', 'test/test_distributed.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/map.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
a402344627a4b30777f90f56cf8238454c262812,"Fix links in README (#995)

Summary:
Fixes https://github.com/pytorch/data/issues/993

### Changes

- Fix links to tutorial in README
- Fix typo in warning in Slicer

Pull Request resolved: https://github.com/pytorch/data/pull/995

Reviewed By: NivekT

Differential Revision: D43119115

Pulled By: ejguan

fbshipit-source-id: 80123f290279984d0c60538ec440e954e0947be3",SvenDS9,sven.braun@tngtech.com,2023-02-08 17:55:48,"['README.md', 'docs/source/dlv2_tutorial.rst', 'torchdata/datapipes/iter/transform/callable.py']",False
e14927f32a6cf99658f72b765425bf032116f724,"Experiment with Python3.11 Linux Wheels Build (#990)

Summary:
Python3.11 support for Wheels builds. Seems to work on:
* Linux: https://github.com/pytorch/data/actions/runs/4109256531/jobs/7090889894
* MacOS x86: https://github.com/pytorch/data/actions/runs/4109256531/jobs/7090889410
* MacOS M1: https://github.com/pytorch/data/actions/runs/4109256531/jobs/7090890738

Pull Request resolved: https://github.com/pytorch/data/pull/990

Reviewed By: NivekT, ejguan

Differential Revision: D43102342

Pulled By: osalpekar

fbshipit-source-id: 919dc94f7bfa38a9cd27eff8965c84a086db2f68",Omkar Salpekar,osalpekar@fb.com,2023-02-08 01:12:49,['.github/workflows/_build_test_upload.yml'],False
98222ad72ee7a29e676646e6b3f9173576410320,"Exception handling in online datapipes (#968)

Summary:
Fixes https://github.com/pytorch/data/issues/963

### Changes

- Add option to `HTTPReader` to skip over urls causing problems
- Add test for this behavior

Pull Request resolved: https://github.com/pytorch/data/pull/968

Reviewed By: ejguan

Differential Revision: D43085635

Pulled By: NivekT

fbshipit-source-id: c5e287a8a6f77d6da16a2d882aca79ac33e5212a",SvenDS9,sven.braun@tngtech.com,2023-02-07 18:23:00,"['test/test_period.py', 'test/test_remote_io.py', 'torchdata/datapipes/iter/load/online.py']",False
8ec3550730530b1e47866e5084b72ceae802a646,"Add pure python platform-agnostic wheel (#988)

Summary:
Fixes https://github.com/pytorch/data/issues/973

Pull Request resolved: https://github.com/pytorch/data/pull/988

Reviewed By: NivekT

Differential Revision: D43063964

Pulled By: ejguan

fbshipit-source-id: 897e1d2600440be46ec010384d3fd17f42c2d823",erjia,erjia@fb.com,2023-02-07 14:31:44,['.github/workflows/_build_test_upload.yml'],False
914d3dda1a1273e373af7023a9e0460f867c1478,"Refactor `ShardingFilterIterDataPipe` into a seperate file (#987)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/987

X-link: https://github.com/pytorch/pytorch/pull/94095

Differential Revision:
D43014692

Move `ShardingFilterIterDataPipe` into a dedicated file.

Also, propose to have a dedicated parent class (`_ShardingIterDataPipe`) for sharding data pipe, as this seems more like a ""system/engine-level"" datapipe that gives strong hints to RS on how to execute, and needs first-class citizen treatment in RS (compared with other ""user-level"" datapipe that are mostly composable `Callable[[Iterable], Iterable]`.  But open to other discussions.

### Open question
Should
[ShardingRoundRobinDispatcherIterDataPipe](https://github.com/pytorch/data/blob/01fc76200354501b057bb439b43a1f05f609dd0a/torchdata/datapipes/iter/util/sharding.py#L16-L17) also be considered as a `_ShardingIterDataPipe`? (e.g. this sharding is executed by replicating (the metadata), while `ShardingRoundRobinDispatcherIterDataPipe` hints too expensive to replicate so requires round robin data exchange/dispatch).

D43014692

Reviewed By: seemethere

fbshipit-source-id: b5f2f6d8b3574d0d98b22ca55134c143786c7c2c",Wenlei Xie,wxie@meta.com,2023-02-07 09:00:03,"['test/dataloader2/test_dataloader2.py', 'test/test_graph.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/sharding.py']",False
89be1524ef312d1d93b1afc311f8a093f2c88824,"Enable SequentialReadingService to support MP + Distributed (#985)

Summary:
Fixes https://github.com/pytorch/data/issues/911

### Changes

- Remove distributed code from PrototypeMPRS
- Fix a bug of `blocking_request_get` not sent to worker process
- Enable `SequentialReadingService` to combine both Distributed and MP ReadingService
- Add tests for `SequentialReadingService`
- Add tutorial for `SequentialReadingService`

Pull Request resolved: https://github.com/pytorch/data/pull/985

Reviewed By: wenleix, NivekT

Differential Revision: D43009426

Pulled By: ejguan

fbshipit-source-id: 5668f6e0ea606846732b770f4430d399254b42bc",erjia,erjia@fb.com,2023-02-07 00:48:55,"['docs/source/dlv2_tutorial.rst', 'test/dataloader2/test_dataloader2.py', 'test/test_distributed.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/reading_service.py']",False
01fc76200354501b057bb439b43a1f05f609dd0a,"Fix lint for SequentialReadingService and unify the API for process_reset_fn (#983)

Summary:
This is the follow up for 807db8f8c7282b2f48b48b1e07439c119a2ba12f

### Changes

- Fix lint
- Fix checkpoint result
- Add inline doc
- Unify the API for process_reset_fn and dispatch_process_reset_fn

After this PR, I will land a test case and tutorial for SequentialRS

Pull Request resolved: https://github.com/pytorch/data/pull/983

Reviewed By: NivekT

Differential Revision: D42979577

Pulled By: ejguan

fbshipit-source-id: 1cb601c20701cf44a1f7b3afe972a9436cdb9465",erjia,erjia@fb.com,2023-02-03 16:53:56,"['docs/source/dataloader2.rst', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py']",False
807db8f8c7282b2f48b48b1e07439c119a2ba12f,"Add support for Sequential RS

Summary:
Sequential RS allows multiple reading services to be used in Dataloader V2.  See API change proposal [here](https://docs.google.com/document/d/1KvwX_7EDFf8uF2-22j7jxkZSgKpAiMOHvQ8cK0CI12M/edit#bookmark=id.w0dgiwrfosog).
This test of this diff demonstrate a common use case where user can leverage OnBoxDppRS to read data source and then run a map function in PrototypeMultiprocessingRS to execute post collate logic efficiently.
A follow up change will be made to show case the similar use case of SequentialRS with DisaggregatedDppRS + PrototypeMultiprocessingRS.

## Key changes

* In reading service interface:
  * make `initialize_iteration` takes in `iter_reset_fn` and also return such function so that SequentialRS can chain them.

* In OnboxDppRS:
  * Added iter_reset_fn to be able to pass session id to OnboxDppReadingServiceIterDataPipe.
  * Change weakref in DPP RS to normal references otherwise those won't be available when Sequential RS move between reader services.

* In PrototypeMultiprocessingRS:
  * ~~in PrototypeMultiprocessingRS, move process start from `initialize()` to `initialize_iteration()` ~~
  * enable worker `dispatch_process_reset_fn` to take in
 a `custom_dispatch_process_reset_fn`, which in our use case is the `iter_reset_fn`  provided by OnboxDppRS to be able to pass session id to OnboxDppReadingServiceIterDataPipe.
  * always launch a dispatching process even when the number of workers is 1. Otherwise when DppRS cannot set session id to dpp datapipe via `dispatch_process_reset_fn` because it won't be triggered.

* In DataLoader2
  * ~~allow user  to provide iter_reset_fn that'll be invoked when `self._reset_iter` is true.~~ (removed to avoid user confusion since there's no clear use case)
  * apply function returned by `initialize_iteration` to datapipe during reset. For example, in onbox dpp rs, the step of setting session id is moved to dlv2.

## To be addressed in follow up changes
Both changes will be unblocked by D42617776 (https://github.com/pytorch/data/commit/2ca1fa6483e58c6428319393e1aab4c26f576bec) that adds support to keep non-replicable DataPipe in the main process.
* add mini epoch support
  * context: during _adapt_datapipe in OnboxDppRS, `OnboxDppIterDataPipeWrapper` is attached at the end of the datapipe graph to be able to support phase reading APIs like `limit`.
   * After this change: in SeqentialRS consists of OnboxDppRS followed by PrototypeMultiprocessingRS, `OnboxDppIterDataPipeWrapper` is no longer at the end of the DataPipe graph so APIs like `limit` is no longer available.
* add full sync support
  * context: `fullsync` datapipe  stop reading when the shortest distributed shard is exhausted to uneven data sharding.
  * After this change: fullsync is copied into worker process and will run into `Torch Distributed is required to be initialized` error thrown [here](https://www.internalfb.com/code/fbsource/[bde35c2a0122]/fbcode/pytorch/data/torchdata/datapipes/iter/util/distributed.py?lines=176).  fullsync datapipe must remain in main process.

Reviewed By: ejguan

Differential Revision: D42463841

fbshipit-source-id: 7c88d3248d8f55c8c68a47df5349378eb21647be",Mingyu Zhang,mingyuz@meta.com,2023-02-02 03:16:27,"['torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/worker.py']",False
2d4f1456fcd924138a57a6791ecc477a6d8d01a2,"Pin sphinx to 5 to render table correctly (#981)

Summary:
Fixes https://github.com/pytorch/data/issues/959

Pin sphinx to 5 as pytorch is doing to help render tables correctly in pytorch.org/data

Pull Request resolved: https://github.com/pytorch/data/pull/981

Reviewed By: NivekT

Differential Revision: D42940974

Pulled By: ejguan

fbshipit-source-id: fe7babb1dafdfa750f4e55b947acb85a13bebe1e",erjia,erjia@fb.com,2023-02-01 23:06:41,['docs/requirements.txt'],True
1d98097d8700cb884e540b7a74ba3d434b09c7c1,"DataLoader2 tutorial (#980)

Summary:
Fixes https://github.com/pytorch/data/issues/689 #959 https://github.com/pytorch/data/issues/922

### Changes

- Add a section regarding determinism for ReadingService
- Add simple tutorial for DataLoader2
- Fix table rendering for dataloader.html

Example result can be found: https://ejguan.github.io/dataloader2.html

Pull Request resolved: https://github.com/pytorch/data/pull/980

Reviewed By: NivekT

Differential Revision: D42903523

Pulled By: ejguan

fbshipit-source-id: 3d5093312953ac5fb5f247b6a65e161b4842bf8f",erjia,erjia@fb.com,2023-02-01 17:36:19,"['docs/source/dataloader2.rst', 'docs/source/dlv2_tutorial.rst', 'docs/source/dp_tutorial.rst', 'docs/source/index.rst', 'docs/source/reading_service.rst', 'torchdata/datapipes/iter/load/huggingface.py']",False
d202d56c464bdb68ec008fd8970da6c313ea2e4c,"Updating Colab example (#979)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/979

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D42901342

Pulled By: NivekT

fbshipit-source-id: 49f5802cd320e21b58d2d94dcf14f1785c152941",Kevin Tse,ktse@fb.com,2023-01-31 22:43:42,['README.md'],False
611b5807923597d1aab09e72b5ffb53f175a7403,"Fix S3 Tests (#976)

Summary:
per title

Pull Request resolved: https://github.com/pytorch/data/pull/976

Reviewed By: NivekT

Differential Revision: D42856763

Pulled By: ejguan

fbshipit-source-id: ac84b33fa648e271da418f755b408bfff3e1a7f0",erjia,erjia@fb.com,2023-01-31 00:15:01,['test/test_remote_io.py'],False
f0d356b80810596d2e163b02f59c51f51d687955,"Improve reset epoch sent to all workers before blocking to receive (#967)

Summary:
### Changes

- Send request to workers before requesting response to reduce the latency for each new epoch
- Minor change for resetting `replicable_dp`

Pull Request resolved: https://github.com/pytorch/data/pull/967

Reviewed By: dahsh

Differential Revision: D42753068

Pulled By: ejguan

fbshipit-source-id: a404c55aaee3f3eefe330b8992adc369f36207cb",erjia,erjia@fb.com,2023-01-30 17:35:22,"['torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/reading_service.py']",False
d32d5552294252425ec5025c3b4d2d7fab42657e,"Align pybind11 with PyTorch (#975)

Summary:
Per title
- Revert from 2.10.3 to 2.10.1 to align the version with PyTorch to prevent potential Error

Pull Request resolved: https://github.com/pytorch/data/pull/975

Reviewed By: dracifer

Differential Revision: D42811454

Pulled By: ejguan

fbshipit-source-id: 027208e7df15fc9af552f18ed30f05637c2c3542",erjia,erjia@fb.com,2023-01-27 21:59:37,['third_party/pybind11'],False
5960bd3a00e1c3e0d25c07b062f6c3c7efa64833,"Drop python 3.7 support as aligned with PyTorch (#974)

Summary:
First step for https://github.com/pytorch/data/issues/971

per title

Pull Request resolved: https://github.com/pytorch/data/pull/974

Reviewed By: NivekT

Differential Revision: D42810503

Pulled By: ejguan

fbshipit-source-id: 128d8faacf115c0aa2ad8345cd7d348de5739dfe",erjia,erjia@fb.com,2023-01-27 20:13:20,"['.github/workflows/_build_test_upload.yml', '.github/workflows/aistore_ci.yml', '.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml', 'README.md', 'setup.py', 'third_party/CONTRIBUTING.md']",False
8f05ff529a54f327189789bf8b46f6ed5ec11903,"Onboard to validation framework (#970)

Summary:
Onboarding TorchData to Validation framework

Pull Request resolved: https://github.com/pytorch/data/pull/970

Reviewed By: NivekT

Differential Revision: D42805101

Pulled By: ejguan

fbshipit-source-id: 6e48d3367353dd4d4fcb644674ea46dc6ea2bb70",atalman,atalman@fb.com,2023-01-27 19:43:54,"['.github/scripts/validate_binaries.sh', '.github/workflows/validate-binaries.yml', '.github/workflows/validate-nightly-binaries.yml']",False
f7242a466fffcea49d254f3a6e0b016a14d12039,"Huggingface all options (#952)

Summary:
Fixes https://github.com/pytorch/data/issues/944

### Changes

- Changed test setup for HuggingFaceHubReader. Do not test against production but ensure `load_dataset` (from HuggingFace) is called with correct parameters
- Include HuggingFaceHubReader in documentation

ejguan could you please have a look

Pull Request resolved: https://github.com/pytorch/data/pull/952

Reviewed By: wenleix, NivekT

Differential Revision: D42709728

Pulled By: ejguan

fbshipit-source-id: 9d67a2730ed4c5f28637c03a605d0fdd78a78122",SvenDS9,sven.braun@tngtech.com,2023-01-26 15:31:59,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_huggingface_datasets.py', 'torchdata/datapipes/iter/load/huggingface.py']",False
2ca1fa6483e58c6428319393e1aab4c26f576bec,"Add support to keep non-replicable DataPipe in the main process (#950)

Summary:
This is useful when `fullsync` is in the pipeline and we don't want to make this DataPipe running in the worker process

### Changes

- Change the function names that is dispatching-related to `dispatching_xxx`
- Make `fullsync` DataPipe non-replicable
- Add `_find_replicable_branches` to find the last DataPipe prior to any non-replicable DataPipe
  - Add graph tests
- In `PrototypeMultiprocessingReadingService`, make sure only `replicable_datapipe` sent to worker process. And, replace the `replicable_datapipe` with the `worker_consumer_datapipe`.

Pull Request resolved: https://github.com/pytorch/data/pull/950

Reviewed By: wenleix, NivekT, Miiira

Differential Revision: D42617776

Pulled By: ejguan

fbshipit-source-id: 1138203507934b089025e290597b473ef9be32bb",erjia,erjia@fb.com,2023-01-24 01:11:43,"['docs/source/dataloader2.rst', 'test/dataloader2/test_dataloader2.py', 'test/test_graph.py', 'torchdata/dataloader2/graph/utils.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/dispatch.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/util/distributed.py']",False
29d7a5ecd6e734a3046bec0523c64bdddca4d70f,"remove stray print (#958)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes #{issue number}

### Changes

-
-

Pull Request resolved: https://github.com/pytorch/data/pull/958

Reviewed By: dracifer

Differential Revision: D42678996

Pulled By: ejguan

fbshipit-source-id: 82763af20aac53fbbab962c40dfe5985a6aea821",Elijah Rippeth,elijah.rippeth@gmail.com,2023-01-23 19:38:54,['torchdata/datapipes/iter/load/fsspec.py'],True
a3c1594e456b551ef393e1f97b3787e8a38261fa,"Replace easy_install by pip install to fix CI for MacOS (#951)

Summary:
Fixes https://github.com/pytorch/data/issues/948

### Changes
- To fix MacOS CI, uses `pip install .` or `pip install -e .` to replace `python setup.py install` or `python setup.py develop`
  - `pip install` would use an isolated environment to prevent the problem in our CI
  - Add `ninja` to [`pyproject.toml`](https://github.com/pytorch/data/blob/main/pyproject.toml) to make sure CMake works properly using `pip install`
  - Easy install is deprecated https://setuptools.pypa.io/en/latest/deprecated/easy_install.html#easy-install
- Change documents to advocate `pip install` rather than `python setup.py`

Pull Request resolved: https://github.com/pytorch/data/pull/951

Reviewed By: NivekT

Differential Revision: D42648547

Pulled By: ejguan

fbshipit-source-id: 77aa181d34651034e4c73459958b5658a18c82f9",erjia,erjia@fb.com,2023-01-23 16:52:11,"['.github/workflows/_build_test_upload.yml', '.github/workflows/aistore_ci.yml', '.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml', 'CONTRIBUTING.md', 'README.md', 'packaging/torchdata/bld.bat', 'packaging/torchdata/build.sh', 'pyproject.toml', 'torchdata/datapipes/iter/load/README.md']",True
f64ea9a6251e5bbf43bdbd742ab2d26feb1f3f0c,"Fixing fsspec DataPipe to be compatible with new version of fsspec (#957)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/957

Fixes #956

Context:

In the old version of `fsspec`, the default argument is `detail=False` for method `ls` for the filesystem `memory`, thus it returned a list of `str`. In the new version, the default is `detail=True`, which returns list of `Dict`.

Source code:
https://github.com/fsspec/filesystem_spec/blob/2023.1.0/fsspec/implementations/memory.py#L34

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D42646692

Pulled By: NivekT

fbshipit-source-id: 41258a5a16487303a7e6895c484794c1f1d66e39",Kevin Tse,ktse@fb.com,2023-01-21 00:32:16,['torchdata/datapipes/iter/load/fsspec.py'],False
0d4c0f1b912f15fb92394fd745fe02e9e340376f,"Updating README and documentation with latest changes (#954)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/954

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D42621598

Pulled By: NivekT

fbshipit-source-id: 1aef46100798e0a41f80e5c94856f0e2cb121cff",Kevin Tse,ktse@fb.com,2023-01-20 20:22:01,"['README.md', 'docs/source/dataloader2.rst', 'docs/source/torchdata.datapipes.map.rst', 'torchdata/dataloader2/README.md']",False
5f3e968255f911b158d1bf20ae70a5ed54759fb9,"Update submodule (#955)

Summary:
### Changes

- Update pybind11 with some minor fixes
- Update awssdk to fix the compilation problem on MacOS
  - It breaks nightly releases https://github.com/pytorch/data/actions/runs/3967053628
  - Intake the fix for https://github.com/aws/aws-sdk-cpp/issues/2195

Pull Request resolved: https://github.com/pytorch/data/pull/955

Reviewed By: wenleix

Differential Revision: D42638612

Pulled By: ejguan

fbshipit-source-id: b1861fe2e79a0147d5a3e07b45cc17179d464d4e",erjia,erjia@fb.com,2023-01-20 18:21:54,"['third_party/aws-sdk-cpp', 'third_party/pybind11']",False
38e0d03454a9018cb7ebf76e6b31379db913f8a1,"DataLoader2 initial support for randomness control (#801)

Summary:
Fixes https://github.com/pytorch/data/issues/885

Add the support for DataLoader2 to control randomness over the pipeline:
- Implement SeedGenerator
  - `spawn` to generate sub-SeedGenerators for distributed workers
  - `generate_seed` to generate unique seeds
  - `generate_shared_seed` to generate distributed shared seeds
- Change API of ReadingService to take seed generator from DataLoader2. Then, the SeedGenerator of DataLoader2 becomes the source of truth of randomness within the whole data pipeline.

A separate PR will be added for online doc regarding determinism.

Last step for https://github.com/pytorch/data/issues/885

Pull Request resolved: https://github.com/pytorch/data/pull/801

Reviewed By: NivekT

Differential Revision: D38947827

Pulled By: ejguan

fbshipit-source-id: 3562ffda453cb15f55930813d0cae5fc9e92ae88",Erjia Guan,erjia@meta.com,2023-01-18 02:46:37,"['test/dataloader2/test_dataloader2.py', 'test/dataloader2/test_random.py', 'test/test_adapter.py', 'test/test_graph.py', 'test/test_seed_generator.py', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/graph/__init__.py', 'torchdata/dataloader2/graph/settings.py', 'torchdata/dataloader2/random/__init__.py', 'torchdata/dataloader2/random/_philox.py', 'torchdata/dataloader2/random/distributed.py', 'torchdata/dataloader2/random/seed_generator.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/__init__.py', 'torchdata/dataloader2/utils/random.py', 'torchdata/dataloader2/utils/worker.py']",False
139d558e3fb51b5ee9b6c862112ef201df830c8a,"Proper fix for graphviz (#943)

Summary:
Third PR to figure out how to generate images by graphviz within spinx

- Step 1 Add a debug workflow to figure out the proper solution
  - Shown no warning about missing `dot` command (https://github.com/pytorch/data/actions/runs/3897152397/jobs/6654521346#step:6:399)
- Step 2 remove debug workflow and add `apt-get install graphviz` to make sure the CI machine has `graphviz` and `dot` installed and exposed to cml.

Pull Request resolved: https://github.com/pytorch/data/pull/943

Reviewed By: wenleix, NivekT

Differential Revision: D42463417

Pulled By: ejguan

fbshipit-source-id: f7e3019ba8d86c85e15330c10dd2b6e4362f6c3b",erjia,erjia@fb.com,2023-01-12 15:28:34,"['.github/workflows/_build_test_upload.yml', 'docs/requirements.txt']",False
e9ee0f5d90570168989475e3ee66adb8ef99e6a1,"Execute smoketest for release workflow (#942)

Summary:
To reduce the time spent for release workflow, disable all TorchData test in the release workflows since each PR/main branch should have been tested. There is no need to run an extra round of tests.
And, use smoketest to make sure the compiled TorchData package having all required modules.

Pull Request resolved: https://github.com/pytorch/data/pull/942

Reviewed By: NivekT

Differential Revision: D42454007

Pulled By: ejguan

fbshipit-source-id: ce7aaab555ba399497ec3d243e5cc8cfb5f3eb28",erjia,erjia@fb.com,2023-01-11 20:58:37,"['.github/workflows/_build_test_upload.yml', 'packaging/torchdata/meta.yaml']",False
f608d4f044f81b892174575a4865e87de7551ea1,"Attemp to fix graphviz problem by install pydot (#941)

Summary:
Follow-up PR for https://github.com/pytorch/data/pull/939

The nightly build still can't compile graphviz code to images as shown in https://pytorch.org/data/main/dataloader2.html

Pull Request resolved: https://github.com/pytorch/data/pull/941

Reviewed By: NivekT

Differential Revision: D42453866

Pulled By: ejguan

fbshipit-source-id: dc697a56c8187a8458f2e63b38e6e31f6a7589da",erjia,erjia@fb.com,2023-01-11 19:19:19,['docs/requirements.txt'],False
aa614d72e074c355caccf13ab48509f5bfa544da,"Add graphviz to build doc (#939)

Summary:
Attempt to fix the graph in https://pytorch.org/data/main/dataloader2.html#readingservice
The error is caused by missing dot: https://github.com/pytorch/data/actions/runs/3873159412/jobs/6603384518#step:7:301

Pull Request resolved: https://github.com/pytorch/data/pull/939

Reviewed By: NivekT

Differential Revision: D42426003

Pulled By: ejguan

fbshipit-source-id: 62a44617d19c1ff8dc187ef59b2684afe9dfc0b9",erjia,erjia@fb.com,2023-01-10 19:20:54,['docs/requirements.txt'],False
c0934b9afa96458c0f8aa3bef528830835c22195,"Fixed secret names (#937)

Summary:
Fixed secret names

### Changes

- Set the correct names for secrets.

Pull Request resolved: https://github.com/pytorch/data/pull/937

Reviewed By: NivekT, ejguan

Differential Revision: D42360532

Pulled By: DanilBaibak

fbshipit-source-id: 3061cd2ab385675c3507f9976c1e3cfdc3abea2f",DanilBaibak,danil.baibak@gmail.com,2023-01-05 15:09:48,['.github/workflows/build_wheels_linux.yml'],False
b546786486eb74dac40d73ef5d0fcafa6d50d562,"Add a pre-script to the Linux workflow. (#930)

Summary:
Add a pre-script to the Linux workflow.

### Changes

- Added the pre-script file.

Pull Request resolved: https://github.com/pytorch/data/pull/930

Reviewed By: NivekT, ejguan

Differential Revision: D42310035

Pulled By: DanilBaibak

fbshipit-source-id: bf3ab34470c20d5a50ee8ee6a5b5f73334077a99",DanilBaibak,danil.baibak@gmail.com,2023-01-04 09:15:06,"['.github/workflows/build_wheels_linux.yml', 'packaging/post_build_script_linux.sh', 'packaging/pre_build_script_linux.sh']",False
bcdf874069d00be13715b4f48c68caabb488b2e6,"Forward fix to enable passing dispatching Queue between processes (#935)

Summary:
Due to the issue https://github.com/pytorch/data/issues/934, I can't attach `mp.Queue` to the `_DummyDataPipe` and transfer it to subprocesses when `spawn` or `forkserver` is used.
So, I did the following works

## Changes:
- Extend `process_init_fn` to accept `dispatching_req_queue` and `dispatching_res_queue` without relying on `_DummyDataPipe`
- Add tests to cover all available mp start methods per platform
- A few nit changes in `dataloader2.py` and `reading_service.py` to make sure `Error` is ignored during `__del__`.

Pull Request resolved: https://github.com/pytorch/data/pull/935

Reviewed By: NivekT

Differential Revision: D42271595

Pulled By: ejguan

fbshipit-source-id: eb0fe3787ec91e884ce67d438241d1bb074309f3",erjia,erjia@fb.com,2023-01-04 00:29:37,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/dispatch.py', 'torchdata/dataloader2/utils/worker.py']",False
e15e1453967ce2f25f6fcd2838caadfd0e2fa811,"Add round robin sharding to support non-replicable DataPipe for Multiprocessing (#919)

Summary:
This PR is created on top of https://github.com/pytorch/data/pull/555. And, this PR extends `PrototypeMultiprocessingReadingService` to accept non-replicable DataPipe.

And, this PR depends on https://github.com/pytorch/pytorch/pull/90769

### Main Changes
- Add a way to launch a process to fetch data from non-replicable DataPipes and send data to worker processes in a round-robin manner
  - Add `ShardingRoundRobinDispatcher` (functional name `sharding_round_robin_dispatch`) to indicate non-replicable DataPipe
  - Add `MultipleDataPipesToQueuesLoop` to connect non-sharding process to request/response queues
  - Add `find_lca_non_replicable_dp` as a graph function to determine the lowest common ancestor of all non-replicabble DataPipes. This would guarantee that all non-replicable DataPipes will be running in a single dispatching process
  - In each multiprocessing worker process,
    - If All datapipes are replicable, apply multiprocessing sharding to the graph
    - If not, worker would use `find_replicable_branches` to apply mp sharding to those replicable branches, because all non-replicable branches have been properly sharded by routing data round-robinly to worker processes.
- Properly get `ResetEpochResponse` from protocol via `get_response_reset_epoch`
- [x] Add tests for two graph functions
- [x] Add test to launch non-shardable DataPipe process
- Add documents
  - [x] Replicable DataPipe/Non-replicable DataPipe in multiprocessing
  - [x] How PrototypeMPRS handles the above two types of DataPipe
Please check the link for doc: https://ejguan.github.io/dataloader2.html#dynamic-sharding
## nit Changes
- Rename `Spawn` to `Create` as the process has not been started

Pull Request resolved: https://github.com/pytorch/data/pull/919

Reviewed By: wenleix

Differential Revision: D42004034

Pulled By: ejguan

fbshipit-source-id: 5b0b1cb7c2781c4f45240d21f37d457b9729b9a4",erjia,erjia@fb.com,2022-12-28 15:17:03,"['docs/source/conf.py', 'docs/source/dataloader2.rst', 'test/dataloader2/test_dataloader2.py', 'test/test_graph.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/graph/utils.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/dispatch.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/prefetcher.py', 'torchdata/datapipes/iter/util/sharding.py']",False
a1612ee0c412800882aeec64e006755b7867c49b,"Adapt OSS FullSync for Internal monitoring & error attribution (#933)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/933

Reviewed By: ejguan

Differential Revision: D42120515

fbshipit-source-id: 1804ad0116365bf21b0b7b243f0264467131048f",Yingxin Kang,yingxinkang@meta.com,2022-12-22 18:35:43,['torchdata/datapipes/iter/util/distributed.py'],False
fbee6f75c9e630ea793116caea58911d5ad7d6e0,"Added Linux Workflow (#921)

Summary:
Added Linux Wheels workflow. The workflow will run in shadow mode without upload binaries.

### Changes

- Added Linux Wheels workflow
- Added Linux Conda workflow

### TODO

- [x] Add the `BUILD_S3` env variable. Depend on the PR https://github.com/pytorch/test-infra/pull/1269
- [x] Fixed smoke tests issue for Linux Conda - https://github.com/pytorch/test-infra/pull/1292
- [x] Add smoke test - https://github.com/pytorch/data/pull/923

Pull Request resolved: https://github.com/pytorch/data/pull/921

Reviewed By: ejguan

Differential Revision: D42095186

Pulled By: NivekT

fbshipit-source-id: d9fd667b593706347aef9c7eb41d9c03ba1c314d",DanilBaibak,danil.baibak@gmail.com,2022-12-20 08:30:11,"['.github/workflows/build_conda_linux.yml', '.github/workflows/build_wheels_linux.yml', 'packaging/env-var-script.txt', 'test/smoke_test/smoke_test.py']",False
56ed97e48da9934ce23453fc7b04418b64b02e8a,"Update version compatibility table (#929)

Summary:
Per title
Merge after 0.5.1 becomes available

Pull Request resolved: https://github.com/pytorch/data/pull/929

Reviewed By: NivekT

Differential Revision: D42039136

Pulled By: ejguan

fbshipit-source-id: 47691082825c29ec4b602dbd57f77918f0b87d6b",erjia,erjia@fb.com,2022-12-16 21:24:45,['README.md'],True
0a0ae5d35be439c786c9ab798ea1596238d8640a,"Add smoke test (#923)

Summary:
Per title.
Smoke test will be used by project Nova to test compiled TorchData

Pull Request resolved: https://github.com/pytorch/data/pull/923

Reviewed By: NivekT

Differential Revision: D42011265

Pulled By: ejguan

fbshipit-source-id: 16a1b67ae1eeadb8484219b9767725ee9687bb78",erjia,erjia@fb.com,2022-12-14 15:20:48,['test/smoke_test/smoke_test.py'],True
9e217f7154c2ed96d95e9d9eb9152178a4e0c6a2,"Attemp to fix flaky [Connection refused] failure for elastic test (#920)

Summary:
Add `dl.shutdown` to destroy the distributed process group. This potentially fixes the problem that the port is taken up by other process group.

Pull Request resolved: https://github.com/pytorch/data/pull/920

Reviewed By: NivekT

Differential Revision: D41954364

Pulled By: ejguan

fbshipit-source-id: ec93f7306cd828976b0bc0c80ca5ae2bf12768d1",erjia,erjia@fb.com,2022-12-12 18:07:47,['test/bin/elastic_training.py'],False
ab04b09bad5a4b57a04841adfde0470481c89e0b,"Record elastic worker error (#918)

Summary:
### Changes

- Record worker error to figure out what's wrong with our nightly release pipeline (https://github.com/pytorch/data/actions/workflows/nightly_release.yml)
  - All commits work fine in the PR time. But, after they are anded, the nightly CI becomes broken due to this unknown elastic launch issue
- Add standalone flag as recommended by `torchelastic`
- Remove `skip` windows as the issue has been fixed

Pull Request resolved: https://github.com/pytorch/data/pull/918

Reviewed By: NivekT, dahsh

Differential Revision: D41874617

Pulled By: ejguan

fbshipit-source-id: b22d0348c0c1b6a289718366002ebd6abef82f08",erjia,erjia@fb.com,2022-12-09 21:19:43,"['test/bin/elastic_training.py', 'test/test_distributed.py']",False
248ecfec3c482fbab6d0b81f8cf46aa1db3f9e95,"Prevent reset iteration message sent twice to workers (#917)

Summary:
Remove `end_datapipe.reset()` as it's going to be invoked at the beginning of iteration.
nit change: move `mp_ctx` creation out of loop

Pull Request resolved: https://github.com/pytorch/data/pull/917

Reviewed By: NivekT, dahsh

Differential Revision: D41842138

Pulled By: ejguan

fbshipit-source-id: 3b83635a920ed2301457733d6cdbaf3c75e64ebd",erjia,erjia@fb.com,2022-12-08 22:28:41,"['torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/header.py']",False
14888a362727f9f52d3b86bae7409391a26689aa,"Apply sharding based on priority & combine DistInfo and ExtraInfo (#916)

Summary:
After https://github.com/pytorch/pytorch/pull/88424 is landed, we are able to invoke `apply_sharding` by sharding levels (distributed or multiprocessing). Then, we are able to give fine-control on sharding by `ReadingService`.
- For `DistributedReadingService`, we will only set sharding on the distributed level
- For `PrototypeMPReadingService`, we will set distributed sharding in the main process and set mp sharding in the worker processes. Previously, we set sharding in each worker process based on both distributed and mp information.
  - `worker_init_fn` doesn't need `DistInfo` anymore. As, the `DataPipe` has been distributed sharded in the main process.
  - Combine `DistInfo` and `ExtraInfo` for `worker_reset_fn` to synchronize the distributed seeds across distributed workers and set worker-local seeds based on both distributed and mp information.

Pull Request resolved: https://github.com/pytorch/data/pull/916

Reviewed By: mingyuzh

Differential Revision: D41776719

Pulled By: ejguan

fbshipit-source-id: 6042da09f5e83019d536696237028ea20e67d110",erjia,erjia@fb.com,2022-12-07 14:49:26,"['docs/source/dataloader2.rst', 'test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/__init__.py', 'torchdata/dataloader2/utils/worker.py']",False
c87cfb856b7a72a6bad88f24da7c738d72d80c73,"Make HeaderIterDataPipe with limit=None a no-op (#908)

Summary:
Fixes https://github.com/pytorch/data/issues/762

### Changes

- Passing limit=None makes the HeaderIterDataPipe a no-op

Pull Request resolved: https://github.com/pytorch/data/pull/908

Reviewed By: ejguan

Differential Revision: D41689658

Pulled By: NivekT

fbshipit-source-id: 6a478f65269683785bf39d67d423f499fc3a8ed2",Felix Neumann,felix.neumann-ext@rio.cloud,2022-12-06 20:17:26,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/util/header.py']",False
4dd62b2be5cd5e62cd906ad3f74461d20d9e3f57,"Add tests to valdiate iteration over combining DataPipe with infinite input (#912)

Summary:
Add a few tests to validate the iterator is properly cleanup at the end of iteration, when the combining `DataPipe` takes input with infinite length like`cycle(None)`

Those tests should be timed out until https://github.com/pytorch/pytorch/pull/89974 is promoted to the nightly releases.

Pull Request resolved: https://github.com/pytorch/data/pull/912

Reviewed By: NivekT

Differential Revision: D41740935

Pulled By: ejguan

fbshipit-source-id: b501ea4290f5d75984f12f9e2fb3d3897297de2b",erjia,erjia@fb.com,2022-12-06 19:40:01,['test/test_iterdatapipe.py'],True
5d0ed4abd69d171a4a0d5f68df156d8b6c3534a6,"Fix CI to use stable numpy and networkx (#913)

Summary:
Fixes torchvision broken CI caused by pre-release `numpy`.

In our CI, we install `torch` using `--pre` flag, which will make `pip` to use pre-release `numpy` and `networkx`. I have reported to TorchVision about the issue so they should be able to start to investigate how to prevent the problem when `numpy` promotes this release version to stable. For TorchData side, to mitigate the problem, the CI should use stable `numpy`.

Pull Request resolved: https://github.com/pytorch/data/pull/913

Reviewed By: NivekT

Differential Revision: D41748576

Pulled By: ejguan

fbshipit-source-id: 182019e43272cd53dfce8eb8880de9a6d2903c64",erjia,erjia@fb.com,2022-12-06 15:42:07,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml']",True
b3a6571fab2d40e3ba64e53686ff4168af61f4f0,"Properly cleanup unclosed files within generator function (#910)

Summary:
There is a case that `file.close` is never called because when generator function has never reached to the end. A simple example would be `zip` two datepipes with different length. The longer DataPipe would never reach the end of generator and then it will be cleaned up by `gc`. So, the line of `file.close` is not executed. (This is the reason that Vitaly has to create this [hack](https://github.com/pytorch/pytorch/blob/4451eb24e6287dff62ff8a7ec0eda6a6998807b0/torch/utils/data/datapipes/iter/combining.py#L573-L583) to retrieve all remaining data to make sure generator function is fully executed)

However, this hack introduces another problem where an infinite datapipe would make `zip` never end as it would try to deplete the infinite iterator. See: https://github.com/pytorch/data/issues/865

So, in this PR, I am adding a `try-finally` clause to make sure the `file.close` is always executed during the destruction of `generator` object. Then, we don't need the hack within `zip` any more.

- https://github.com/pytorch/pytorch/pull/89973
- https://github.com/pytorch/vision/pull/6997
- https://github.com/pytorch/pytorch/pull/89974

Pull Request resolved: https://github.com/pytorch/data/pull/910

Reviewed By: wenleix, NivekT

Differential Revision: D41633909

Pulled By: ejguan

fbshipit-source-id: 5613e131dc8b2962c22d2bc7e3a4bb3039440c48",erjia,erjia@fb.com,2022-12-05 16:39:26,"['torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/decompressor.py', 'torchdata/datapipes/iter/util/plain_text_reader.py', 'torchdata/datapipes/iter/util/rararchiveloader.py']",False
45bc070c531865540c55b81859a49f5ee3ba7180,"Add worker_init_fn and worker_reset_fn to ProtoMPRS (#907)

Summary:
### Changes

- Add `worker_init_fn` and `worker_reset_fn` to `PrototypeMultiprocessingReadingService`. This should help `SequentialRS` to extend `worker_reset_fn` per epoch (still need to hack by assigning `worker_reset_fn` manually)
- Move `_process_init_fn` and `_process_reset_fn` and move random number/tensor generation to `torchdata.dataloader2.utils`
- Instead of using explicit arguments for `init_fn` or `reset_fn`, add `DistInfo` and `WorkerInfo` to pass relevant information to worker. This should help extensibility to add extra information to those `Info` class
-

Pull Request resolved: https://github.com/pytorch/data/pull/907

Reviewed By: wenleix, mingyuzh, Miiira

Differential Revision: D41504783

Pulled By: ejguan

fbshipit-source-id: 1d721774b3224d5a5550a1275225b449541ba8c9",erjia,erjia@fb.com,2022-11-30 02:22:28,"['benchmarks/cloud/aws_s3.py', 'docs/source/dataloader2.rst', 'test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/map.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/graph/settings.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/utils/__init__.py', 'torchdata/dataloader2/utils/random.py', 'torchdata/dataloader2/utils/worker.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
dcbaa44e8ab2cc4faaceecb602421ba0a9feac78,"Deprecating DataPipes (#89794)

Summary:
X-link: https://github.com/pytorch/pytorch/pull/89794

Pull Request resolved: https://github.com/pytorch/data/pull/909

per title

Reviewed By: wenleix, NivekT

Differential Revision: D41563765

fbshipit-source-id: e5006768cdce9c1da1204b4258a965de5ab1aa38",Erjia Guan,erjia@meta.com,2022-11-29 19:14:20,"['torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py']",False
335eaaa59c86a3b2481c3b5d79a03c8a2d0c990a,"Move serialization functions to graph and add clone function (#897)

Summary:
### Changes

- Move `_wrap_and_copy_dp` and `_copy` from DataLoader2 to graph module -> clean up `dataloader2.py`
- Add `clone` function. (This is going to be used by `Prototyping2RS`)

Pull Request resolved: https://github.com/pytorch/data/pull/897

Reviewed By: wenleix

Differential Revision: D41472860

Pulled By: ejguan

fbshipit-source-id: a41621bbe5c7545fe90a0e4161d18c1e0dc26828",erjia,erjia@fb.com,2022-11-22 20:07:23,"['torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/graph/_serialization.py']",False
d218f79b36758998fe512ace9fd30f68b9b4d1b3,"Add RoundRobinDemux (#903)

Summary:
The only reason I added this DataPipe without directly using `enumereate().demux().drop_index()` is this `RoundRobinDemux` should provide a valid length. So, this PR needs https://github.com/pytorch/pytorch/pull/89216 landed

And, this DataPipe will be used for `Proto2RS`.

Side change: Move `Unzip` to `combining.py` as well.

Pull Request resolved: https://github.com/pytorch/data/pull/903

Reviewed By: wenleix

Differential Revision: D41387813

Pulled By: ejguan

fbshipit-source-id: b3a5939763b53875dd223809041ad8d0337b1bda",erjia,erjia@fb.com,2022-11-21 19:39:18,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'tools/gen_pyi.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/unzipper.py']",False
67afe0c36f5f93d34fde7026e7e95835c1160bb3,"Fix tests for Azure and DataLoader (#905)

Summary:
### Changes

- For Azure test: Please see https://github.com/pytorch/data/issues/904
- For DataLoader test, https://github.com/pytorch/pytorch/pull/88972 introduces an Error when `prefetch_factor` is specified when `num_workers>0`.

Pull Request resolved: https://github.com/pytorch/data/pull/905

Reviewed By: wenleix

Differential Revision: D41403018

Pulled By: ejguan

fbshipit-source-id: 7f1d0677a7311b5c7b3d72b86501301d7a68e7a7",erjia,erjia@fb.com,2022-11-19 04:20:46,"['test/test_remote_io.py', 'torchdata/dataloader2/reading_service.py']",False
d55f9ee6f79c8ce0720e94a5354e659f245938cc,"Deep copy ReadingService during DL2 initialization (#746)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/746

By creating a deep copy of the input `ReadingService` during the initialization of `DataLoader2`, we allow the instance of `ReadingService` to store state without worrying about the users passing the same `ReadingService` to initialize additional DataLoaders.

For instance, `PrototypeMultiProcessingReadingService` stores `processes` and `datapipes` as instance variables. If a single object of that ReadingService is used to initialize multiple DataLoaders, it can led to conflicts and incorrect states. This should no longer be an issue with this change.

Relevant test are added in subsequent PR related to lengths and eventually `PrototypeMultiprocessingReadingService`.

Test Plan:
Imported from OSS

E2E Tests: https://docs.google.com/document/d/1ohHWz1ohAwgktwrBjNIHaWq4XJd4xSgN45vUdLFxaso/edit?usp=sharing
- PyPer disagg
- PyPer onbox
- PyPer checkpoint restore
- MVAI: fire-yingxinkang-20221116-1530-7a67261f

Reviewed By: Miiira

Differential Revision: D38868731

Pulled By: NivekT

fbshipit-source-id: e07eba7c7cda325d7eafc59276d6ac1471f3276c",Kevin Tse,ktse@fb.com,2022-11-17 22:50:09,"['torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
7d23e218bf806c9dbb012d91338eae26c45e6eb7,"Add setting function to set seeds to the graph (#894)

Summary:
### Changes

- Update `list_dps` ~with a new argument (`exclusive`)~ to make sure all `DataPipes` will be excluded even though they are the predecessors of the non-excluded `DataPipe`.
- Update `list_dps` to use BFS to return the list of `DataPipes`.
- Add `_set_worker_seed_for_dp_graph ` to set seeds for `DataPipes` before `sharding_filter` with the same seed generator and set different seeds for `DataPipes` after `sharding_filter` with the worker-local seed generator.

Pull Request resolved: https://github.com/pytorch/data/pull/894

Reviewed By: NivekT

Differential Revision: D41282334

Pulled By: ejguan

fbshipit-source-id: 6074e5a0ed22441b7ca1a412df7ede800213a7ac",erjia,erjia@fb.com,2022-11-17 22:26:30,"['test/dataloader2/test_random.py', 'test/test_graph.py', 'torchdata/dataloader2/graph/settings.py', 'torchdata/dataloader2/graph/utils.py']",False
e79ff429aa58abe6aaa0595d971b498b94d62f9c,"Fix azure test (#902)

Summary:
Fix bug introduced by https://github.com/pytorch/data/pull/849

- Replace `skipIfNoFSSpecS3` by `skipIfNoFSSpecAZ` for tests to access Azure Blob
- Add `adlfs` to conda test requirements.

Pull Request resolved: https://github.com/pytorch/data/pull/902

Reviewed By: NivekT

Differential Revision: D41378561

Pulled By: ejguan

fbshipit-source-id: be99d1371379e1c87c2f2ac062b009f88575aa0a",erjia,erjia@fb.com,2022-11-17 18:33:49,"['test/requirements.yml', 'test/test_remote_io.py']",True
594b30e98006ef27ba9de69cb5630c61f3a38c35,"Fix is_local for paths starting with `az://` (#849)

Summary:
Signed-off-by: Marco Pfirrmann <marco.pfirrmann@tngtech.com>

Fixes https://github.com/pytorch/data/issues/840.
The module used to extract the protocol does not differentiate between `abfs://` and `az://` paths, always returning `abfs`. This fix adds `az` to the protocol list to be checked.

Pull Request resolved: https://github.com/pytorch/data/pull/849

Reviewed By: wenleix

Differential Revision: D41345945

Pulled By: NivekT

fbshipit-source-id: 229a2176c5370129192e0c1a458312142cb75b1a",Marco Pfirrmann,marco.pfirrmann@tngtech.com,2022-11-16 21:01:03,"['test/requirements.txt', 'test/test_remote_io.py', 'torchdata/datapipes/iter/load/fsspec.py']",False
daa2fc9e9d6f5965618cf026a6e2feda93a16690,"Fix S3FileLoader local file clobbering (#895)

Summary:
Fixes https://github.com/pytorch/data/issues/735; remove unnecessary call to `storeFile()`, a remnant from the `aws-doc-sdk-examples` `transferOnStream.cpp` example, where this function is used to verify the buffer's contents: https://github.com/awsdocs/aws-doc-sdk-examples/blob/main/cpp/example_code/transfer-manager/transferOnStream.cpp#L131

### Changes

- remove unnecessary call to `storeFile()`

### Testing

Verified files are no longer clobbered through local testing

Pull Request resolved: https://github.com/pytorch/data/pull/895

Reviewed By: NivekT

Differential Revision: D41316304

Pulled By: ejguan

fbshipit-source-id: ec493aaf312be79d90561e30d85190cfe2423ded",Matthew Hoffman,matthew@protopia.ai,2022-11-16 03:39:25,['torchdata/csrc/pybind/S3Handler/S3Handler.cpp'],True
2dfdcfb861971f08d5a0673ce17d6a979bc5de8d,"Fix tests to access S3 (#896)

Summary:
Fixes failed tests as the open-sourced Dataset has changed.

Pull Request resolved: https://github.com/pytorch/data/pull/896

Reviewed By: NivekT

Differential Revision: D41309257

Pulled By: ejguan

fbshipit-source-id: 9c106a4dc5d4541c7fe402b24b68eeb8149fdd11",erjia,erjia@fb.com,2022-11-15 18:22:07,['test/test_remote_io.py'],False
8b373ec1a38241dff83b8ed43518d9ecb43f835f,"Small clean up and comments for PrototypeRS (#878)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/878

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D41239330

Pulled By: NivekT

fbshipit-source-id: 0f73e32c6d6e1a9392036e6f462e2f9497236222",Kevin Tse,ktse@fb.com,2022-11-14 22:21:55,"['test/test_distributed.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/map.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/distributed.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
31469aa9ddcbf7bb3c36561609d3b4ef011fc452,"Moving a few tests from Core to TorchData (#892)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/892

These tests are removed from Core in https://github.com/pytorch/pytorch/pull/88848

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D41204079

Pulled By: NivekT

fbshipit-source-id: c913e6a0eac1f0170abdec53ebc04bd880c6e62b",Kevin Tse,ktse@fb.com,2022-11-12 00:07:26,['test/dataloader2/test_dataloader2.py'],False
b2ca33d27838da4e189bc4c8f3704b11822dd593,"Add graph function to list DataPipes from graph (#888)

Summary:
Add a `list_dps` function to list `DataPipes` from the graph.
- It's similar to [`get_all_graph_pipes `](https://github.com/pytorch/pytorch/blob/896fa8c5c9b0191c9621e04ab5e20057614d48ad/torch/utils/data/graph_settings.py#L19) from pytorch core
- An extra argument of `exclude_dps` to exclude the `DataPipe` and its prior graph from the result.

Reason to add this function:
- It's required to set random states differently for DataPipe before/after `sharding_filter`
```py
graph = traverse_dps(datapipe)
sf_dps = find_dps(graph, ShardingFilter)

# DataPipes prior to `sharding_filter`
p_dps = []
for sf_dp in sf_dps:
    p_dps.extend(list_dps(traverse_dps(sf_dp)))

# DataPipes after `sharding_filter`
a_dps = list_dps(graph, exclude_dps=sf_dps)
```

Step 1 for https://github.com/pytorch/data/issues/885

Pull Request resolved: https://github.com/pytorch/data/pull/888

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D41099171

Pulled By: ejguan

fbshipit-source-id: d9d6e7beb498fea3921d8a3a1020649dd3955ce2",erjia,erjia@fb.com,2022-11-11 01:13:37,"['docs/source/dataloader2.rst', 'test/test_graph.py', 'torchdata/dataloader2/graph/__init__.py', 'torchdata/dataloader2/graph/utils.py']",True
59d146263546d442e492f178717f0b6a2e15dec4,"Fix GHA warning and align mypy version to pytorch core (#891)

Summary:
- Follow up work after https://github.com/pytorch/data/pull/889
- Update `mypy` version during testing to `0.960` as PyTorch Core https://github.com/pytorch/pytorch/blob/4b898a7304246275b250b159dd0ac8e68a6df95d/.circleci/docker/requirements-ci.txt#L83

Pull Request resolved: https://github.com/pytorch/data/pull/891

Reviewed By: NivekT, dahsh

Differential Revision: D41189285

Pulled By: ejguan

fbshipit-source-id: 5664fe680c5e4b10682888e07680b5f45c86a006",erjia,erjia@fb.com,2022-11-10 23:17:12,"['.github/workflows/_build_test_upload.yml', '.github/workflows/lint.yml', 'mypy.ini', 'torchdata/datapipes/iter/util/tfrecordloader.py']",True
bf0841039d1cc6e18af19a07945e6719ae8ba8bc,"Deprecating certain functional APIs and fix an Error msg (#890)

Summary:
- Continue to deprecate stuff based on https://github.com/pytorch/data/issues/163
- Fix a typo

Pull Request resolved: https://github.com/pytorch/data/pull/890

Reviewed By: NivekT

Differential Revision: D41130080

Pulled By: ejguan

fbshipit-source-id: d8c1a6a4732211fcf75a08d5cb5e090a587b555b",erjia,erjia@fb.com,2022-11-09 02:01:33,"['torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/util/converter.py']",True
7127ebc83d253061d563b7002cd9b9fd5adc7209,"Fix GHA deprecation warnings (#889)

Summary:
Update gha package versions to prevent deprecation warnings in CI

Pull Request resolved: https://github.com/pytorch/data/pull/889

Reviewed By: VitalyFedyunin, NivekT, dahsh

Differential Revision: D41126253

Pulled By: ejguan

fbshipit-source-id: 3be71eccd13f7a467fcb44827895eb7a6b25b2e3",erjia,erjia@fb.com,2022-11-08 18:07:07,['.github/workflows/_build_test_upload.yml'],True
d5a5940ae8fc5edb3e754bd3cb7b6cd885ba66b7,"Add a masks option to filter files in s3 datapipe (#880)

Summary:
Add a new option to the constructor of `S3FileListerIterDataPipe` that allows to filter the list of files with a pattern, using the existing filter function `match_masks`.

I added a unit test for the s3 datapipe and I tested it on my machine with a real S3 bucket.

Fixes https://github.com/pytorch/data/issues/737.

Pull Request resolved: https://github.com/pytorch/data/pull/880

Reviewed By: ejguan

Differential Revision: D41033071

Pulled By: NivekT

fbshipit-source-id: c8f239811aab4a640a1d838889181a2ba6a22a59",Sebastian Thomas,sebastian.thomas@tngtech.com,2022-11-08 16:24:36,"['test/test_local_io.py', 'test/test_s3io.py', 'torchdata/datapipes/iter/load/s3io.py']",True
470ce4606871b8780ab5d29a279dcb21670ead18,"update load_state_dict() signature to align with torchsnapshot (#887)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/887

Checkpointing relies on some protocol checking to make sure it takes `Checkpointable` modules.

The canonical protocol currently requires `def load_state_dict(self, state_dict: Dict[str, Any]) -> None:` but DLv2's positional argument is `state` instead.

So even though logically everything works this breaks static type checking, creating confusion to users.

See signature
https://github.com/pytorch/torchsnapshot/blob/28ce508ceb1db0a4f16c269b776fe88216e340f5/torchsnapshot/stateful.py#L14

Reviewed By: Miiira

Differential Revision: D41094635

fbshipit-source-id: 9a0f6d11c9f96ddf7fe134a5ea67a1030c34352f",Shawn Xu,sxu0@meta.com,2022-11-08 02:14:07,['torchdata/dataloader2/dataloader2.py'],True
5d460c54e573b499c11c279df2a07b509d089e35,"Fix max_token_bucketize to accept incomparable data (#883)

Summary:
Fixes https://github.com/pytorch/data/issues/881

- Add `PrioritizedItem` to store data and token_length for the sake of incomparable data type.
- Change the test to validate the length rather than exact data because the data itself won't be ordered in `heapq`.

Pull Request resolved: https://github.com/pytorch/data/pull/883

Reviewed By: NivekT

Differential Revision: D41031446

Pulled By: ejguan

fbshipit-source-id: 9810bc891a18a7c171513c3426d3a2cf8a2cd6e5",erjia,erjia@fb.com,2022-11-07 21:32:49,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py']",True
b1b3406389fa6665ec3422ae5e1ebf65ae7e2938,"Skip CI test to load S3 dataset on M1 due to permission denied (#882)

Summary:
Fixes https://github.com/pytorch/data/issues/875

Pull Request resolved: https://github.com/pytorch/data/pull/882

Reviewed By: NivekT

Differential Revision: D41028025

Pulled By: ejguan

fbshipit-source-id: 8a88da3be5b923705bbc0bfa76e4fe270803dd71",erjia,erjia@fb.com,2022-11-04 14:37:52,['test/test_remote_io.py'],False
55311d4e2309c95910690527e3c48120e940dbef,"Make lengths of DataPipe dynamic (#873)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/873

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D40962187

Pulled By: NivekT

fbshipit-source-id: 2daff2b55e9e6f5ce548ac5cda95dbe7095020cc",Kevin Tse,ktse@fb.com,2022-11-03 22:59:14,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/converter.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/mux_longest.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/zip_longest.py']",False
5fd2302be3ef5d6ea862f91ace2bc9805255bed6,"Fix `to_graph` DataPipeGraph visualization function (#872)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/872

Fixes #869 and adds tests to ensure `to_graph` can execute without raising exception

Test Plan: Imported from OSS

Reviewed By: dahsh, ejguan

Differential Revision: D40956306

Pulled By: NivekT

fbshipit-source-id: e62a473473ce194156cb5337161eb840b46ea723",Kevin Tse,ktse@fb.com,2022-11-03 20:46:23,"['test/requirements.txt', 'test/test_graph.py', 'torchdata/datapipes/utils/_visualization.py']",False
15b2b3109b12e4d8f74d9ef1f80db02445ac8a97,"Deprecate set-output based on github instruction (#861)

Summary:
Follow https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/

Pull Request resolved: https://github.com/pytorch/data/pull/861

Reviewed By: NivekT, dahsh

Differential Revision: D40682844

Pulled By: ejguan

fbshipit-source-id: e70ca9f26b4710900ea348576d9828a2a3b5d65d",erjia,erjia@fb.com,2022-11-02 21:14:52,"['.github/workflows/_build_test_upload.yml', '.github/workflows/aistore_ci.yml', '.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml']",False
340ad4a969bdc9ca6088e1c466b7704e7680e024,"Forward fix adapters applied to None DataPipe (#870)

Summary:
Per title. This is a forward fix of https://github.com/pytorch/data/pull/867

Pull Request resolved: https://github.com/pytorch/data/pull/870

Reviewed By: NivekT

Differential Revision: D40896052

Pulled By: ejguan

fbshipit-source-id: c970402a7ba99e44bf15980029bbe89b33a99c24",erjia,erjia@fb.com,2022-11-01 20:48:12,['torchdata/dataloader2/dataloader2.py'],False
b1f5e7cf88b6ab7f408aca38f3dd9191c9fc505a,"Consolidate checkpoint contract with checkpoint component (#867)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/867

`load_state_dict` should be used with `None` datapipe input to avoid confusion: datapipe inside state dict will be the ground truth in reading

Reviewed By: xunnanxu

Differential Revision: D40734262

fbshipit-source-id: f118f2ccb1fa0748dfe302b20e7d4306120e2320",Yingxin Kang,yingxinkang@meta.com,2022-10-31 00:10:40,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/dataloader2.py']",False
4ea88d1fb4d279def9213a23b054b4e7d46d5b3d,"RFC for using sphinx doctest (#850)

Summary:
RFC for using sphinx doctest and continously migrating the doctest code to being tested

Fixes https://github.com/pytorch/data/issues/848

### Changes

-   Updated `docs/Makefile` with a `doctest` target
-   Enabled the sphinx extension `sphinx.ext.doctest` in `docs/source/conf.py`
-   A minimal example of an updated docstring in `torchdata/dataloader2/adapter.py`
-   Adding the `doctest` step to the CI in `.github/workflows/_build_test_upload.yml`

Pull Request resolved: https://github.com/pytorch/data/pull/850

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D40761602

Pulled By: ejguan

fbshipit-source-id: 88fef87f33d3983110a3d1b5bb409081b912a624",Mathias Burger,mathias.burger@tngtech.com,2022-10-27 20:45:44,"['.github/workflows/ci.yml', 'docs/Makefile', 'docs/source/conf.py', 'torchdata/dataloader2/adapter.py']",False
adf0e76cd07e5bd1722138095e4347f83114f8c2,"Update version matrix & setup.py (#862)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/862

Reviewed By: dahsh

Differential Revision: D40682813

Pulled By: ejguan

fbshipit-source-id: 6ceb4e67beee2c1cb6fd09026e710ef32a8a7277",erjia,erjia@fb.com,2022-10-27 20:44:42,"['README.md', 'setup.py']",True
021628ab34996a0754dac1f0789849da1e5faaa5,"Add distributed reading service dataloader2 train loop (#863)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/863

* Add the uscase of DataLoader2 with the distributed reading service with the train loop. We plan to have
 the examples to showcase the advantages:
(1) The usage of the DLv2 with popular open source dataset.
(2) Integrate datasets/datapipes with different reading service.
(3) Datapipe manipulation for example batch, collate, map.
(4) Dist usage and examples with features such as sharding_filter for the sharding feature.
(5) Eventually add those examples to the pytorch tutorials.

Reviewed By: NivekT, ejguan

Differential Revision: D40320257

fbshipit-source-id: 65547822e9ef2b5e2391d68f2683358dc34f5e05",Danny Huang,dannyhuang@meta.com,2022-10-26 21:42:02,['examples/dataloader2/train_loop_distributed_reading_service.py'],False
4d694ae9809dbbf2521b0e625ccd3f168a727d62,"Forward fix shard expander linting (#864)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/864

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40725049

Pulled By: NivekT

fbshipit-source-id: d44d500aac72b2dff93ca1d9f39963ee6661a121",Kevin Tse,ktse@fb.com,2022-10-26 21:05:09,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/shardexpander.py']",True
9aa52ad21d08b0acafd167acbe9d4bbfd5941c35,"Adding minimal, reproducible AWS S3 benchmark (#847)

Summary:
Stack from [ghstack](https://github.com/ezyang/ghstack):
* __->__ https://github.com/pytorch/data/issues/847

Pull Request resolved: https://github.com/pytorch/data/pull/847

Reviewed By: ejguan

Differential Revision: D40721960

Pulled By: NivekT

fbshipit-source-id: b535f258192d0aac4eff30e7a604fb4512ec7947",Kevin Tse,ktse@fb.com,2022-10-26 17:28:45,"['benchmarks/cloud/aws_s3.py', 'benchmarks/cloud/aws_s3_results.md', 'benchmarks/cloud/result_images/aws_s3_high_complex.jpg', 'benchmarks/cloud/result_images/aws_s3_low_complex.jpg', 'benchmarks/cloud/result_images/aws_s3_med_complex.jpg', 'mypy.ini']",False
6e5ca40cce992b45ad2c89eb4a71c2de57fd6fc3,"shard expander (#405)

Summary:
This PR adds a ShardExpander filter, a filter that will take shard specs of the form ""prefix-{000..999}.tar"" and expand them into the 1000 corresponding file names, like the shell brace expansion. This only implements numerical range expansion (rather than full shell-style brace expansion).

Specifying collections of files in terms of numerical shard specs (instead of using classes like FileLister) has a number of advantages: (1) it does not require the ability to list files on the target (not possible in general for, for example, HTTP), (2) it documents and makes specifying a collection of files reproducible and independent of the state of the storage system, (3) it makes it easy to choose different dataset sizes by specifying different numerical subranges.

ShardExpander is frequently used with WebDataset to specify collections of training shards.

Pull Request resolved: https://github.com/pytorch/data/pull/405

Reviewed By: ejguan

Differential Revision: D40718047

Pulled By: NivekT

fbshipit-source-id: b09af2775b325b48806f9740d91a0b48e127c2af",Tom,tmbdev@gmail.com,2022-10-26 17:04:11,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/shardexpander.py']",False
55da524b646c1d992a65518ec56872ac2184a879,"Enable Conda release with manylinux image (#859)

Summary:
Fixes: https://github.com/pytorch/data/issues/844

This is validated by the release workflow from TorchText.

Pull Request resolved: https://github.com/pytorch/data/pull/859

Reviewed By: NivekT

Differential Revision: D40650871

Pulled By: ejguan

fbshipit-source-id: d645a75f1c4200857cb0d5d74360ee618a170ac4",erjia,erjia@fb.com,2022-10-25 02:49:08,"['.github/workflows/_build_test_upload.yml', 'test/requirements.yml']",False
5fdfc9230687f35381c159bd6673316325073ffa,"Temporarily skip distributed testing for ProtoMPRS on Windows (#858)

Summary:
See the issue https://github.com/pytorch/data/issues/857

Pull Request resolved: https://github.com/pytorch/data/pull/858

Reviewed By: NivekT, dahsh

Differential Revision: D40646733

Pulled By: ejguan

fbshipit-source-id: 346151425cab53a236079311adee8a8d6364b0f4",erjia,erjia@fb.com,2022-10-25 01:24:00,"['test/dataloader2/test_random.py', 'test/test_distributed.py']",True
3aac1acbff9f3489d22503c72e5b4e6fa1995ca6,"Ensure finalize and finalize_iteration are called during shutdown/exception (#846)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/846

Fixes #821

1. Ensure `finalize_iteration` is called during `DataLoader2.shutdown()`
2. If an uncaught exception is raised by `DataLoader2Iterator.next()`, ensure finalization calls are made

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40569566

Pulled By: NivekT

fbshipit-source-id: f0768a62fcc6dfba1aef3a70c8c55563a45304aa",Kevin Tse,ktse@fb.com,2022-10-21 15:59:37,['torchdata/dataloader2/dataloader2.py'],False
5575cc98655b58204b781ed362003496df4e14a0,"Handle empty queue exception (#785)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/785

Fixes #625
Fixes #627
Fixes #628

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D40517690

Pulled By: NivekT

fbshipit-source-id: a95b921dbdb9737d67a912f200cb674acefbad90",Kevin Tse,ktse@fb.com,2022-10-21 00:26:22,['torchdata/dataloader2/communication/protocol.py'],False
938eb3da72cb2c2a71dbcfcdbbff56b8994a3c46,"Update Prefetcher buffer to use deque (#842)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/842

This was one of the TODOs in Prefetcher. It makes the implementation cleaner, marginally faster (but not enough to make a significant difference).

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D40517618

Pulled By: NivekT

fbshipit-source-id: a199c06b060a83e087a3cac17ec57c87a7127c40",Kevin Tse,ktse@fb.com,2022-10-20 19:05:04,['torchdata/datapipes/iter/util/prefetcher.py'],False
222877d479a6b2c6ed0348c2039e8515ae5ccfb5,"Adding random_split example to tutorial (#843)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/843

`random_split` is one of the most commonly used functionality. It will useful to include that in the tutorial such that users don't try to use `torch.utils.data.random_split` with `IterDataPipe`.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40532302

Pulled By: NivekT

fbshipit-source-id: a9bcd9a000eaa62e0a624d27febf5081ba0d0e33",Kevin Tse,ktse@fb.com,2022-10-20 14:29:04,"['docs/source/tutorial.rst', 'torchdata/datapipes/iter/util/randomsplitter.py']",False
5ad07aeaef1301f55931489bf8f875f57768380c,"Simplify long type names (#838)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/838

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40488573

Pulled By: NivekT

fbshipit-source-id: e3473525efcb267d91877d6d79cb894a7a043a68",Kevin Tse,ktse@fb.com,2022-10-19 17:32:06,['docs/source/conf.py'],False
72d067d21896af62b9770da0adb76b09ebc43ae4,"Add docs on accessing Azure blob storage through fsspec (#836)

Summary:
### Changes

Adding an example of DataPipe usage with Azure Blob storage via `fsspec`, similar to https://github.com/pytorch/data/pull/812. The example is placed into a new section in `docs/source/tutorial.rst`

Here is the screenshot showing that code snippets in the tutorial work as expected:

<img width=""1569"" alt=""Screenshot 2022-10-18 at 19 33 49"" src=""https://user-images.githubusercontent.com/23200558/196503562-034162c0-6dde-4749-adc7-5e081ff2c19f.png"">

####  Minor note

Technically, `fsspec` [allows both path prefixes `abfs://` or `az://`](https://github.com/fsspec/adlfs/blob/f15c37a43afd87a04f01b61cd90294dd57181e1d/README.md?plain=1#L33) for Azure Blob storage Gen2 as synonyms. However, only `abfs://` works for us for the following reason:
- If a path starts with `az`, the variable `fs.protocol` [here](https://github.com/pytorch/data/blob/768ecdae8b56af640a78e29f82864dc4f65df371/torchdata/datapipes/iter/load/fsspec.py#L82) is still `abfs`
- So the condition `root.startswith(protocol)` is false, and `is_local` is true
- As a result the path ""doubles"" in [this line](https://github.com/pytorch/data/blob/768ecdae8b56af640a78e29f82864dc4f65df371/torchdata/datapipes/iter/load/fsspec.py#L95), like on this screenshot:
<img width=""754"" alt=""Screenshot 2022-10-18 at 19 50 56"" src=""https://user-images.githubusercontent.com/23200558/196506965-697eb2d7-8f84-4536-972b-7081e55e1ff5.png"">

This won't have any effect for the users, however, as long as they use `abfs://` prefix recommended in the tutorial

Pull Request resolved: https://github.com/pytorch/data/pull/836

Reviewed By: NivekT

Differential Revision: D40483505

Pulled By: sgrigory

fbshipit-source-id: f03373aa4b376af8ea2ac3480fc133067caaa0ce",Grigory Sizov,grigorysizov@fb.com,2022-10-19 15:21:20,['docs/source/tutorial.rst'],False
4b98d7a61e69be586853a7e04f3d0d83b1d3a788,"Moving worker timeout constant to proper file (#839)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/839

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40494730

Pulled By: NivekT

fbshipit-source-id: ccd3ec723fbf4b99a80a144971da7cb3fa80d1fe",Kevin Tse,ktse@fb.com,2022-10-19 15:02:44,"['torchdata/_constants.py', 'torchdata/dataloader2/reading_service.py']",False
649b893b19536995632a6f9efa14354bffac30fa,"Unblock ProtoMPRS to control determinism of DataPipe in single/multi-processing and dist/non-dist env (#827)

Summary:
This PR temporarily extend `PrototypingMultiProcessingReadingService` to fully control the determinism of the pipeline in the combinations of:
- Single/Multi-processing
- Distributed/Non-distributed
When we have `SequentialReadingService` ready to combine `DistributedReadingService` and `PrototypingMultiProcessingReadingService`, a few code should be removed. And, for in-process reading service, we still need a method to isolate global RNGs to prevent data-pipeline interferes randomness against model.

For multiprocessing case, it will set the same random seed for `Shuffler` and set different deterministic seeds for global RNGs including `python.random`, `torch` and `numpy` within each subprocess.
For distributed case, it will share the same random seed for `Shuffler` across all distributed subprocesses to guarantee the shuffle order before sharding.

Test Plan:
All tests are executed in the combinations of the above environments
- [x] Validate the same seed will generate the same order of data
- [x] Validate different seeds will generate different order of data
- [x] Validate the data after shuffle and sharding in each worker are mutually exclusive and collectively exhaustive with/without manual seed

There is one missing test I will add tmrw
- [x] Validate subprocess-local RNGs like `random`, `torch` and `numpy` are properly set with different seeds.

Pull Request resolved: https://github.com/pytorch/data/pull/827

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D40323946

Pulled By: ejguan

fbshipit-source-id: 2997d6d5dce87a6c38d5ebdf64a00f9769bb18fa",erjia,erjia@fb.com,2022-10-19 03:17:41,"['.github/workflows/lint.yml', 'test/dataloader2/test_random.py', 'test/test_distributed.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/reading_service.py']",False
02f673ababa9ee07a8413633080953a556168ca9,"Fix PrototypeRS issue related to termination (#837)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/837

With this PR, PrototypeRS's child processes will be daemon processes such that they terminate when the main one does. Due to the non-deterministic nature of destruction, additional exception handling is required.

Fixes #806

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D40485829

Pulled By: NivekT

fbshipit-source-id: bd1fcf32956ac5a2abef560dd9a44f1f76e24f45",Kevin Tse,ktse@fb.com,2022-10-18 23:36:15,['torchdata/dataloader2/reading_service.py'],True
7579a4e806ad93ce4fa9ddd54c3f73287741763e,"Adding documentation for Prefetcher (#835)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/835

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40474180

Pulled By: NivekT

fbshipit-source-id: 9b67d23c8bc1899d52654f54adecb42e17748f5e",Kevin Tse,ktse@fb.com,2022-10-18 18:57:46,"['docs/source/torchdata.datapipes.iter.rst', 'torchdata/datapipes/iter/util/prefetcher.py']",True
8acb043df0507618e1798c8b37fecdeea3abe5a0,"Adding Prefetcher into the PrototypeRS and fixing prefetcher bug (#826)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/826

Test Plan: Imported from OSS

Reviewed By: NivekT, msaroufim

Differential Revision: D40308358

Pulled By: VitalyFedyunin

fbshipit-source-id: f4b706c29ceffc52c376e9cddfc56a75819ff1ee",Vitaly Fedyunin,vitalyf@fb.com,2022-10-18 17:52:25,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/prefetcher.py']",True
2fd9f98671350ad314c60bf8f55a548672d7328d,"Skip wrapping if serialization wrapper attached & deepcopy DataPipe in load_state_dict (#833)

Summary:
Per title
- We don't need to attach serialization wrapper if the last DataPipe has been `_DataPipeSerializationWrapper`
- When we `load_state_dict`, we still need a copy of `self.datapipe` as it has been done in `__init__` function. We should either do deepcoy to `self._datapipe_before_reading_service_adapt` or skip deepcopy to `self._datapipe_before_reading_service_adapt` at those two places.

Pull Request resolved: https://github.com/pytorch/data/pull/833

Reviewed By: NivekT

Differential Revision: D40399573

Pulled By: ejguan

fbshipit-source-id: 16fc80bd005a4b8671d48780c7aea8f164bccba8",erjia,erjia@fb.com,2022-10-17 19:41:24,['torchdata/dataloader2/dataloader2.py'],False
63e5f2f6ee9cdb478a38eb649bcfe7ee4d5bf38b,"Fix the document of buffer_size in max_token_bucketize (#834)

Summary:
This PR would fix a document issue in bucketbatcher.py
Fixes https://github.com/pytorch/data/issues/831

Pull Request resolved: https://github.com/pytorch/data/pull/834

Reviewed By: NivekT

Differential Revision: D40430887

Pulled By: ejguan

fbshipit-source-id: e132a3a24e8d09815c36bba3ccd4ffaced7b17d4",Xiaoyang Chen,ling032x@gmail.com,2022-10-17 17:33:25,['torchdata/datapipes/iter/transform/bucketbatcher.py'],True
84587ff57575fd47fcae61635a3f4ffc1e639941,"Add copyright header (#829)

Summary:
Required to fix automatic OSS check

Pull Request resolved: https://github.com/pytorch/data/pull/829

Reviewed By: wenleix, NivekT

Differential Revision: D40358342

Pulled By: ejguan

fbshipit-source-id: b9a4a8a262b84a7feddb48f9d6a47831459524f9",erjia,erjia@fb.com,2022-10-14 01:53:00,"['benchmarks/torchvision_classification/helpers.py', 'benchmarks/torchvision_classification/presets.py', 'benchmarks/torchvision_classification/train.py', 'benchmarks/torchvision_classification/utils.py']",False
c2e800a628d3c265be39758fa6416df1c3c4f131,"Update gha version to utilize Node16 (#830)

Summary:
This PR would remove all the annoying warnings from all GHA workflows.
See more detail in https://github.blog/changelog/2022-09-22-github-actions-all-actions-will-begin-running-on-node16-instead-of-node12/

Pull Request resolved: https://github.com/pytorch/data/pull/830

Reviewed By: wenleix

Differential Revision: D40359193

Pulled By: ejguan

fbshipit-source-id: 813f16b6d9e952a56d6d22ddaeb2a81da57586bf",erjia,erjia@fb.com,2022-10-14 01:38:22,"['.github/workflows/_build_test_upload.yml', '.github/workflows/aistore_ci.yml', '.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml']",True
2a58c306f11225264a2f432f3d483fca61e9576d,"Changing 1-to-M behaviour of on_disk_cache. (#810)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/810

TLDR: If filename_fn of on_disk_cache ( filename_fn'1 ) generates different name from filename_fn of end_caching, it is considered 1 to many situation. In this case additional listing file would be created at filename_fn'1 position and it will be used to check cache consistency between runs.

BC breaking, on_disk_cache no longer accept generators as `filename_fn`

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40148560

Pulled By: VitalyFedyunin

fbshipit-source-id: 3bb9c5f32546a3d4859cff6bda0cc84234312ab7",Vitaly Fedyunin,vitalyf@fb.com,2022-10-12 17:35:14,"['test/test_remote_io.py', 'torchdata/datapipes/iter/util/cacheholder.py']",False
1afc6692ee594e4a23b16c27982456b365d7b327,"Add DataLoader2-related online doc (#817)

Summary:
Per title
You can check the generated doc in https://ejguan.github.io/dataloader2.html

Pull Request resolved: https://github.com/pytorch/data/pull/817

Reviewed By: NivekT

Differential Revision: D40283927

Pulled By: ejguan

fbshipit-source-id: 00679bdb2fc410c29f836835f88020349d55dc8d",erjia,erjia@fb.com,2022-10-12 04:55:30,"['docs/source/_templates/class_method_template.rst', 'docs/source/_templates/class_template.rst', 'docs/source/dataloader2.rst', 'docs/source/index.rst', 'docs/source/torchdata.datapipes.iter.rst', 'docs/source/torchdata.datapipes.map.rst', 'docs/source/torchdata.datapipes.utils.rst', 'torchdata/dataloader2/README.md', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/adapter.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/load/aisio.py']",True
2dca1d4b5550ae20c0b5659c29f26678ddd636b6,"Adding reset epoch protocol message and support (#816)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/816

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40273860

Pulled By: VitalyFedyunin

fbshipit-source-id: 1c1bf478346dcc4b2a01e246f37d827e8ee9da36",Vitaly Fedyunin,vitalyf@fb.com,2022-10-12 01:52:42,"['torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/map.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/reading_service.py']",True
0c733b4ac6db27b6af12b758d5b8d9025ae27086,"Bump version to 0.6.0 (#822)

Summary:
Bump version on main branch after release branch cut

Pull Request resolved: https://github.com/pytorch/data/pull/822

Reviewed By: NivekT

Differential Revision: D40278099

Pulled By: ejguan

fbshipit-source-id: 0d618bbabfc5f154104cb929bea95c162c65f626",erjia,erjia@fb.com,2022-10-11 22:33:51,['version.txt'],True
8b7a0d2215442a9e0dd68c7edf4986d16172ab38,"Fix Prefetcher __getstate__ and __setstate__ (#818)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/818

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40274079

Pulled By: VitalyFedyunin

fbshipit-source-id: 7aa8129625f560755910ad4c7f39ccac0a33ce34",Vitaly Fedyunin,vitalyf@fb.com,2022-10-11 21:26:01,['torchdata/datapipes/iter/util/prefetcher.py'],True
c42587a828d05f24f6f0586d17d3e9d55e1433ed,"Deep copy DataPipe during initialization (#786)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/786

Deep copy DataPipe during initialization to avoid sharing states if the same DataPipe is being passed to multiple usages.

This can be merged before or after #746 (the other PR will have to rebase).

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D39741743

Pulled By: ejguan

fbshipit-source-id: f1cdaca054e10bcb3672857b933732178b370535",Kevin Tse,ktse@fb.com,2022-10-11 18:46:53,"['test/dataloader2/test_dataloader2.py', 'torchdata/dataloader2/dataloader2.py']",True
768ecdae8b56af640a78e29f82864dc4f65df371,"Adding Cloud Storage Provider tutorial section (#812)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/812

Adding example of DataPipe usage with cloud storage providers (AWS S3 and GCS) via `fsspec`.

Feel free to run the examples to verify that they work. Let me know what additional information I should provide as well.

![Screen Shot 2022-10-06 at 7 12 13 PM](https://user-images.githubusercontent.com/4935152/194434873-c8edb939-0e43-4622-883b-c1ce88f767f2.png)

![Screen Shot 2022-10-06 at 7 12 25 PM](https://user-images.githubusercontent.com/4935152/194434886-8b730522-0881-4e53-a5b9-75459304c061.png)

Test Plan: Imported from OSS

Reviewed By: ejguan, msaroufim

Differential Revision: D40162645

fbshipit-source-id: 6a7c156714b30bfed2da900b6d47d64f745333e2",Kevin Tse,ktse@fb.com,2022-10-07 20:42:21,"['docs/source/tutorial.rst', 'torchdata/datapipes/iter/load/aisio.py', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py']",True
d6fc8c51a7ae7f06a04389cf3e3a487ed1cdd069,"Add Dataloader2 test targets (#811)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/811

* To better track the test coverage of the data components, we make the dataloader2
 into a folder with a separate TARGETS.
* We plan add the needed_coverage in the TARGETS after we solve the needed_coverage
 finding issue and make TARGETS of torchdata more modular.

Reviewed By: ejguan

Differential Revision: D40124125

fbshipit-source-id: c096a7b7c4f02b82a865ea5276703506068f2e5d",Danny Huang,dannyhuang@meta.com,2022-10-06 22:35:06,['test/dataloader2/test_dataloader2.py'],False
b373bd223f271a767a49ea20fef88d4a6c4e6dcc,"Adding kwargs for `fs.open()` in fsspec DataPipes (#804)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/804

Fixes #803

I left `FSSpecFileLister` untouched since I don't think it will be useful for `fs.ls()` to accept kwargs.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D40038331

Pulled By: NivekT

fbshipit-source-id: 45232b938693690bc0906fc6240a104e80ef51f9",Kevin Tse,ktse@fb.com,2022-10-05 15:47:13,"['test/test_fsspec.py', 'torchdata/datapipes/iter/load/fsspec.py']",False
9ad8efb476baab2fae4435bcb8923b6cd2c828f1,"Implementing thread based PrefetcherIterDataPipe (#770)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/770

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D39816751

Pulled By: VitalyFedyunin

fbshipit-source-id: 9cd38309b8c008518cb820bf3748b7654c86f214",Vitaly Fedyunin,vitalyf@fb.com,2022-10-03 23:26:02,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/prefetcher.py']",False
57357b74e32af1e0cf297dbdfafbeb6da1aef62a,"Change iterator over multiple Queue wrappers to request all protocols simulteniously (#769)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/769

This is part of MPRS optimizations, changes are covered by the existing test_dataloader2.py test.

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D39816752

Pulled By: VitalyFedyunin

fbshipit-source-id: f0930b135230926624ebda420caeaf844faaa1a7",Vitaly Fedyunin,vitalyf@fb.com,2022-10-03 23:26:02,"['torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/reading_service.py']",True
db5ec7ace3bbe5d29b65321203bafc83dc4dd2df,"Refactor to use `traverse_dps` instead of `traverse` (#793)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/793

This should be merged only after https://github.com/pytorch/pytorch/pull/85667 has been merged into nightly and internal.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D39860692

Pulled By: NivekT

fbshipit-source-id: 4fd992acfa39d0877575d739c50949fe9d52056f",Kevin Tse,ktse@fb.com,2022-10-03 14:25:02,"['test/test_dataloader2.py', 'test/test_graph.py', 'torchdata/dataloader2/adapter.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/graph.py', 'torchdata/dataloader2/linter.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/utils/_visualization.py']",False
b87d2151cf31a4bdae443b4b4337a8abcc81c2c2,"add `padden_tokens` so max_token_count is not exceeded (#789)

Summary:
Fixes https://github.com/pytorch/data/issues/788

### Changes

- Add `include_padding` argument to `MaxTokenBucketizer`

Pull Request resolved: https://github.com/pytorch/data/pull/789

Reviewed By: NivekT

Differential Revision: D39972912

Pulled By: ejguan

fbshipit-source-id: f121c1f5b450f4159b313918c41a0a3aae26933b",Nik,git@mail.vaessen.tech,2022-09-30 19:32:50,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py']",False
a3e1427b944f86988e604028e907972802698aea,"Fix doc from prototype to beta (#798)

Summary:
Changing words from prototype to beta in our online doc.

Pull Request resolved: https://github.com/pytorch/data/pull/798

Reviewed By: NivekT

Differential Revision: D39930207

Pulled By: ejguan

fbshipit-source-id: 4ffe76fb81e555fd5766fa429be2dfd756e9e45d",erjia,erjia@fb.com,2022-09-29 17:08:17,['docs/source/index.rst'],False
a435c7f5f7543e3614130eb2ecee520396b8efd2,"Skip TFRecord test on macos M1 (#797)

Summary:
My [fix](https://github.com/pytorch/data/pull/790) to align protobuf version with tensorflow raises another problem with protobuf that it doesn't officially support MacOS M1. And, it causes our nightly release workflow failing especially for PyThon 3.10.

This PR would skip all TFRecord tests on MacOS M1 until Tensorflow officially supports protobuf 4.

Pull Request resolved: https://github.com/pytorch/data/pull/797

Reviewed By: NivekT

Differential Revision: D39892815

Pulled By: ejguan

fbshipit-source-id: 230665a5bb56fccf1172b8948b4275b205756680",erjia,erjia@fb.com,2022-09-28 20:24:48,"['test/_utils/_common_utils_for_test.py', 'test/test_tfrecord.py']",False
82fc8082303cbaa1bbc70d1b89e13f0fa08c3f13,"Align protobuf version with Tensorflow for TFRecordDataPipe (#790)

Summary:
Fixes https://github.com/pytorch/data/security/dependabot/1

### Changes

- Protobuf version from 3.20.1 to less than 3.20 as suggested by [Tensorflow](https://github.com/tensorflow/tensorflow/blob/8dcaf6b98a6a49c85eb470140ba8506e71a3b5af/tensorflow/tools/pip_package/setup.py#L88-L94)
- This would also fix the dependabot [alert](https://github.com/pytorch/data/security/dependabot/1)

Pull Request resolved: https://github.com/pytorch/data/pull/790

Reviewed By: NivekT

Differential Revision: D39815039

Pulled By: ejguan

fbshipit-source-id: 14afdacb79e67611a405b7c6cc282a8cf18583e4",Erjia Guan,erjia@fb.com,2022-09-26 20:43:54,['test/requirements.txt'],False
fd98722be6a6ed2fe4ebb36bd9a9bd8343994044,"Improve distributed tests by using available port and skip elastic on Python 3.7 (#791)

Summary:
### Changes

- Adding a utility function to find an available port on localhost for distributed training. This would prevent any failing distributed test would take up the port `29500` until python interpreter exits.
- Skip elastic training for python 3.7 (See: https://pypi.org/project/torchelastic/)

Pull Request resolved: https://github.com/pytorch/data/pull/791

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D39816941

Pulled By: ejguan

fbshipit-source-id: 0b2ee2efbd3ce4fa4610533ad4718d7421d18de5",Erjia Guan,erjia@fb.com,2022-09-26 20:22:03,['test/test_distributed.py'],False
568e214a6bf5799ecd2a01be654afbfdd62fde51,"feat: add example with tigergraph (#783)

Summary:
No code change to the codebase. Add a example with tigergraph database to the example page.

Pull Request resolved: https://github.com/pytorch/data/pull/783

Reviewed By: NivekT

Differential Revision: D39815161

Pulled By: ejguan

fbshipit-source-id: 7d5b02a0042d8048daf4de39228e4a1436c2eb87",tg-bill,89414465+tg-bill@users.noreply.github.com,2022-09-26 16:36:25,['docs/source/examples.rst'],False
748ea5c2756cd3e152c1a0d670a16587c69d4a93,"Add dataloader2 example with Multi-process reading service (#787)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/787

* Add the uscase and example of DataLoader2 with the reading service -
 MultiProcessingReadingService and apply sharding_filter to the train_data_pipe
  in the train loop.

* We plan to have the examples to showcase the advantages:
(1) The usage of the DLv2 with popular open source dataset.
(2) Integrate datasets/datapipes with different reading service.
(3) Datapipe manipulation for example batch, collate, map.
(4) Dist usage and examples with features such as sharding_filter for the sharding feature.
(5) Eventually add those examples to the pytorch tutorials.

Reviewed By: ejguan

Differential Revision: D39673296

fbshipit-source-id: 207110c8b0485bcf36f43daf154317ab9cfe5ab3",Danny Huang,dannyhuang@fb.com,2022-09-23 22:48:56,['examples/dataloader2/train_loop_reading_service.py'],False
0fed8dab86c187c1553c3ca1b5d8bf32f20c27d0,"Implement DistribtuedReadingService (#727)

Summary:
Add DistributedReadingService
- Single process
- Share shuffle seeds across distributed process
- Automatically distributed sharding

Add tests for both `DataLoader2` and `DataLoader`.
- Spawn processes
- Elastic training

Pull Request resolved: https://github.com/pytorch/data/pull/727

Reviewed By: NivekT

Differential Revision: D38746781

Pulled By: ejguan

fbshipit-source-id: 929d20e091fdcb5a427c5dc1ae527a028b9e76ce",Erjia Guan,erjia@fb.com,2022-09-23 20:26:30,"['test/bin/elastic_training.py', 'test/test_distributed.py', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/prefetch.py']",False
71d4222c5939ac785d1660424288e9b547adbefa,"Small doc improvement for S3 (#784)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/784

Probably make sense to have a link to the details of setup/config.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D39675196

Pulled By: NivekT

fbshipit-source-id: 2f573f7131ff083918caa45491fc7cf687abcebf",Kevin Tse,ktse@fb.com,2022-09-22 17:49:01,"['torchdata/datapipes/iter/load/README.md', 'torchdata/datapipes/iter/load/s3io.py']",False
50787ca5cd3acb007f9f7c81cb80b8f8fe40b65a,"Add support to traverse all python collection objects (#773)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/773

Fixes https://github.com/pytorch/data/issues/752

This PR makes `traverse` function supporting more collections data structures from Python. The `getstate_hook` will be invoked after custom `__getstate__` function

X-link: https://github.com/pytorch/pytorch/pull/84079

Reviewed By: NivekT

Differential Revision: D39357886

Pulled By: ejguan

fbshipit-source-id: 69d71e3bb2eb5ef127efbe397ce6af9fb45fba86",Erjia Guan,erjia@fb.com,2022-09-22 14:59:37,"['test/test_adapter.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/dataframemaker.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/prefetch.py', 'torchdata/datapipes/iter/util/randomsplitter.py']",False
b87e016085cc9b4e1b1b40a71284123ba0eeb468,"Revert D39620230: Add type hint stub

Differential Revision:
D39620230 (https://github.com/pytorch/data/commit/2212cb7dbf68ac5b98c9415be1f357e3f23ed6a2)

Original commit changeset: 0661c08bfdaa

Original Phabricator Diff: D39620230 (https://github.com/pytorch/data/commit/2212cb7dbf68ac5b98c9415be1f357e3f23ed6a2)

fbshipit-source-id: f72f0683a9d9de2a4ac6f466ab4ad1fe70b32f10",Erjia Guan,erjia@fb.com,2022-09-20 16:30:15,"['setup.py', 'torchdata/py.typed']",False
2212cb7dbf68ac5b98c9415be1f357e3f23ed6a2,"Add type hint stub (#780)

Summary:
Fixes https://github.com/pytorch/data/issues/779

### Changes

- Add `py.typed` file stub
- Include the file into package data

Pull Request resolved: https://github.com/pytorch/data/pull/780

Reviewed By: NivekT

Differential Revision: D39620230

Pulled By: ejguan

fbshipit-source-id: 0661c08bfdaad66a5e50506937d1339fb2865fec",Erjia Guan,erjia@fb.com,2022-09-19 16:06:34,"['setup.py', 'torchdata/py.typed']",False
0b973a8b0e359021f8bfe49700508c598d5ad656,"Enable 3.10 tests & fix bad protobuf version for MacOS Python 3.10 (#777)

Summary:
Fixes https://github.com/pytorch/data/issues/775

### Changes

- Enable CI for Python 3.10
- Fix the version of protobuf in test to 3.20.1 when it's MacOS and Python 3.10

Pull Request resolved: https://github.com/pytorch/data/pull/777

Reviewed By: NivekT

Differential Revision: D39578271

Pulled By: ejguan

fbshipit-source-id: 42056cbc10676be79a1502e00908facd10670c1e",Erjia Guan,erjia@fb.com,2022-09-16 17:14:48,"['.github/workflows/ci.yml', 'test/requirements.txt']",False
5b8818036da4ba9e286ebe036b28c2924dd5d7c3,"add lazy test to iter2map_converter (#765)

Summary:
Fixes https://github.com/pytorch/data/issues/753

This PR adds a test to ensure the converter behaves lazily in multiprocessing by checking the._map attribute after loading data.

Pull Request resolved: https://github.com/pytorch/data/pull/765

Reviewed By: NivekT

Differential Revision: D39543211

Pulled By: ejguan

fbshipit-source-id: 77e83fc1a268b0c408e85ed86330d6ae0ab8ca7e",DongyuXu77,xudongyu@bupt.edu.com,2022-09-15 18:04:57,"['test/test_dataloader2.py', 'torchdata/datapipes/iter/util/converter.py']",False
90b47272d176962567ed136cc0a8789982f2ccc0,"Fix TorchVision tests caused by file renaming (#774)

Summary:
This PR is required since https://github.com/pytorch/vision/pull/6587 has been landed and shipped to TorchVision nightly.

Pull Request resolved: https://github.com/pytorch/data/pull/774

Reviewed By: NivekT

Differential Revision: D39542299

Pulled By: ejguan

fbshipit-source-id: 5871263867a2f906b192677bde027c99e398bcdc",Erjia Guan,erjia@fb.com,2022-09-15 15:41:07,['.github/workflows/domain_ci.yml'],False
03e8e9e69e0cee13eb552ea7154468dcccbfc262,"Fix setup dependencies for building wheel (#771)

Summary:
Newer `setuptools` enforce strict subset of dependencies available when building the wheel. Thus `torch` needs to be listed as it's included in `setup.py`.

Tested by `pip install .` which was failing before and passes now.

Pull Request resolved: https://github.com/pytorch/data/pull/771

Reviewed By: ejguan

Differential Revision: D39430690

Pulled By: NivekT

fbshipit-source-id: e5b806917a0083c7d8c29a207dab48a43549358c",Dmytro Dzhulgakov,dima.v.dzhulgakov@gmail.com,2022-09-12 16:09:19,['pyproject.toml'],False
b6808b74da3a8fccd540dfb30bfeffa3fd66b054,"Unify implementation of in_batch_shuffle with `IterDataPipe.shuffle` (#745)

Summary:
Fixes https://github.com/pytorch/data/issues/519

This PR takes reference from the modification from [my PR](https://github.com/pytorch/pytorch/pull/83535) for `IterDataPipe.shuffle`.
- Add `set_seed`
- Add `set_shuffle`
- Make `RNG` lazily seeded
- Make serialization works

There will be another PR in PyTorch core to make `shuffle` related functions ([`apply_shuffle_settings`](https://github.com/pytorch/pytorch/blob/38348362608a47371c65d7fd52db138b4c6a5d65/torch/utils/data/graph_settings.py#L48), [`apply_shuffle_seed`](https://github.com/pytorch/pytorch/blob/38348362608a47371c65d7fd52db138b4c6a5d65/torch/utils/data/graph_settings.py#L69)) working with all `DataPipe` that has `set_seed` and `set_shuffle` APIs rather than only `iter.Shuffler` or `map.Shuffler`.

Pull Request resolved: https://github.com/pytorch/data/pull/745

Reviewed By: NivekT

Differential Revision: D38862010

Pulled By: ejguan

fbshipit-source-id: 614b90e2300ced9848f9d65e3941bad696798b00",Erjia Guan,erjia@fb.com,2022-09-09 23:32:47,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py']",False
86df1a09c0f649aca195a233508669de35b8623b,"Validation of `fn` on `input_col` for Datapipes (#755)

Summary:
Fixes https://github.com/pytorch/data/issues/362

### Changes

- Uses validator from torch main to apply checks
- Apply check on `FlatMapperIterDataPipe`

Pull Request resolved: https://github.com/pytorch/data/pull/755

Reviewed By: ejguan

Differential Revision: D39239201

Pulled By: NivekT

fbshipit-source-id: 4a258da510c605abbda4116f0e6794db5432d1f9",Robert,xiurobert@gmail.com,2022-09-06 17:53:38,['torchdata/datapipes/iter/transform/callable.py'],False
61bab053dd408cea4ee832c70d2ab6fb84e4151a,"Fix missing import in .pyi file (#758)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/758

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D39224605

Pulled By: NivekT

fbshipit-source-id: f80a51beaca3a73bc9437bf75b6bb3f2e74cadd1",Kevin Tse,ktse@fb.com,2022-09-06 14:59:17,['torchdata/datapipes/map/__init__.pyi.in'],False
a46e53ca295ae88a34cb8ca6bcd6e3abb4662965,"Add RandomSplitter (without buffer) (#724)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/724

This PR adds RandomSplitter without a buffer. The upside is that this uses less memory (good for memory-bound cases) but the downside are 1) only one group can be iterated through at a time and 2) it skips over all the groups that do not match the target (which is potentially wasteful).

Implementation note:
* I decided against reusing `_ChildDataPipe` since its features are overly complicated for this use case.
* I also decided against having an option to change seed automatically after each iteration, because there are situations where the first iteration is for `test` and the second iteration is for `valid`. Changing seed will be confusing and causes inconsistency.

See #712 for related discussion.
See #723 for the version with buffer.

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D38675266

Pulled By: NivekT

fbshipit-source-id: 137ea860367aab9b02fd1645bf7cc0429ab1f018",Kevin Tse,ktse@fb.com,2022-08-29 22:08:36,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'tools/gen_pyi.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/randomsplitter.py']",False
1947599b3d1b1eba7c285e1d657fbe317eb1ba4a,"Added default no-op function for flatmap (#749)

Summary:
Fixes https://github.com/pytorch/data/issues/738

### Changes

in datapipe's common functions:
- added _no_op_fn definition

in FlatMapperIterDataPipe class
- added _no_op_fn method use for default callable use

Pull Request resolved: https://github.com/pytorch/data/pull/749

Reviewed By: VitalyFedyunin

Differential Revision: D39019372

Pulled By: NivekT

fbshipit-source-id: c434830c68f9c4f3aee18addc144ce2f728b7601",Michał Kozikowski,mlko@MobicaPL.local,2022-08-29 17:25:33,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/transform/callable.py']",False
719616a1b4791034da3d888357e3ef62c70806e3,"Adding LengthSetterIterDataPipe (#747)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/747

This DataPipe allows users to manually set length of an `IterDataPipe` with no other side effect. This is useful for DataPipes whose final length cannot be known in advance (e.g. ``filter``). If you know the final length with certainty, you can manually set it for usages by DataLoader or other DataPipes.

Previously, users theoretically could use `.header(length)` to manually set length. However, the UX is suboptimal in that 1) the name is not obvious, and 2) warnings are raised unless the HeaderDataPipe has been fully traversed once to confirm the length.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D38989359

Pulled By: NivekT

fbshipit-source-id: 011fbfc0dd1ea7666b6e9e0e0e7ec009802d754e",Kevin Tse,ktse@fb.com,2022-08-25 16:20:06,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/header.py']",False
6bd0eb745f854f7f2cc9be18b786061365ad8cee,"Adding RepeaterIterDataPipe (#748)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/748

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D38881275

Pulled By: NivekT

fbshipit-source-id: 1d33d17b4cc9020633a1bc84f4d6d68ba7ad3045",Kevin Tse,ktse@fb.com,2022-08-24 16:15:59,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/cycler.py']",False
3a61e76b5db4f7b4544333636da2a71467b30725,"added slice + flatten for iterable datapipes (#730)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes https://github.com/pytorch/data/issues/656

### Changes

- added new iterdatapipe called islice for selecting a slice of an iterable item returned (ex: list, tuple, dict)
- added indexing as part of this islice functionality, allowing a list of indexes (or keys) to also be used in place of a slice for selection
- also added flatten iterdatapipe to allow for an item in an iterable to be flattened one level if an index or list of indices are provided
- added default for flatten (no args) that yields all items for all iterables in the provided datapipe chained together

Pull Request resolved: https://github.com/pytorch/data/pull/730

Reviewed By: NivekT

Differential Revision: D38759114

Pulled By: dbish

fbshipit-source-id: 8bf19712db41424cd4378da862ea6ad72e5c46e7",Diamond Bishop,bishop@fb.com,2022-08-17 03:45:22,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/callable.py']",False
e96cb66a5853df9fb335186b5432028f9dc058be,"Submodule update (#733)

Summary:
Update our submodules to up-to-date tags.
- Pybind11: [v2.10.0](https://github.com/pybind/pybind11/releases/tag/v2.10.0)
- aws_sdk_cpp: [1.9.323](https://github.com/aws/aws-sdk-cpp/releases/tag/1.9.323)

Pull Request resolved: https://github.com/pytorch/data/pull/733

Reviewed By: NivekT

Differential Revision: D38720385

Pulled By: ejguan

fbshipit-source-id: 968197502521b7f8d0a3007ad8e0b1dfb36b2e39",Erjia Guan,erjia@fb.com,2022-08-15 22:49:17,"['third_party/aws-sdk-cpp', 'third_party/pybind11']",False
827b13dc7f2a0f0793cf9c50d2d56f1124e924ac,"Implement FullSyncIterDataPipe (#713)

Summary:
### Changes

- Add `_PrefetchExecutor` to run prefetching in multi-threading
  - This should be reused by `PrefetchIterDataPipe`
- Add `FullSyncIterDataPipe`
  - [x] Tested the result using elastic training and normal distributed training.
  - [x] Add distributed unit test for GLOO
  - [x] Add serialization test (How to do checkpoint for `FullSyncIterDataPipe` is unclear to me)
    - Serialization is working properly as I am using spawn to serialize/deserialize such DataPipe to distributed processes.

Pull Request resolved: https://github.com/pytorch/data/pull/713

Reviewed By: Miiira

Differential Revision: D38463308

Pulled By: ejguan

fbshipit-source-id: abf3dd784e93f04bad77fb133b250e76fc55f3b4",Erjia Guan,erjia@fb.com,2022-08-12 15:52:47,"['test/test_distributed.py', 'torchdata/_constants.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/prefetch.py']",True
3a348a725ed28f932c9e52162015d2ca36a719cc,"Add benchmark from torchvision training references (#714)

Summary:
Towards https://github.com/pytorch/data/issues/416

This is a modified and simplified version of the torchvision classification training reference that provides:

-   Distributed Learning (DDP) vs 1-GPU training
-    Datapipes (with DataLoader or torchdata.dataloader2) vs Iterable datasets (non-DP) vs MapStyle Datasets
-   Full training procedure or Data-loading only (with or without transforms) or Model training only (generating fake datasets)
-   Timing of data-loading vs model training
-   any classification model from torchvision

I removed a lot of non-essential features from the original reference, but I can simplify further. Typically I would expect the `MetricLogger` to disappear, or be trimmed down to its most essential bits.

Pull Request resolved: https://github.com/pytorch/data/pull/714

Reviewed By: NivekT

Differential Revision: D38569273

Pulled By: NicolasHug

fbshipit-source-id: 1bc4442ab826256123f8360c14dc8b3eccd73256",Nicolas Hug,contact@nicolas-hug.com,2022-08-12 09:16:25,"['benchmarks/torchvision_classification/helpers.py', 'benchmarks/torchvision_classification/presets.py', 'benchmarks/torchvision_classification/train.py', 'benchmarks/torchvision_classification/utils.py']",False
5dade9a378a8edf7c0ae4eeaf6ef4394b186cff1,"torchdata datapipes drop addition (#725)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes https://github.com/pytorch/data/issues/656

### Changes
part 1 of the feature requests to manipulate datapipe columns here: https://github.com/pytorch/data/issues/656
this adds a drop functionality to iter datapipes

Pull Request resolved: https://github.com/pytorch/data/pull/725

Reviewed By: ejguan

Differential Revision: D38608512

Pulled By: dbish

fbshipit-source-id: 273ff7bfde001baf4e35961fe3056fece8ced502",Diamond Bishop,bishop@fb.com,2022-08-11 16:09:25,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/transform/callable.py']",False
85ae838f6622f54b0b49e6aec9c135bf3a1a7c56,"Implementing single iterator constraint (#700)

Summary:
Changes:
* Imposing the single iterator constraint on `DataLoader2` by having its `__iter__` method returns a wrapper that can track if an iterator is valid or not
* Previously, `__iter__` returns `self`, but now it will return an instance of `_DataLoader2Iterator`
* Aside from the behavior related to reset (see below), we expect other behaviors to stay the same.

Prior behavior:
```
dl = DataLoader2(IterableWrapper(range(10)))
it1 = iter(dl)
print(next(it1))  # 0
it2 = iter(dl)  # No reset here
print(next(it2))  # 1
print(next(it1))  # 2
```

New behavior with this PR:
```
dl = DataLoader2(IterableWrapper(range(10)))
it1 = iter(dl)
print(next(it1))  # 0
it2 = iter(dl)  # DataLoader2 resets with the creation of a new iterator
print(next(it2))  # 0
print(next(it1))  # Raises exception, since it1 is no longer valid
```

Pull Request resolved: https://github.com/pytorch/data/pull/700

Test Plan:
Existing tests and new test created in `test_dataloader2.py`

E2E Smallworld:
```
pyper-cli smallworld run-smallworld --  --stage training_only --hpc_identity dai_data --training_platform gpu --model=small_world_default --ads_dper3_test_package ads_dper3:pyper-prod --launch_to mast
```
https://www.internalfb.com/mast/job/smallworld-smallworld_gpu_offli-hqmlvds0gm9s6
Logs P521274907 show Only 1 DPP session created as expected

Reviewed By: Miiira

Differential Revision: D38262867

Pulled By: NivekT

fbshipit-source-id: f6639fca03336c6e10c6a3dfbfb913730cd6bed1",Kevin Tse,ktse@fb.com,2022-08-11 01:08:03,"['test/test_dataloader2.py', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py']",True
3afa800112c1d5faf3e1c443a1843e6db77d0dd9,"Criteo example minor clean up (#721)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/721

Minor clean up, mostly to remove the TODOs that have been addressed by TorchArrow.

Fixes #595
Fixes #596

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D38475416

Pulled By: NivekT

fbshipit-source-id: 9008105809c3d11651ce544c899fc974c8e89fa1",Kevin Tse,ktse@fb.com,2022-08-08 15:02:08,"['examples/criteo_torcharrow/common.py', 'examples/criteo_torcharrow/criteo_parquet.py', 'examples/criteo_torcharrow/criteo_tsv.py', 'examples/criteo_torcharrow/torcharrow_wrapper.py']",True
73d6c2603bbc45f7942db0792c62367e9529e297,"Fix tutorial about shuffing before sharding (#715)

Summary:
Fixes https://github.com/pytorch/data/issues/709

Per title

Pull Request resolved: https://github.com/pytorch/data/pull/715

Reviewed By: NivekT

Differential Revision: D38432061

Pulled By: ejguan

fbshipit-source-id: a8853a86efa9ca7ed6a9e76f0d51470d34513f48",Erjia Guan,erjia@fb.com,2022-08-04 22:00:32,['docs/source/tutorial.rst'],False
e43e47db133830b08f5c2115bc616d4440965355,"Change release_type on release branch for testing workflow (#717)

Summary:
When `input_branch` is empty, the testing workflow should determine which PyTorch release type should be used for testing PR.

You can find the testing result from the PR https://github.com/pytorch/data/issues/716

Pull Request resolved: https://github.com/pytorch/data/pull/717

Reviewed By: NivekT

Differential Revision: D38436132

Pulled By: ejguan

fbshipit-source-id: bfa9a5e2b23d03b378efdd4b0f996b32d6870e3a",Erjia Guan,erjia@fb.com,2022-08-04 21:59:49,['.github/workflows/_build_test_upload.yml'],True
7071f83b8cfb70fd0cedaa0edfae68ed46dcaebb,"ci: Don't install things to home directory, add workflow to test release pipelines (#706)

Summary:
Noticed we were getting extra conda packges from the home directory on
the M1 runners. Making this PR to reduce the amount that we're using the
home directory.

Will probably make it unwritable in the future so this is a pre-emptive
step to that.

Also adds a workflow to test the release pipelines without actually releasing a new binary.

Signed-off-by: Eli Uriegas <eliuriegas@fb.com>

Pull Request resolved: https://github.com/pytorch/data/pull/706

Reviewed By: ejguan

Differential Revision: D38406845

Pulled By: seemethere

fbshipit-source-id: 1d312c3e1db34497c546a9b842ac7ba01d2a7ee3",Eli Uriegas,eliuriegas@fb.com,2022-08-03 23:38:06,"['.github/workflows/_build_test_upload.yml', '.github/workflows/pull_release.yml']",False
b37db09a0315edb74afadfb6adfaa9d9b29eac10,"Improve DataPipe style converter examples (#710)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/710

Improves the documentation as a question was raised in #707

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D38363748

Pulled By: NivekT

fbshipit-source-id: 13443ae0bdb15b3825a751dd5151946cdf6bc79e",Kevin Tse,ktse@fb.com,2022-08-03 14:42:17,"['torchdata/datapipes/iter/util/converter.py', 'torchdata/datapipes/map/util/converter.py']",True
a7745b9865ed590c252072c51026400ae64a656f,"Update version compatibility table (#695)

Summary:
Update version matrix for 0.4.1

Pull Request resolved: https://github.com/pytorch/data/pull/695

Reviewed By: NivekT

Differential Revision: D38206913

Pulled By: ejguan

fbshipit-source-id: cacee6febcfeffb2b3b6c27835928a9acd9b0fde",Erjia Guan,erjia@fb.com,2022-07-28 13:42:57,"['README.md', 'setup.py']",False
adfdc72cd9acca016c1168e42c14b9136842de54,"Add conda env for upload and extend timeout for S3 to reduce flakiness (#698)

Summary:
### Changes

- Fix conda environment for conda upload
- Extend timeout from 3 seconds to 10 seconds for S3 Lister to reduce recent flakiness of the test

Pull Request resolved: https://github.com/pytorch/data/pull/698

Reviewed By: NivekT

Differential Revision: D38215518

Pulled By: ejguan

fbshipit-source-id: cf0cd5d3979fe2b5e86e0634b257979f93f79894",Erjia Guan,erjia@fb.com,2022-07-27 20:03:53,"['.github/workflows/_build_test_upload.yml', 'test/test_remote_io.py']",False
267bca25c5d555a5fbe49f9db980ce34bf3d0906,"Enable release on Mac arm64 (#692)

Summary:
Fixes https://github.com/pytorch/data/issues/676

### Changes

- Update the workflow to compile AWSSDK and integrated on arm64 macos
  - Use conda to install python since this [action](https://github.com/actions/setup-python) doesn't work with arm64b macos
  - Exclude python 3.7 from arm64 macos due to the pre-compiled python binary is not available either on conda or python official website
  - Use `bash -l {0}` to make sure `conda` is available across steps
- Please check the manually triggered [workflow](https://github.com/pytorch/data/runs/7528349378?check_suite_focus=true)
  - Wheels: https://github.com/pytorch/data/runs/7528349378?check_suite_focus=true#step:4:1
  - Conda packages: https://github.com/pytorch/data/runs/7528462809?check_suite_focus=true#step:5:1

Pull Request resolved: https://github.com/pytorch/data/pull/692

Reviewed By: NivekT

Differential Revision: D38172672

Pulled By: ejguan

fbshipit-source-id: d7ae1fd523fc140d5bc7b9d526b9a421cfd2eff6",Erjia Guan,erjia@fb.com,2022-07-27 13:24:41,"['.github/workflows/_build_test_upload.yml', 'packaging/README.md']",False
2f43f191c13d3b3d35de0705054039d716218a31,"Fix target folder for official release (#687)

Summary:
During preparing the minor release, the document folder is changed from `0.4.0` to `0.4`. For the official release, the workflow to extract target folder from tag for the official release should be modified correspondingly.

Pull Request resolved: https://github.com/pytorch/data/pull/687

Reviewed By: NivekT

Differential Revision: D38128675

Pulled By: ejguan

fbshipit-source-id: a1e7a83881c9d4c7ab7610629da44b8dca99bb0a",Erjia Guan,erjia@fb.com,2022-07-26 14:10:10,['.github/workflows/_build_test_upload.yml'],False
d1ee7fe765c6e0877c1403d4be6834bcc7368c44,"Fix TarArchiveLoader to skip `open` for TarFile stream (#679)

Summary:
Fixes https://github.com/pytorch/data/issues/673

If `data_stream` is either a `tafile.TarFile` object (wrapped by `StreamWrapper`), `TarArchiveLoader` should directly load from `data_stream` without `open` it again.

Pull Request resolved: https://github.com/pytorch/data/pull/679

Reviewed By: NivekT

Differential Revision: D38117729

Pulled By: ejguan

fbshipit-source-id: 91031f6fac38575d94684e069f41484de79274e5",Erjia Guan,erjia@fb.com,2022-07-26 02:33:50,"['test/test_local_io.py', 'torchdata/datapipes/iter/util/tararchiveloader.py']",False
f6425d68eb7c4a890e1cb62eb9e13f765b6a0966,"Improve note on shuffling behavior in tutorial (#688)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/688

Fixes #668

Let me know if the added note is unclear and we can improve upon it.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D38129786

Pulled By: NivekT

fbshipit-source-id: 90ebd43ec448394146bb9136db58d07f0ae74aa4",Kevin Tse,ktse@fb.com,2022-07-26 01:17:34,['docs/source/tutorial.rst'],False
514982fc8a383de3a0ca0aa787d73ad91a3696c6,"fix newline windows issue in generate_csv (#675)

Summary:
Fixes https://github.com/pytorch/data/issues/674

### Changes

updated tutorial in documentation to specify the newline explitly
`writer = csv.DictWriter(open(f""sample_data{file_label}.csv"", ""w"", newline=''), fieldnames=fieldnames)`

instead of:
`writer = csv.DictWriter(open(f""sample_data{file_label}.csv"", ""w""), fieldnames=fieldnames)`

## Testing
- tested by running the generate_csv function before and after on a windows machine, before was creating newlines between lines and throwing errors, after the created files don't have newlines and full tutorial works

Pull Request resolved: https://github.com/pytorch/data/pull/675

Reviewed By: ejguan

Differential Revision: D38116301

Pulled By: NivekT

fbshipit-source-id: 1885c40cdc739ca70c5236e983389d88f662b2d4",Diamond Bishop,bishop@fb.com,2022-07-25 20:11:10,['docs/source/tutorial.rst'],False
e24ed5d8f5c6b3b74677dfcfbc0b529111d27c1a,"Cloud benchmarks (#680)

Summary:
Per our offline discussion, I am separating out the cloud part of https://github.com/pytorch/data/issues/422 which will allow us to provision an AWS infra from the command line for offline benchmarks and potentially integrate into CI and release decisions.

In followup PRs, I will make the template more interesting and revisit the logger discussion so we can build this. (This PR is the middle node)
![Screen Shot 2022-07-25 at 10 14 40 AM](https://user-images.githubusercontent.com/3282513/180836193-f75e25c4-c2ed-4d8d-8f14-67849e232a44.png)

Here's a test that the template works

![Screen Shot 2022-07-25 at 10 15 13 AM](https://user-images.githubusercontent.com/3282513/180836270-0d26c697-eb8f-46bb-9f76-db76761555d2.png)

Pull Request resolved: https://github.com/pytorch/data/pull/680

Reviewed By: NivekT

Differential Revision: D38124731

Pulled By: msaroufim

fbshipit-source-id: 5b6749e291f06849a5a25b3b01fb7430c656e695",Mark Saroufim,marksaroufim@fb.com,2022-07-25 19:53:20,"['benchmarks/cloud/README.md', 'benchmarks/cloud/ec2.yml']",False
6b8c5780d43d80854f340df60825a7e624c1ec81,"Fix typo in issue template (#678)

Summary:
Fixes https://github.com/pytorch/data/issues/677

Pull Request resolved: https://github.com/pytorch/data/pull/678

Reviewed By: NivekT

Differential Revision: D38115026

Pulled By: ejguan

fbshipit-source-id: 41f5842a317f9580e1c71280baed6d53f8d423d0",Erjia Guan,erjia@fb.com,2022-07-25 15:26:37,['.github/ISSUE_TEMPLATE/documentation.yml'],False
33a6f645bc238af9c0d5dc2e87875a9316e074be,"updated aisio datapipe (#667)

Summary:
aisio.py changes to reflect the new aistore package (recent restructuring of APIs)

### Changes
- Fixed references of the latest APIs in AIStore
- using request raw stream in AISFileLoader instead of getting the whole object
- URL fix for AIStore example on the examples page
- Changes in AIStore unit test

Signed-off-by: Abhishek Gaikwad <gaikwadabhishek1997@gmail.com>

Pull Request resolved: https://github.com/pytorch/data/pull/667

Reviewed By: dahsh

Differential Revision: D38051593

Pulled By: NivekT

fbshipit-source-id: 43a29a47fef405a3e78c1e863725dcbab1a04517",Abhishek Gaikwad,gaikwadabhishek1997@gmail.com,2022-07-25 14:25:56,"['docs/source/examples.rst', 'mypy.ini', 'test/requirements_aistore.txt', 'test/test_aistore.py', 'torchdata/datapipes/iter/load/aisio.py']",False
53f47cec8c5d25ecb39658342c1d7c5dabbd0fb3,"Add Dataloader2 training loop example with torch text (#670)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/670

* Add the uscase and example of DataLoader2 with open source datasets/datapipes.
TorchText provides several standard NLP datasets; here we use its SST2 OSS dataset
 in the DataLoader2 train loop.

* We will have more examples to showcase the advantages:
(1) The usage of the DLv2 with popular open source dataset.
(2) Integrate datasets/datapipes with different reading service.
(3) Datapipe manipulation for example batch, collate, map.
(4) Dist usage and examples with features such as sharding_filter for the sharding feature.
(5) Eventually add those examples to the pytorch tutorials.

Reviewed By: ejguan

Differential Revision: D37938017

fbshipit-source-id: 22f1e49f7e65002eded80ac058d2fa58c9d99ef5",Danny Huang,dannyhuang@fb.com,2022-07-22 18:05:21,['examples/dataloader2/train_loop_torchtext.py'],False
03d0a24738c9f110b61f7441210643f699f242f5,"Add contribution guide for third-party library and fix pre-commit (#663)

Summary:
- Add contribution guide for third-party library
- Change pre-commit to use lower `node` version

Pull Request resolved: https://github.com/pytorch/data/pull/663

Reviewed By: NivekT

Differential Revision: D38073794

Pulled By: ejguan

fbshipit-source-id: a07c4765874c7381d2405702e4a979b8c95f723a",Erjia Guan,erjia@fb.com,2022-07-22 14:48:33,"['.pre-commit-config.yaml', 'third_party/CONTRIBUTING.md']",True
7e0041bf52bab973aaf9d494c395b1737fe7134c,"Raise Error when HTTPReader get 404 Response (#160) (#569)

Summary:
Fixes https://github.com/pytorch/data/issues/160

### Changes

- Add line of requests raise_for_status() will only allow 200 accepted requests

### Comments
- This raise only run when the method __iter__ of HTTPReader is called.
- It is not only raise for the 503 error, it also runs for 404, 500,501,502 ...
- I simulate them using FastAPI with the next code.

```
from fastapi import FastAPI, HTTPException

app = FastAPI()

aparrapo.get(""/raise/{error_int}"")
async def raise_error(error_int: int):
    raise HTTPException(status_code=error_int)
```

Pull Request resolved: https://github.com/pytorch/data/pull/569

Reviewed By: dahsh

Differential Revision: D38014642

Pulled By: NivekT

fbshipit-source-id: 84d70fe18bacdcf73b6dcfc5f4542f56190e35b1",diegoaichele,37969116+diegoaichele@users.noreply.github.com,2022-07-21 20:57:46,"['test/test_remote_io.py', 'torchdata/datapipes/iter/load/online.py']",False
b6ecce000453315e5ee861f6f9688d7205694c22,"Type annotate dataloader2 train loop (#664)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/664

* Type annotate dataloader2 train loop

Reviewed By: Miiira

Differential Revision: D37971478

fbshipit-source-id: 67cdd33fce70b43da4f9782f277510d1d7cfc7a1",Danny Huang,dannyhuang@fb.com,2022-07-20 17:11:48,['examples/dataloader2/train_loop.py'],False
c2223fdaab4630da9be4cfbff32441b766f475bd,"Adding ability to redefine cache timeout (#571)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/571

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37723437

Pulled By: VitalyFedyunin

fbshipit-source-id: e5e8ca200ba86c8113797c518da4c5ab2676f986",Vitaly Fedyunin,vitalyf@fb.com,2022-07-19 23:09:11,"['test/test_local_io.py', 'torchdata/dataloader2/adapter.py', 'torchdata/datapipes/iter/util/cacheholder.py']",False
3782192e152147a2e01c699402702d1381c196cc,"Fix buffer overflow for unzip with columns_to_skip (#658)

Summary:
When `unzip` has `columns_to_skip`, we should only create `ChildDataPipe` corresponding to `instance_ids`. And `Unzipper` should also handle mapping `instance_ids` to 0-based indices.

This is one of the root causes for the issue reported internally. See: https://fburl.com/2k0et1gv

Pull Request resolved: https://github.com/pytorch/data/pull/658

Reviewed By: NivekT

Differential Revision: D37865439

Pulled By: ejguan

fbshipit-source-id: 6e997e23a964a1ce7ac9eb65dbdbb81a8c255272",Erjia Guan,erjia@fb.com,2022-07-19 23:09:09,"['test/test_iterdatapipe.py', 'torchdata/datapipes/iter/util/unzipper.py']",True
87d6dc3d6b0df6829cc2813a0ca033accfa9d795,"Fix conda nightly to use the right pytorch nightly version corresponding to each platform (#662)

Summary:
Fix one TODO in the releng improvement:  https://github.com/pytorch/data/issues/253

Nightly release for TorchData is failing for the last two days because TorchData uses the latest version of PyTorch across platforms including macos, linux and windows. In some cases, like the current [workflow](https://github.com/pytorch/data/actions/runs/2690032872), PyTorch has not been updated nightly for macos with Python 3.7 and 3.9. In this case, TorchData conda release couldn't find the latest version of PyTorch for these two platforms then fail.

I am adding this PR to dynamically detect the versions of PyTorch nightly based on OS (`conda search` would find the packages of the runner's OS by default), CPU/CUDA and Python version.

Pull Request resolved: https://github.com/pytorch/data/pull/662

Reviewed By: NivekT

Differential Revision: D37926216

Pulled By: ejguan

fbshipit-source-id: 45531a57674815c8ada81e77bee46d8d80e883d8",Erjia Guan,erjia@fb.com,2022-07-18 17:11:46,['packaging/pkg_helpers.bash'],False
08f496ced7b76e14ddef8058ba4f8ff06e342c47,"examples: caltech256 and coco w/ aisio datapipe (#582)

Summary:
Adding `aisio` DataPipe examples to load data from disk and cloud buckets

### Changes
- added `aisio` DataPipe example for Caltech 256 and Microsoft COCO Dataset
- fixed examples for aisio.py

Signed-off-by: Abhishek Gaikwad <gaikwadabhishek1997@gmail.com>

Pull Request resolved: https://github.com/pytorch/data/pull/582

Reviewed By: NivekT

Differential Revision: D37817792

Pulled By: ejguan

fbshipit-source-id: 6d986e69a7db83da4f9e99eab5a4f75aff569c81",Abhishek Gaikwad,gaikwadabhishek1997@gmail.com,2022-07-18 13:55:58,"['docs/source/examples.rst', 'examples/aistore/aisio_usage_example.ipynb', 'test/requirements_aistore.txt', 'torchdata/datapipes/iter/load/aisio.py']",False
cd30bfb66cb7736f0e148091c85131e088f01107,"Add as_tuple argument for CSVParserIterDataPipe (#646)

Summary:
### Motivation
see https://github.com/pytorch/torcharrow/pull/421

### Changes

- Add `as_tuple` argument for CSVParserIterDataPipe
- Add a functional test for `as_tuple` in tests/test_local_io.py

Pull Request resolved: https://github.com/pytorch/data/pull/646

Reviewed By: wenleix, NivekT

Differential Revision: D37787684

Pulled By: ejguan

fbshipit-source-id: de674e507f717d9008b9eed2cf97c81c69ab563b",yancong,xych6@outlook.com,2022-07-15 03:58:50,"['test/test_local_io.py', 'torchdata/datapipes/iter/util/plain_text_reader.py']",False
9c35d026eba6477db95288e8b25251d151a5f8e9,"Improve GDrive 'content-disposition' error message (#654)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/654

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37865296

Pulled By: NivekT

fbshipit-source-id: 2ec5f29a96dde11c8986b8ba8e7972e4493c894e",Kevin Tse,ktse@fb.com,2022-07-15 03:06:13,['torchdata/datapipes/iter/load/online.py'],False
3d3f23f1c645e718d41324184619f20508f3dc46,"Use alternate reading mode for streams in TarArchiveLoader (#653)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/653

Fixes #650

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37862894

Pulled By: NivekT

fbshipit-source-id: 8e9d48825e214d4495836adf7314cc8f566fc699",Kevin Tse,ktse@fb.com,2022-07-15 01:53:13,['torchdata/datapipes/iter/util/tararchiveloader.py'],False
25cc03c055acfb342bfbf2065460aaf4edb1142d,"Fix Lint Error for unused `IterDataPipe` (#651)

Summary:
Per title

I have investigated the another CI failure for torchtext on macos, and the problem is caused by TorchText has not built nightly for macos < 11.0 after 2022-07-07. Will open an issue for TorchText

Pull Request resolved: https://github.com/pytorch/data/pull/651

Reviewed By: NivekT

Differential Revision: D37828801

Pulled By: ejguan

fbshipit-source-id: 7a336a6d8677d0302ac7543487ea45aea424e9e3",Erjia Guan,erjia@fb.com,2022-07-14 02:09:47,['torchdata/dataloader2/reading_service.py'],False
2af04d3432ead1f88e9a6aa80a0862fa3bc9d10b,"Update README.md (#583)

Summary:
Some stuff I noticed in the README that needed updating.

Pull Request resolved: https://github.com/pytorch/data/pull/583

Reviewed By: dahsh

Differential Revision: D37820218

Pulled By: NivekT

fbshipit-source-id: bd28f1e1b4055f07d941952a4d15bba13baed0d7",Matthew Caseres,matthewcaseres@outlook.com,2022-07-13 19:19:27,['README.md'],False
217c04788492c2d13c97513717bf3b7a0ad88b4e,"Fix mypy for IterDataPipe.collate (#645)

Summary:
Add `default_collate` to mypy stub file to make sure `default_collate` is imported for `IterDataPipe.collate`. See current broken main branch: https://github.com/pytorch/data/runs/7287540702?check_suite_focus=true

Sister PR from PyTorch Core: https://github.com/pytorch/pytorch/pull/81275

Pull Request resolved: https://github.com/pytorch/data/pull/645

Reviewed By: NivekT

Differential Revision: D37774464

Pulled By: ejguan

fbshipit-source-id: 1924fb2c011e433014ae4dc83d7ac3839ba60df6",Erjia Guan,erjia@fb.com,2022-07-13 16:11:48,['torchdata/datapipes/iter/__init__.pyi.in'],False
f1a128ec789f078852943e8c58377a99b42a7b45,"Make graph `traverse` working with unhashable `DataPipe` (#80509)

Summary:
X-link: https://github.com/pytorch/pytorch/pull/80509

Pull Request resolved: https://github.com/pytorch/data/pull/559

This Diff removes the requirement for `traverse` function that `DataPipe` needs to be hash-able. `traverse` function now is using `id` of `DataPipe` instance rather than `DataPipe` itself as the key for both `cache` and graph.

But, it requires the changes of type of `DataPipeGraph` from `Dict[DataPipe, ""DataPipeGraph""]` to `Dict[int, Tuple[DataPipe, ""DataPipeGraph""]]`.

Reviewed By: Miiira

Differential Revision: D37354153

fbshipit-source-id: 9816c492a1e54a0f819671d46d0a5cff0a2ef785",Erjia Guan,erjia@fb.com,2022-07-12 02:14:31,"['test/test_graph.py', 'test/test_iterdatapipe.py', 'torchdata/dataloader2/_graph_utils.py', 'torchdata/dataloader2/adapter.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/graph.py', 'torchdata/dataloader2/linter.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/util/cacheholder.py']",False
a73180c21f16a5a094f1a0a90fe0e696a698e6ae,"Consolidating util and tool folders (#643)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/643

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37758137

Pulled By: VitalyFedyunin

fbshipit-source-id: 178719e579baaec7d1c11d8373026e6e3615defe",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2022-07-12 00:36:31,['tools/todo.py'],False
f6acc214ac5b71c53e7f0c63075a612b604025d0,"Convert TODOs into issues (#592)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/592

Test Plan: Imported from OSS

Reviewed By: dahsh, ejguan, Miiira

Differential Revision: D37758139

Pulled By: VitalyFedyunin

fbshipit-source-id: c5b80b112b5db7a11eafd5123736e5d7863831fc",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2022-07-12 00:36:31,"['docs/source/conf.py', 'examples/criteo_torcharrow/criteo_parquet.py', 'examples/criteo_torcharrow/criteo_tsv.py', 'examples/criteo_torcharrow/torcharrow_wrapper.py', 'test/test_dataloader2.py', 'test/test_serialization.py', 'torchdata/_extension.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/communication/queue.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/dataframemaker.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tfrecordloader.py', 'torchdata/datapipes/utils/janitor.py', 'util/todo.py']",True
91cc8376ba524cc5cc137102187b40d36654f07f,"This script checks TODO lines and generate issues for the ones which is not already assigned. (#590)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/590

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37758138

Pulled By: VitalyFedyunin

fbshipit-source-id: bd5240f2f1a382b7b5eabcc7cfb2a41da659c073",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2022-07-12 00:36:31,['util/todo.py'],True
4b325c85b81b5c5ef3f645fad7ad6092c7ce9aee,"Fix oss header requirements (#584)

Summary:
Fix header for open source requirements

Pull Request resolved: https://github.com/pytorch/data/pull/584

Reviewed By: VitalyFedyunin

Differential Revision: D37752950

Pulled By: ejguan

fbshipit-source-id: fa5136760c11912a31db358aa3009c1f9b44a4cf",Erjia Guan,erjia@fb.com,2022-07-11 17:29:25,"['examples/criteo_torcharrow/common.py', 'examples/criteo_torcharrow/criteo_parquet.py', 'examples/criteo_torcharrow/criteo_tsv.py', 'examples/criteo_torcharrow/torcharrow_wrapper.py', 'examples/criteo_torcharrow/tsv_to_parquet.py']",False
2f29adba451e1b87f1c0c654557d9dd98673fdd8,"Improved FAQ readability with collapsible Q&A. (#577)

Summary:
### Changes

+ Changed Q&A from plain text to collapsible sections in `README.md`.
+ Fixed typo in FAQ answer.

Pull Request resolved: https://github.com/pytorch/data/pull/577

Reviewed By: VitalyFedyunin

Differential Revision: D37720622

Pulled By: ejguan

fbshipit-source-id: f129d986a8ac5c37f7553efcdf26f18e17d024a5",Lucas Parzianello,lucaspar@users.noreply.github.com,2022-07-11 15:47:14,['README.md'],False
00795a4ae98e593bbe80f501182e360fa5b18688,"Fix dataloader2 reading service docstring (#581)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/581

* Fix dataloader2 reading service docstring

Reviewed By: ejguan

Differential Revision: D37726131

fbshipit-source-id: 3271f685aa220d0eb56f6c69c224cbbc696656e3",Danny Huang,dannyhuang@fb.com,2022-07-09 02:44:12,['torchdata/dataloader2/reading_service.py'],True
e075cac1972eee1d9d3a0f1a03ae663d6b855bfd,"Fix typo breaking nightly build (#578)

Summary:
Fixes #None

### Changes

Linux nightly releases are broken for some days now due to a small typo in the workflow file.

Pull Request resolved: https://github.com/pytorch/data/pull/578

Reviewed By: bearzx

Differential Revision: D37716058

Pulled By: ejguan

fbshipit-source-id: 00e03b287a0483d1769182a17817267f3ea14b9f",Matthias Reso,13337103+mreso@users.noreply.github.com,2022-07-08 17:26:48,['.github/workflows/_build_test_upload.yml'],True
cbbad752e25e709a36d6ca16436f44fe0c085d82,"Moving Queues, Protocols and Evenloops from PyTorch core. (#544)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/544

Adding PrototypeMultiProcessingReadingService as a candidate to replace MultiProcessingReadingService and remote DLv1 dependency

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D37467653

Pulled By: VitalyFedyunin

fbshipit-source-id: 9fd30fb07c8b3e92ed8109b011aeea071276d453",Vitaly Fedyunin,vitalyf@fb.com,2022-07-06 23:10:49,"['test/test_dataloader2.py', 'test/test_graph.py', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/communication/__init__.py', 'torchdata/dataloader2/communication/eventloop.py', 'torchdata/dataloader2/communication/iter.py', 'torchdata/dataloader2/communication/map.py', 'torchdata/dataloader2/communication/messages.py', 'torchdata/dataloader2/communication/protocol.py', 'torchdata/dataloader2/communication/queue.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/datapipes/iter/load/online.py']",False
ae54b5d32a42b6361f7e079dbcb9b16d449e151e,"Data Pipeline to read Criteo TSV and Parquet files and apply TorchArrow operations (#561)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/561

Credits to #183 by NivekT

Test Plan: Imported from OSS

Reviewed By: msaroufim

Differential Revision: D37651210

Pulled By: VitalyFedyunin

fbshipit-source-id: c4fc6a2904e4f83e93df11fd620e714f7bbda9b5",Vitaly Fedyunin,vitalyf@fb.com,2022-07-06 19:36:20,"['examples/criteo_torcharrow/common.py', 'examples/criteo_torcharrow/criteo_parquet.py', 'examples/criteo_torcharrow/criteo_tsv.py', 'examples/criteo_torcharrow/day_11_first_3k_rows.tsv', 'examples/criteo_torcharrow/day_11_first_3k_rows_original.tsv', 'examples/criteo_torcharrow/torcharrow_wrapper.py', 'examples/criteo_torcharrow/tsv_to_parquet.py']",False
f71f18a3fb251e91d6df5bace75d3bc0db07cbb2,"Add OSS Train Loop (#563)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/563

* Add simple train loop example of dataloader2 with a toy model in the torchdata
 examples. This demonstrates the dataloader2 usage with train step (forward +
backward + optimize) in the train loop of multiple epochs.

* This basic example skipped the dataset and datapipe creation part, only focused
 on the train loop usage part with the DLv2. We will have more examples to
showcase the advantages:

(1) The usage of the DLv2 with popular open source dataset.
(2) Integrate datasets/datapipes with different reading service.
(3) Use popular open source dataset in the E2E training.
(4) Datapipe manipulation for example batch, collate, map.
(5) Dist usage and examples with features such as sharding_filter for the sharding feature.
(6) Eventually add those examples to the pytorch tutorial.

Reviewed By: ejguan

Differential Revision: D37366122

fbshipit-source-id: 4ae75959843cad2c3968137fe505d0767cf09ed6",Danny Huang,dannyhuang@fb.com,2022-07-06 17:17:10,['examples/dataloader2/train_loop.py'],True
aa414425868c06982b5d12194f32eb664eddf4b0,"Quickfix mypy error in autogenerated register functions (#572)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/572

Test Plan: Imported from OSS

Reviewed By: msaroufim

Differential Revision: D37627511

Pulled By: VitalyFedyunin

fbshipit-source-id: 2da465ff9aa387a7698819b6dc01c0d8c9c4dc66",Vitaly Fedyunin,vitalyf@fb.com,2022-07-06 16:37:01,['torchdata/datapipes/iter/util/dataframemaker.py'],False
f14d6d4d0d4c9cbc0d8eca8cc09f6d03b1d6d3c7,"Automatically close parent streams and discarded streams (#560)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/560

Test Plan: Imported from OSS

Reviewed By: bearzx

Differential Revision: D37625298

Pulled By: VitalyFedyunin

fbshipit-source-id: b0636eb9fc6fc32bffb166912341d3dc90a4e056",Vitaly Fedyunin,vitalyf@fb.com,2022-07-06 16:27:20,"['torchdata/__init__.py', 'torchdata/datapipes/iter/util/bz2fileloader.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/decompressor.py', 'torchdata/datapipes/iter/util/rararchiveloader.py', 'torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py', 'torchdata/datapipes/utils/__init__.py', 'torchdata/datapipes/utils/janitor.py']",False
7abb164f9bb6382fd8bf892c322f4b224a770a98,"adding aistore datapipe (#545)

Summary:
Fixes #{[517](https://github.com/pytorch/data/issues/517)}

### Changes
- Added `aisio.py` (Iterable Datapipe for AIStore backends)
- Added unit tests in ~~`test/test_local_io.py`~~ `test/test_aistore.py`
- Added GitHub action for running AIStore in ~~`CI.yml`~~ `.github/aistore_ci.yml` workflow

### Questions to maintainers
- We are unsure about the documentation generated on PyTorch to refer it in `README.md`, so I have tentatively added a URL similar to s3io functions. (see ```torchdata/datapipes/iter/load/README.md```)

Signed-off-by: Abhishek Gaikwad <gaikwadabhishek1997@gmail.com>

Pull Request resolved: https://github.com/pytorch/data/pull/545

Reviewed By: VitalyFedyunin

Differential Revision: D37620194

Pulled By: msaroufim

fbshipit-source-id: 9df099586dd39d47f8fdf2b760b17503f8a9822d",Abhishek Gaikwad,gaikwadabhishek1997@gmail.com,2022-07-06 00:52:27,"['.github/workflows/aistore_ci.yml', '.github/workflows/ci.yml', 'docs/source/torchdata.datapipes.iter.rst', 'mypy.ini', 'test/requirements_aistore.txt', 'test/test_aistore.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/README.md', 'torchdata/datapipes/iter/load/aisio.py']",False
f629899aece23a15c155c7c7805b8db7a2bed2a7,"DataFrameMakerIterDataPipe now allows dtype_generator to be passed. (#537)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/537

This is required for the usecases when dtype itself is not serializable and can't be part of the graph.

Test Plan: Imported from OSS

Reviewed By: NivekT, bearzx

Differential Revision: D37522091

Pulled By: VitalyFedyunin

fbshipit-source-id: 7ce2a87f51b6b493144859995559291dd137e49c",Vitaly Fedyunin,vitalyf@fb.com,2022-06-29 20:30:09,['torchdata/datapipes/iter/util/dataframemaker.py'],False
242ec0d8421690333bf6214148c771ab3c22a4c6,"Improve release workflow (#558)

Summary:
This is a follow-up PR to help resolve a few issues that I have encountered during the official release.
- Making sure the wheels for linux always following manylinux by using `auditwheel` to repair them
- Disable domain tests on release branch for both PRs and pushes
- Improve lint CI to install PyTorch from the corresponding urls for nightly/RC/official releases

Pull Request resolved: https://github.com/pytorch/data/pull/558

Reviewed By: NivekT

Differential Revision: D37496522

Pulled By: ejguan

fbshipit-source-id: d768f656734d34420a08d82e68f29af5f14cb2a7",Erjia Guan,erjia@fb.com,2022-06-29 15:43:18,"['.github/workflows/_build_test_upload.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml']",False
30d29efdd4779a6727764ed3d1cf00fb81e44eec,"Fix binary path for official release (#556)

Summary:
Found the issue during official release

Pull Request resolved: https://github.com/pytorch/data/pull/556

Reviewed By: NivekT

Differential Revision: D37492010

Pulled By: ejguan

fbshipit-source-id: 59975e6da6bdf766ee07aa99709983994c2f7e77",Erjia Guan,erjia@fb.com,2022-06-28 17:21:34,['.github/workflows/_build_test_upload.yml'],False
14b2291f0f0488632e9689b9735c58a3b113d237,"Raise warning for unpickable local function (#80232)

Summary:
X-link: https://github.com/pytorch/pytorch/pull/80232

Pull Request resolved: https://github.com/pytorch/data/pull/547

Fixes https://github.com/pytorch/data/issues/538
- Improve the validation function to raise warning about unpickable function when either lambda or local function is provided to DataPipe.
- The inner function from functools.partial object is extracted as well for validation
- Mimic the behavior of pickle module for local lambda function: It would only raise Error for the local function rather than lambda function. So, we will raise warning about local function not lambda function.
```py

>>> import pickle
>>> def fn():
...     lf = lambda x: x
...     pickle.dumps(lf)
>>> pickle.dumps(fn)
AttributeError: Can't pickle local object 'fn.<locals>.<lambda>'
```

This Diff also fixes the Error introduced by https://github.com/pytorch/pytorch/pull/79344

Reviewed By: NivekT

Differential Revision: D37417556

fbshipit-source-id: 388d04004da43aaf14729cbe465a9247bef6c780",Erjia Guan,erjia@fb.com,2022-06-27 21:43:15,"['test/test_serialization.py', 'torchdata/datapipes/iter/transform/callable.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/converter.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py']",False
75f31dc99dcc3159ee9a3df73d3862c76754823c,"Update changed links in documentation (#543)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/543

Fixes #540

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37394420

Pulled By: NivekT

fbshipit-source-id: 6a29514885d64868956fa8c24cde958db1461b6b",Kevin Tse,ktse@fb.com,2022-06-24 18:01:49,"['docs/source/examples.rst', 'docs/source/tutorial.rst']",False
95c1a904024e367c44674a30de8085bb78510f24,"Small README update for DataLoader2 (#541)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/541

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37394421

Pulled By: NivekT

fbshipit-source-id: 1fc9d47b44bc9348e3489f5e2a71a40010f527fc",Kevin Tse,ktse@fb.com,2022-06-24 18:01:49,"['README.md', 'torchdata/dataloader2/README.md']",True
4387ab453158b617cc2fe0bf77dc823a556c81b4,"Fix S3 documentation (#542)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/542

Reviewed By: VitalyFedyunin

Differential Revision: D37389586

Pulled By: ejguan

fbshipit-source-id: 7437ea488fb80b87e8f52b133c83d8990be8db02",Erjia Guan,erjia@fb.com,2022-06-24 01:47:56,"['torchdata/datapipes/iter/load/README.md', 'torchdata/datapipes/iter/load/s3io.py']",False
6c8f7787eecf1c786ae05c5b43f7ecde872d817d,"Fix issue related to duplicate collation (#531)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/531

Since we want users to always provide their own collation in the DataPipe graph, we add this function to avoid duplicate collation. It will no longer be needed once this reading service no longer relies on DLv1.

Separately, the [linter issue](https://github.com/pytorch/data/issues/364) is modified to track the fact that we want users to always provide a `Collator`.

Fixes part of https://github.com/pytorch/data/issues/530

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D37348504

Pulled By: NivekT

fbshipit-source-id: d04f425dae47d679edad2ad5669b10e29b831500",Kevin Tse,ktse@fb.com,2022-06-23 16:02:30,"['test/test_dataloader2.py', 'torchdata/dataloader2/reading_service.py']",False
cc3f866c03cb8fea6e92e3f5a21c3d4f2461fed8,"Update documentation for S3 DataPipes (#534)

Summary:
Fixes https://github.com/pytorch/data/issues/523

- Make in-line doc as the single source of truth
- Add `sharding` and `shuffle` to the example for distributed training
- Rephrase each arguments based on the offline discussion with ydaiming

Pull Request resolved: https://github.com/pytorch/data/pull/534

Reviewed By: NivekT

Differential Revision: D37348999

Pulled By: ejguan

fbshipit-source-id: 6cf76a26bdeeb0842aff92ca9b0be53801acb29f",Erjia Guan,erjia@fb.com,2022-06-23 00:14:42,"['torchdata/datapipes/iter/load/README.md', 'torchdata/datapipes/iter/load/s3io.py']",False
8682f6e09d6facc9d6105c59c9966058c182065e,"Add README for DataLoader2 (#526)

Summary:
Add brief description of `DataLoader2` and related components.

Pull Request resolved: https://github.com/pytorch/data/pull/526

Reviewed By: NivekT

Differential Revision: D37315170

Pulled By: ejguan

fbshipit-source-id: 9886fb60c48870815c4e8242eb46e69031abba9a",Erjia Guan,erjia@fb.com,2022-06-21 20:12:42,['torchdata/dataloader2/README.md'],False
0b2c60449e48ff0e55d943149f3834995c700952,"move dataloader2_checkpoint_utils away from OSS

Summary: feel this file dataloader2_checkpoint_utils.py  better sits within FB internal.

Reviewed By: Miiira

Differential Revision: D37261669

fbshipit-source-id: 02f79d28d2bb319679c7396b40a1a97b09387d15",Alvin Chen,alvinbchen@fb.com,2022-06-21 09:55:19,"['test/test_dataloader2_checkpoint_utils.py', 'torchdata/dataloader2/dataloader2_checkpoint_utils.py']",False
f3de712bf0a609ec79140d77a438a5a4d65b2448,"Update examples to avoid lambdas (#524)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/524

This allow these examples to work with multiprocessing even without `dill` installed.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37286086

Pulled By: NivekT

fbshipit-source-id: 52c859097f2d3b14d3b78d752e1f01ff5574dca5",Kevin Tse,ktse@fb.com,2022-06-20 21:01:51,"['examples/text/CC100.ipynb', 'examples/text/ag_news.py', 'examples/text/amazonreviewpolarity.py', 'examples/text/examples_usage.ipynb', 'examples/text/imdb.py', 'examples/text/squad1.py', 'examples/text/squad2.py']",False
32e447f1890437fa9707bc2e517cfa8b3e19dfca,"Fix target folder for official release (#521)

Summary:
The target folder for the official release is corrected.

Pull Request resolved: https://github.com/pytorch/data/pull/521

Reviewed By: NivekT

Differential Revision: D37250367

Pulled By: ejguan

fbshipit-source-id: 582ec710b46f5f47cab4042bcb69f79ae7c44a85",Erjia Guan,erjia@fb.com,2022-06-18 01:29:11,['.github/workflows/_build_test_upload.yml'],False
42e5153b01710995136980a3d975a5fb15fd71f0,"Fix conda install local package for nightly release (#520)

Summary:
This is a follow-up PR for https://github.com/pytorch/data/issues/503 to fix the nightly release workflow for conda
Before this PR, the conda workflow fails because `torchdata` and `torch` is not installed in the test environment. See: https://github.com/pytorch/data/actions/runs/2515100032

After this PR, the conda workflow will use the same conda environment installed with `torchdata` and `torch` for testing. See manually triggered workflow: https://github.com/pytorch/data/actions/runs/2516410338

Pull Request resolved: https://github.com/pytorch/data/pull/520

Reviewed By: VitalyFedyunin

Differential Revision: D37242053

Pulled By: ejguan

fbshipit-source-id: 66d8d640e8a3a46c163182b2733e300557fca9fc",Erjia Guan,erjia@fb.com,2022-06-17 18:16:42,['.github/workflows/_build_test_upload.yml'],False
fe83c533cef58a5b319ceef92b116285d9f85580,"Pass through kwargs to json.loads call in JsonParser (#518)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/518

The comment of this class suggests the keyword arguments in the constructor will be passed through to the json.loads call. However, `self.kwargs` is not actually passed through to the call.

Updated the example in the README too

Reviewed By: ejguan

Differential Revision: D37162608

fbshipit-source-id: b73a6cfc58befbfabfef3595d9b00cef78852273",Ananth Subramaniam,ananthsub@fb.com,2022-06-15 21:01:59,"['README.md', 'test/test_local_io.py', 'torchdata/datapipes/iter/util/jsonparser.py']",False
100d086413873a5c224842da4c2cd55cb634317f,"Add OSS example and test of data loader v2 load state dict (#513)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/513

* Add initial OSS tests and examples for data loader v2 with load state dict.
* We need OSS unit tests and examples for data loader v2. TODO: will add more tests and examples for DLv2.

Reviewed By: ejguan, Miiira

Differential Revision: D37016541

fbshipit-source-id: a1596135f8c8c3f335cab1cabee36a14aa652774",Danny Huang,dannyhuang@fb.com,2022-06-14 20:43:41,['test/test_dataloader2.py'],False
41f55d48e434e02a6ab0c439799c06cb3ceb47f9,"Re-land Use PyTorch RC release on release branch (#510) (#514)

Summary:
Currently the CI on release branch uses nightly PyTorch release. This PR changes it to use RC PyTorch release.

See the CI result for when the PR is landed (nightly channel): https://github.com/pytorch/data/runs/6867662390?check_suite_focus=true#step:8:3
See the CI result of the PR for release branch (test channel): https://github.com/pytorch/data/runs/6867788289?check_suite_focus=true#step:8:3

Pull Request resolved: https://github.com/pytorch/data/pull/514

Reviewed By: NivekT

Differential Revision: D37116635

Pulled By: ejguan

fbshipit-source-id: 2dbe65da8121dfbd39690c83c2e1ca6cb70c0087",Erjia Guan,erjia@fb.com,2022-06-13 20:13:42,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml']",False
2e76749252a48c7fad0f1542a24f7703f3758c01,"Revert D37074625: Use PyTorch RC release on release branch

Differential Revision:
D37074625 (https://github.com/pytorch/data/commit/7cc256e4cc1a6a815e548e00da162f4021cab7be)

Original commit changeset: 2454e8c2ced7

Original Phabricator Diff: D37074625 (https://github.com/pytorch/data/commit/7cc256e4cc1a6a815e548e00da162f4021cab7be)

fbshipit-source-id: 60319480c365b1829cb3734c3fcacf34dd2388ae",Erjia Guan,erjia@fb.com,2022-06-10 20:37:05,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml']",False
7cc256e4cc1a6a815e548e00da162f4021cab7be,"Use PyTorch RC release on release branch (#510)

Summary:
Currently the CI on release branch uses nightly PyTorch release. This PR changes it to use RC PyTorch release.

See the CI result of the PR for release branch: https://github.com/pytorch/data/runs/6835571789?check_suite_focus=true#step:8:3

Pull Request resolved: https://github.com/pytorch/data/pull/510

Reviewed By: NivekT

Differential Revision: D37074625

Pulled By: ejguan

fbshipit-source-id: 2454e8c2ced7718e769348a7c44c45b4b0ea4ec4",Erjia Guan,erjia@fb.com,2022-06-10 20:26:59,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml']",False
02c0972222fb9077b010f7b542ea2327ea885620,"Always upload TorchData nightly release (#503)

Summary:
Based on the offline discussion with Vitaly, we want to upload TorchData nightly releases even if tests are failing.

It's required by downstream library when PyTorch Core nightly updated but TorchData nightly still depends on the previous PT Core nightly.

Pull Request resolved: https://github.com/pytorch/data/pull/503

Reviewed By: NivekT

Differential Revision: D37049785

Pulled By: ejguan

fbshipit-source-id: f65a166daa9646eb8251c418c3a416c51d3578e4",Erjia Guan,erjia@fb.com,2022-06-10 13:53:51,"['.github/workflows/_build_test_upload.yml', 'packaging/torchdata/meta.yaml']",False
843658c954b2565fb310ad82da34f9d720266f07,"Add instructions about ImportError for portalocker (#506)

Summary:
Partially fixes: https://github.com/pytorch/data/issues/441

Add instructions on how to solve `ImportError` for `portalocker`.

Pull Request resolved: https://github.com/pytorch/data/pull/506

Reviewed By: NivekT

Differential Revision: D37045053

Pulled By: ejguan

fbshipit-source-id: a365be88cfea9f05e155d09cf476ca89b6579205",Erjia Guan,erjia@fb.com,2022-06-09 22:44:52,"['README.md', 'torchdata/datapipes/iter/util/cacheholder.py']",False
8863ee5a006ceadcb78c970136a900f724dfa8e5,"Update examples and tutorial after automatic sharding has landed (#505)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/505

After the `DataLoader` automatic sharding for DataPipe PR has landed in core, this PR is updating the relevant example and tutorial

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin, ejguan

Differential Revision: D37040383

Pulled By: NivekT

fbshipit-source-id: 446b9e6a0ae804b1a0908a26058680f9b3c2f080",Kevin Tse,ktse@fb.com,2022-06-09 21:47:30,"['README.md', 'docs/source/tutorial.rst', 'examples/vision/imagefolder.py', 'test/test_local_io.py']",False
3ff7cbd447ff40635e6e5e270bab8e56eae50803,"Improve graph visualization documentation (#504)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/504

Improve docstring, added an example, and expanded documentation to have a template for utility functions (not just class)

If there isn't strong objection, I plan to cherry-pick this and the graph visualization PR to release 0.4.0 (cc: ejguan).

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D37040783

Pulled By: NivekT

fbshipit-source-id: 80b9569ad5a26b5a03e02d38001f88ec0599bc4b",Kevin Tse,ktse@fb.com,2022-06-09 21:47:30,"['docs/source/_templates/function.rst', 'docs/source/torchdata.datapipes.utils.rst', 'torchdata/datapipes/utils/_visualization.py']",True
2cc539b0cb045a7979a1d470488cc01db7bdf99e,"add utitlity to visualize datapipe graphs (#330)

Summary:
Closes https://github.com/pytorch/data/issues/299.

Pull Request resolved: https://github.com/pytorch/data/pull/330

Reviewed By: ejguan

Differential Revision: D36990978

Pulled By: NivekT

fbshipit-source-id: 423a52e6d59da59826d1422676d28287537dd902",Philip Meier,github.pmeier@posteo.de,2022-06-08 20:48:42,"['.github/workflows/lint.yml', 'docs/source/conf.py', 'docs/source/torchdata.datapipes.utils.rst', 'mypy.ini', 'torchdata/datapipes/utils/__init__.py', 'torchdata/datapipes/utils/_visualization.py']",False
bb78231e5f87620385cb2f91cda87e7f9414eb4a,"Add support for hf `datasets` reader (#490)

Summary:
In working on https://github.com/pytorch/data/issues/422 I realized we needed an easier way to run benchmarks on larger datasets that may not be available on domain libraries. This PR is a prerequisite to any sort of scaling benchmarks and is generally a useful reader for the community.

https://huggingface.co/docs/datasets/how_to has about 10,000 datasets we can leverage out of the box - in particular mc4 is one we need to prove out large scale benchmarks for text

See test and docstring for usage instructions

### Changes

- Added a new `HuggingFaceHubReaderIterDataPipe` so we can load a large number of datasets for performance benchmarks
- Added a test which is skipped if `datasets` library does not exist
- pytest passes
- Got rid of `StreamWrapper`
- Is there any documentation update I should make?

Pull Request resolved: https://github.com/pytorch/data/pull/490

Reviewed By: NivekT, ninginthecloud

Differential Revision: D36910175

Pulled By: msaroufim

fbshipit-source-id: 3ce2d5bc0ad46b626baa87b59930a3c6f5361425",Mark Saroufim,marksaroufim@fb.com,2022-06-07 17:08:27,"['mypy.ini', 'test/requirements.txt', 'test/test_huggingface_datasets.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/huggingface.py']",False
d19858202df7e8b75765074259e6023f539cbf3f,"Improve fsspec DataPipe to accept extra keyword arguments (#495)

Summary:
Fixes https://github.com/pytorch/data/issues/494

### Changes

- Add `kwargs` to all `DataPipe`s using `fsspec`
- Fix a bug in `FSSpecFileLister` to prevent joining paths from the root path if the root path has already presented in the paths.
- Add/Fix more tests

I need this PR to test the performance between `fsspec` and native `s3`

Pull Request resolved: https://github.com/pytorch/data/pull/495

Reviewed By: NivekT

Differential Revision: D36908570

Pulled By: ejguan

fbshipit-source-id: 93da4c1c7e18012fb053799265375124d28a856c",Erjia Guan,erjia@fb.com,2022-06-07 13:35:40,"['test/requirements.txt', 'test/test_remote_io.py', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/s3io.py']",False
f54b3ae4c3b6fd819d7a622162c3d3008de025cb,"Add list_file() functional API to FSSpecFileLister and IoPathFileLister (#463)

Summary:
Fixes https://github.com/pytorch/data/issues/387

### Changes
- Adds `list_file()` method on `IoPathFileListerIterDataPipe`
- Adds `list_file()` method on `FSSpecFileListerIterDataPipe`
- Add tests for those methods

#### Additional comments
I feel as if the implementation is quite naive. Would appreciate any feedback on it.

Pull Request resolved: https://github.com/pytorch/data/pull/463

Reviewed By: NivekT

Differential Revision: D36777142

Pulled By: ejguan

fbshipit-source-id: 1c4474776f3fcd377ae545bd8bd7bf26d0b2fa88",Robert Xiu,xiurobert@gmail.com,2022-06-03 21:52:22,"['test/test_fsspec.py', 'test/test_local_io.py', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py']",False
5aac88f1dbaba288ee03f3ff872c87fb0d7b4018,"Adding DataLoader2 Adapter API and shuffle adapter (#484)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/484

Test Plan: Imported from OSS

Reviewed By: NivekT, Miiira

Differential Revision: D36866291

Pulled By: VitalyFedyunin

fbshipit-source-id: 1df16c3c45518a069dd87a5565d418ced750ae09",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2022-06-03 17:06:13,"['test/test_adapter.py', 'torchdata/dataloader2/adapter.py', 'torchdata/dataloader2/dataloader2.py']",False
6f1f81db751d28e675728ab36007be05db0614af,"Update tutorial about placing sharding_filter (#487)

Summary:
See the feedback from a user: https://github.com/pytorch/data/issues/454#issuecomment-1143256345

We should explicitly ask users to place `sharding_filter` as early as possible.

Pull Request resolved: https://github.com/pytorch/data/pull/487

Reviewed By: wenleix

Differential Revision: D36812259

Pulled By: ejguan

fbshipit-source-id: 4c983f3216a80be398f85b20871e65b0e41627e0",Erjia Guan,erjia@fb.com,2022-06-02 15:40:27,['docs/source/tutorial.rst'],False
cd38927904836f6f67ce33bfaee094fff4078402,"Fix workspace path (#486)

Summary:
Add the missing env variable `WORKSPACE` to the workflow.
See: https://github.com/pytorch/data/runs/6687888202?check_suite_focus=true#step:8:107

Pull Request resolved: https://github.com/pytorch/data/pull/486

Reviewed By: NivekT

Differential Revision: D36810167

Pulled By: ejguan

fbshipit-source-id: 3a82646ebf6ef36fd4586fb543b316045160c346",Erjia Guan,erjia@fb.com,2022-06-01 15:04:25,['.github/workflows/_build_test_upload.yml'],False
aab67f314d9c8329ea688e5841abc16cbe2c4f42,"Adding a 's' to the functional names of open/list DataPipes (#479)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/479

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36785643

Pulled By: NivekT

fbshipit-source-id: 02c3071047ac00dd34cb83a9b392be0cfa3565b0",Kevin Tse,ktse@fb.com,2022-06-01 01:24:35,"['test/test_fsspec.py', 'test/test_local_io.py', 'torchdata/datapipes/iter/load/README.md', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/s3io.py']",False
8527864ae9e0692b62e05b708bc100e48860aaf8,"Add Token for Conda RC Release (#481)

Summary:
Follow up PR for https://github.com/pytorch/data/issues/472
The Test token is required to be added to `env` for the uploading step in workflow

Pull Request resolved: https://github.com/pytorch/data/pull/481

Reviewed By: NivekT, bearzx

Differential Revision: D36782535

Pulled By: ejguan

fbshipit-source-id: 214ee664335b05c7689a7eb16b89bad77b90a233",Erjia Guan,erjia@fb.com,2022-05-31 20:05:47,['.github/workflows/_build_test_upload.yml'],False
7fde5a74f2f821db6e8435a4953db3586728a66f,"Enable AWSSDK on Linux by statically linking OpenSSL and cURL (#421)

Summary:
This PR adds all supports to enable awssdk for linux releases
- The linux release workflow starts to use `pytorch/manylinux-cpu` docker to align with compiler version with PyTorch Core
- Add shell script to install OpenSSL and cURL on docker image (This step can be improved if TorchData wants to own a new docker image with these two libraries pre-built)
- Update `torchdata/csrc/CMakeLists.txt` to respect the static OpenSSL and cURL
- Correct `thrid_party/CMakeLists.txt` without adding redundant dependencies for `_torchdata`
- Add `auditwheel show` to validate the binaries are `manylinux_2_17` (alias of `manylinux2014`)
- Update Readme for release
- Make our testing CI running with AWSSDK enabled by default to save more time/money to run CI tests
- Remove redundant `numpy` dependency introduced by `tf_record`. And, fix tests in this file

See the workflow for night release: https://github.com/pytorch/data/actions/runs/2391843245
See the `manylinux` version: https://github.com/pytorch/data/runs/6612861049?check_suite_focus=true#step:9:67

`manylinux_2_17_x86_64` is the alias of `manylinux_2014`

Pull Request resolved: https://github.com/pytorch/data/pull/421

Reviewed By: NivekT

Differential Revision: D36641092

Pulled By: ejguan

fbshipit-source-id: 349bfd896ee0db01eea849580984f4000ca2bc3f",Erjia Guan,erjia@fb.com,2022-05-31 18:25:22,"['.github/workflows/_build_test_upload.yml', '.github/workflows/ci.yml', 'packaging/README.md', 'packaging/manylinux/install_openssl_curl.sh', 'packaging/manylinux/python_helper.sh', 'packaging/torchdata/meta.yaml', 'third_party/CMakeLists.txt', 'torchdata/csrc/CMakeLists.txt']",False
3d967c63450b561355bdce719a0db1950ac1f9eb,"Add release notes script (#467)

Summary:
This PR is adapted from PyTorch Core to help creating a list of commits with corresponding PR links.
https://github.com/pytorch/pytorch/tree/master/scripts/release_notes

It should help us to aggregate and categorize commits in the future.

I will create a release note runbook for us to follow. The main steps to run this script:
```
python commitlist.py --create_new tags/v0.3.0 <commit_hash_on_new_release>  # Create a csv file to list all commits
python commitlist.py --update_to <commit_hash_on_new_release>  # When we have new cherry-picked PRs landed onto release branch
python commitlist.py --export_markdown  # Based on the categorization, create separate MD files per category
```

Pull Request resolved: https://github.com/pytorch/data/pull/467

Reviewed By: NivekT

Differential Revision: D36678629

Pulled By: ejguan

fbshipit-source-id: d5e644b0fb01c12d451f81c4cde0d1f7e60c6198",Erjia Guan,erjia@fb.com,2022-05-26 15:56:25,"['.gitignore', 'scripts/release_notes/commitlist.py', 'scripts/release_notes/common.py']",False
0233baafbcb6eb3277936bf0248be2bc53b48cf6,"Fix TF Record test (#471)

Summary:
Fixes https://github.com/pytorch/data/issues/470

### Changes

- Add `test/requirements.txt` to specify test dependencies
- Specify `protobuf` version smaller than 4
- Remove redundant `numpy` requirements
- Fix lint error on main branch

Pull Request resolved: https://github.com/pytorch/data/pull/471

Reviewed By: NivekT

Differential Revision: D36702476

Pulled By: ejguan

fbshipit-source-id: 00554128e89a0fb4fc5157495ec3d20ffb4d6396",Erjia Guan,erjia@fb.com,2022-05-26 15:54:51,"['.github/workflows/_build_test_upload.yml', '.github/workflows/ci.yml', 'README.md', 'packaging/build_wheel.sh', 'packaging/torchdata/meta.yaml', 'test/requirements.txt', 'test/test_tfrecord.py', 'torchdata/datapipes/iter/load/README.md']",False
7575bd6eb2f06a2e38d1276bdb20ae3b16070111,"Add conda token for test channel (#472)

Summary:
We have one missing token for conda RC channel. See: https://github.com/pytorch/data/actions/runs/2390820859

After devinfra team provides, we need to update the test_release workflow correspondingly.

Pull Request resolved: https://github.com/pytorch/data/pull/472

Reviewed By: NivekT, atalman

Differential Revision: D36703135

Pulled By: ejguan

fbshipit-source-id: d63f73cb82e8db671567e050bef8a2c50ba9a69b",Erjia Guan,erjia@fb.com,2022-05-26 15:43:23,"['.github/workflows/_build_test_upload.yml', '.github/workflows/test_release.yml']",False
62fe510979dbaab971b64457abdf07ecf9857205,"update s3 test cases (#464)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes https://github.com/pytorch/data/issues/460

### Changes

- update the s3 test cases due to an update in the public dataset

Pull Request resolved: https://github.com/pytorch/data/pull/464

Reviewed By: NivekT

Differential Revision: D36678285

Pulled By: ejguan

fbshipit-source-id: 5e579d20290aec0f4f0a17031fe1bb256a640231",Daiming Yang,ydaiming@outlook.com,2022-05-26 13:28:59,"['README.md', 'test/test_remote_io.py', 'torchdata/datapipes/iter/load/README.md']",False
0f0d13d8f9376ad9857b0713b170972444d1c6f8,"GDriveReader: handle Virus Scan Warning using confirm=t (#442)

Summary:
Fixes https://github.com/pytorch/data/issues/204

The Google Drive links used to download certain datasets takes us to a page like the following (the screenshot is from https://drive.google.com/uc?export=download&id=0Bz8a_Dbh9QhbUkVqNEszd0pHaFE):
![image](https://user-images.githubusercontent.com/1562553/169898009-0840b91d-6fe0-4a9d-b7fb-3e33dad514bb.png)

It seems like the previous method for dealing with this via the `download_warning` cookie is no longer working. Instead it seems Google Drive now always uses ""t"" as the confirm_token. My patch sets the confirm_token if it detects the ""Download anyway"" string in the page.

Pull Request resolved: https://github.com/pytorch/data/pull/442

Reviewed By: NivekT

Differential Revision: D36639307

Pulled By: ejguan

fbshipit-source-id: 33d71e9d8b75ae75758a4eacd3e5a7ffdfb00b6c",Benjamin Cheng,ben@bcheng.me,2022-05-26 13:19:50,['torchdata/datapipes/iter/load/online.py'],False
034169fe65a5eccc6fc43070d23bd0db67cd1d62,"Add OSS tests of data loader v2 with reading service (#459)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/459

* Add initial OSS tests and examples for data loader v2 with reading service.

Reviewed By: Miiira

Differential Revision: D36635447

fbshipit-source-id: 7550aed5dcd6f8839e3905f537c3ae25fc2de760",Danny Huang,dannyhuang@fb.com,2022-05-26 00:11:14,['test/test_dataloader2.py'],False
a109cc3d054155e902418a6dfb0e25e20066ec8a,"Fixing tutorial with DataLoader (#458)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/458

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36645515

Pulled By: NivekT

fbshipit-source-id: 1cb9b2ad51cfd45fce2cc77df70b797eafb0a337",Kevin Tse,ktse@fb.com,2022-05-25 19:46:04,"['README.md', 'docs/source/torchdata.datapipes.map.rst', 'docs/source/tutorial.rst']",False
ec83d11f6a800b09144599750efef19989a50764,"Temporarily disable AWSSDK functional tests (#461)

Summary:
This PR will temporarily disable the tests for AWSSDK due to https://github.com/pytorch/data/issues/460

The actual fix requires AWS team's contribution.

Pull Request resolved: https://github.com/pytorch/data/pull/461

Reviewed By: NivekT

Differential Revision: D36664896

Pulled By: ejguan

fbshipit-source-id: 65862f44349983afe0d358b62f2dd7999b5a4649",Erjia Guan,erjia@fb.com,2022-05-25 14:52:06,['test/test_remote_io.py'],False
24ff1b53fbe9aae2efc3f98854a6e77d1564a152,"Fix installation doc (#455)

Summary:
Fixes https://github.com/pytorch/data/issues/453

Pull Request resolved: https://github.com/pytorch/data/pull/455

Reviewed By: NivekT

Differential Revision: D36630046

Pulled By: ejguan

fbshipit-source-id: f18493cbab09be4b5216bf122e413d9247c4ede5",Erjia Guan,erjia@fb.com,2022-05-24 17:30:36,['README.md'],False
13b574c80e8732744fee6ab9cb7e35b5afc34a3c,"Remove docs from flake8 (#446)

Summary:
In release branch, due to my PR https://github.com/pytorch/data/pull/444. The lint CI is broken because I remove getting version from `torchdata` and `torchdata` is imported but not used in docs anymore.

I don't want to add more burden for ppl whoever takes in charge of release engineering in the future. I believe it's not necessary to check flake8 for docs folder.

Pull Request resolved: https://github.com/pytorch/data/pull/446

Reviewed By: NivekT

Differential Revision: D36610568

Pulled By: ejguan

fbshipit-source-id: 3b690a9dcdd5c3c6f32a5e0aa58fa60b75dc1140",Erjia Guan,erjia@fb.com,2022-05-24 00:56:48,['.flake8'],False
f1b61972666e3beea71a70e4042aa7ecec9ac8cc,"Bump version to 0.5.0 (#445)

Summary:
Bump version on main branch after release branch cut

Pull Request resolved: https://github.com/pytorch/data/pull/445

Reviewed By: wenleix, NivekT

Differential Revision: D36609418

Pulled By: ejguan

fbshipit-source-id: 5377329fb40c3569f0dcb9c740c6edf4680f4a6a",Erjia Guan,erjia@fb.com,2022-05-24 00:53:55,['version.txt'],False
0db2f61464f069a3c5b61478076adad295dfdf24,"Small fix to functional name and usage example (#440)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/440

Fixes #433

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36601420

Pulled By: NivekT

fbshipit-source-id: a84103c7b8809c1ec7a31461538b4ad20f338fed",Kevin Tse,ktse@fb.com,2022-05-23 22:27:38,"['torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/hashchecker.py']",False
15591ae146a7b4c5cb0928da68ff1282812fe7c2,"Remove duplicate graph_utils (#437)

Summary:
Fixes https://github.com/pytorch/data/issues/435

Pull Request resolved: https://github.com/pytorch/data/pull/437

Reviewed By: NivekT

Differential Revision: D36595165

Pulled By: ejguan

fbshipit-source-id: 7cbcd562ef32410e0dc2e82593fd41e61a565256",Erjia Guan,erjia@fb.com,2022-05-23 20:00:29,"['torchdata/dataloader2/_graph_utils.py', 'torchdata/dataloader2/graph.py']",False
12cfaf8899b1337981cd4edf9deef127f925f1bd,"Add linter to check if shuffle before sharding (#429)

Summary:
This PR introduces the linter function to validate there is a shuffle operation before sharding. (Required by TorchText in https://github.com/pytorch/text/pull/1729)

- When `sharding_filter` is not presented in the graph, this function always returns `True`
- For single-path graph, `shuffle` needs to be placed before `sharding_filter`.
- For multi-path graph, any `sharding_filter` requires a `shuffle` before along the path

This linter function won't check if there are multiple `sharding_filter` in the graph or `sharding_filter` is at the right place

Pull Request resolved: https://github.com/pytorch/data/pull/429

Reviewed By: NivekT

Differential Revision: D36529167

Pulled By: ejguan

fbshipit-source-id: 56e734eac98b2ddadcd7707ee92ea4032a896969",Erjia Guan,erjia@fb.com,2022-05-20 18:10:06,"['test/test_linter.py', 'torchdata/dataloader2/linter.py', 'torchdata/dataloader2/reading_service.py']",False
fddd5ec84881cdb0de3c67fea9524e7047a860b8,"Updating DataPipe naming guidelines (#428)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/428

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36526781

Pulled By: NivekT

fbshipit-source-id: c77d7998d985964e723f85a8cacce94a037886f5",Kevin Tse,ktse@fb.com,2022-05-20 15:56:56,"['CONTRIBUTING.md', 'docs/source/tutorial.rst']",False
f984f2b425634a7d9096d37b0f31c5a44968f2ba,"Changing imports of DataPipe from Core to TorchData (#430)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/430

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36530195

Pulled By: NivekT

fbshipit-source-id: b65fac9683e89f34cd8496fca4a17afa58b0c952",Kevin Tse,ktse@fb.com,2022-05-20 14:50:12,"['torchdata/dataloader2/_graph_utils.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/graph.py', 'torchdata/dataloader2/reading_service.py']",False
6a8415b1ced33e5653f7a38c93f767ac8e1c7e79,"Moving DataPipe buffers from __iter__ to instance (self) (#388)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/388

This PR impacts `ParagraphAggregator` and `IterKeyZipper` as they previously have their buffer with the iterator rather than the instance.

This should be landed along with https://github.com/pytorch/pytorch/pull/76999 and https://github.com/pytorch/pytorch/pull/77775

Note that the CI is expected to fail until that PR goes into nightly

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36519522

Pulled By: NivekT

fbshipit-source-id: cc3616e1941777771e8c8b5cd26953f2f6ed48c8",Kevin Tse,ktse@fb.com,2022-05-19 22:18:27,"['torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py']",False
7362f7d16448b9cebc249a00d2d9324d4f400a79,"Updating test code to follow single iterator constraint (#386)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/386

This should be landed after https://github.com/pytorch/pytorch/pull/75995

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36182556

Pulled By: NivekT

fbshipit-source-id: b9dbbb6a75f97d808a562bb1b5309711eff82f16",Kevin Tse,ktse@fb.com,2022-05-19 19:16:16,"['test/test_iterdatapipe.py', 'test/test_local_io.py', 'test/test_serialization.py']",True
755577961fa8b63f713b6c7649ece1aebe17b275,"Add portalocker to Conda & Disable tests for release (#425)

Summary:
Per title

I have to disable tests otherwise I can't release any nightly build. Since PyTorch nightly has been updated, we should be fine.

Pull Request resolved: https://github.com/pytorch/data/pull/425

Reviewed By: NivekT

Differential Revision: D36518178

Pulled By: ejguan

fbshipit-source-id: 07aa4f5e7d2a7cb2d15b6cdc8066feb07fbad2d1",Erjia Guan,erjia@fb.com,2022-05-19 16:46:48,"['.github/workflows/_build_test_upload.yml', 'packaging/torchdata/meta.yaml']",False
b7e5702306d1dee85c8e2b9d8b046a21de31bf81,"Revert more for awssdk (#424)

Summary:
Follow up for https://github.com/pytorch/data/pull/423

Pull Request resolved: https://github.com/pytorch/data/pull/424

Reviewed By: NivekT

Differential Revision: D36516526

Pulled By: ejguan

fbshipit-source-id: 93287442cb1f96f6910f67935b03577a4edaf1d8",Erjia Guan,erjia@fb.com,2022-05-19 15:25:08,['.github/workflows/_build_test_upload.yml'],False
71944e9670bd527e940b669bb9aedf7988da712c,"Temporarily revert awssdk on linux (#423)

Summary:
Due to AWSSDK requires libcrypto, which is not included manylinux standard, the linux binary breaks TorchVision's CI.

I am reverting awssdk built for linux before I figure out make `libcrypto` and `libssl` all statically linked to aws and packaged into TorchData.

Pull Request resolved: https://github.com/pytorch/data/pull/423

Reviewed By: NivekT

Differential Revision: D36515521

Pulled By: ejguan

fbshipit-source-id: b0419aef3100d6a98a030916c6ce9385514e3ef2",Erjia Guan,erjia@fb.com,2022-05-19 14:31:37,['.github/workflows/_build_test_upload.yml'],False
42922cfb99e0aeb5cb0e19ecb6927f38477a1eef,"Adding lock mechanism to prevent on_disk_cache downloading twice (#409)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/409

Fixes #144

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36489060

Pulled By: VitalyFedyunin

fbshipit-source-id: d33624d2d38d4756789b1ebb09eb05d2b4efe6a6",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2022-05-19 03:57:09,"['requirements.txt', 'test/test_local_io.py', 'test/test_remote_io.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/saver.py']",False
a92f5730a8a7a3519598ec9e7a49cad0fcce7743,"Solve issue #282: Update FSSpecFileLister, IoPathFileLister (#383)

Summary:
Fixes https://github.com/pytorch/data/issues/282

Updated FSSpecFileLister and IoPathFileLister to optionally take a list of strings as root paths. As per the contributors guideline, added tests to the testsuite to cover changes and ran the pre-commit format checker.

### Changes
- Updated FSSpecFileLister to take either a str or sequence of strings as root path argument (in \_init_ arguments)

- Updated \_init_ of FSSpecFileLister to check if root argument is string or list and make into IterDataPipe

- Updated \_iter_ of FSSPecFileLister to look through all root paths when yielding files

- Added unit test in test_fsspec.py to test for multiple root path input to FSSpecFileLister

- Updated IoPathFileLister to take either a str or sequence of strings as root path argument (in \_init_ arguments)

- Updated \_init_ of IoPathFileLister to check if root argument is string or list and make into IterDataPipe

- Updated \_iter_ of IoPathFileLister to look through all root paths when yielding files

- Added unit test in test\_local_io.py to test for multiple root path input to IoPathFileLister

Pull Request resolved: https://github.com/pytorch/data/pull/383

Reviewed By: wenleix, ejguan

Differential Revision: D36152778

Pulled By: NivekT

fbshipit-source-id: 1ff5cfa23a27d05d718531eac678b5126e2fc1f4",Yousef Abu-Salah,42948521+ykabusalah@users.noreply.github.com,2022-05-19 03:11:07,"['test/test_fsspec.py', 'test/test_local_io.py', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py']",False
4dc6191037818c3423f3a4a54fbf80897d440833,"Fix lint (#417)

Summary:
Fix lint Error introduced by https://github.com/pytorch/data/pull/411

Pull Request resolved: https://github.com/pytorch/data/pull/417

Reviewed By: NivekT, msaroufim

Differential Revision: D36466553

Pulled By: ejguan

fbshipit-source-id: ef246d5636a738bc97fba06330cdd99b39a13c8f",Erjia Guan,erjia@fb.com,2022-05-18 20:53:29,['test/test_dataloader2.py'],False
f80d07b0670ca2c68f06e4dfe236a6dbe6dd1b28,"Use manylinux2014 & enable macos for AWSSDK (#415)

Summary:
- Change target platform to manylinux2014 for linux (See workflow: https://github.com/pytorch/data/runs/6479078172?check_suite_focus=true#step:9:87)
  - `manylinux_2_17_x86_64` is an alias of `manylinux2014`
  - See [PEP600](https://peps.python.org/pep-0600/)
- Re-enable MacOS binary with AWSSDK after https://github.com/pytorch/text/pull/1728 is landed.

See workflow: https://github.com/pytorch/data/actions/runs/2341532489

Pull Request resolved: https://github.com/pytorch/data/pull/415

Reviewed By: NivekT, bearzx

Differential Revision: D36460356

Pulled By: ejguan

fbshipit-source-id: 9aa349aba2e5e1a5073f7be27f4ae8466bc8ce7e",Erjia Guan,erjia@fb.com,2022-05-18 00:56:27,"['.github/workflows/_build_test_upload.yml', 'packaging/manylinux_wheel_helper.sh', 'third_party/CMakeLists.txt', 'tools/setup_helpers/extension.py']",False
5c1238e8d18e13214bd5aca3e5ebb3cfc5145e17,"Add initial OSS tests for data loader v2 (#411)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/411

* Add initial OSS tests for data loader v2.

Reviewed By: Miiira

Differential Revision: D36389135

fbshipit-source-id: 6aebc38bdc36f9d0f9e50f5dcf0485b3cd4fe3d5",Danny Huang,dannyhuang@fb.com,2022-05-17 23:16:15,['test/test_dataloader2.py'],False
ea822945d345adc4847bd56bf03b0cb07667e0d3,"Make requirements.txt single source of truth (#414)

Summary:
Hi, this fixes https://github.com/pytorch/data/issues/410.

Pull Request resolved: https://github.com/pytorch/data/pull/414

Reviewed By: ejguan

Differential Revision: D36445769

Pulled By: NivekT

fbshipit-source-id: 929a0d3160f62c5da64c429012862710447e5220",tal66,77445020+tal66@users.noreply.github.com,2022-05-17 16:47:18,['setup.py'],True
5028134614243820e21566ea2d13cb0a5d769e8f,"added `filelock` in `IoPathSaverIterDataPipe` (#413)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes https://github.com/pytorch/data/issues/397

This is an identical PR to https://github.com/pytorch/data/pull/395 which I accidentally deleted during a bad force push trying to resolve a rebase

Pull Request resolved: https://github.com/pytorch/data/pull/413

Reviewed By: ejguan

Differential Revision: D36433231

Pulled By: msaroufim

fbshipit-source-id: 0f71790eaded445f8e42911db4bea4c468175520",Mark Saroufim,marksaroufim@fb.com,2022-05-17 09:34:23,"['test/test_local_io.py', 'torchdata/datapipes/iter/load/iopath.py']",False
2c7a9135c3522c14ab15d13c2659dd4426c9b795,"fix lint error for `load_state_dict` API (#408)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes  lint errors in previous `load_state_dict` API  [commit](https://github.com/pytorch/data/commit/02157d825af9a31b0f782a9b2a9d504c59a28280)

### Changes

- update based on ```pre-commit run --files torchdata/dataloader2/dataloader2.py```

Pull Request resolved: https://github.com/pytorch/data/pull/408

Reviewed By: ejguan

Differential Revision: D36418503

Pulled By: ninginthecloud

fbshipit-source-id: 4cc06ab0122930b152f552c0a01a660f5628c67d",Ning Li (Seattle),ningli@fb.com,2022-05-17 03:53:14,['torchdata/dataloader2/dataloader2.py'],False
5ded82d250b08172556d82f2a8821de643f89075,"Enable S3 in nightly release (#399)

Summary:
Partially fix https://github.com/pytorch/data/issues/349

This PR enables:
- Wheel
  - Linux
  - Windows
- Conda
  - Linux

MacOS is disabled because AWSSDK requires `MACOSX_DEPLOYMENT_TARGET>10.13`. However, TorchText requires a minimum version of `MACOSX_DEPLOYMENT_TARGET` as 10.9 (Tracked in TorchText https://github.com/pytorch/text/issues/1725)

And, the conda build on Windows is also disabled for now due to unkown issue (needs more time). Want to land this PR to start testing with TorchText nightly.

See the manually triggered nightly build: https://github.com/pytorch/data/actions/runs/2334403716

Pull Request resolved: https://github.com/pytorch/data/pull/399

Reviewed By: bearzx

Differential Revision: D36423843

Pulled By: ejguan

fbshipit-source-id: 419c182b6ac3d1addaef9d52c1bae97218433bfd",Erjia Guan,erjia@fb.com,2022-05-17 02:29:12,"['.github/workflows/_build_test_upload.yml', '.gitignore', 'packaging/pkg_helpers.bash', 'packaging/torchdata/bld.bat', 'packaging/torchdata/meta.yaml', 'test/test_serialization.py', 'test/test_tfrecord.py', 'third_party/CMakeLists.txt', 'tools/__init__.py', 'torchdata/csrc/CMakeLists.txt']",False
3c7769682b5263acd889c7e7f0187323f7d9e9da,"Adding ability to use dill to pass DataPipes in mutiprocessing (#77288)

Summary:
X-link: https://github.com/pytorch/pytorch/pull/77288

Fixes part of https://github.com/pytorch/data/issues/397 (only DataLoader v2 remaining)

Reviewed By: NivekT, ejguan

Differential Revision: D36347737

Pulled By: VitalyFedyunin

fbshipit-source-id: 144d149f1da98b7108f54e9dcecda0f5740d1eb9",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2022-05-15 22:48:42,['test/test_graph.py'],False
33b5f2fadb9b983160a2df94f4efeba66bcf57d1,"Update dataloader v2 checkpoint comment (#400)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/400

* Update the docstring in dataloader v2 checkpoint.

Reviewed By: Miiira

Differential Revision: D36331042

fbshipit-source-id: 3b2673d33027f8df79777d0dd8e821715e144f00",Danny Huang,dannyhuang@fb.com,2022-05-13 13:09:58,['torchdata/dataloader2/dataloader2_checkpoint_utils.py'],False
02157d825af9a31b0f782a9b2a9d504c59a28280,"implement `load_state_dict` API for DataLoaderV2

Summary:
This diff aims to create `load_state_dict()` API for dataloaderV2.

This diff aims to do the following things:
1) throw assertion when dataloaderV2 has already created iteartor (self._reset_iter is True)

2) reset `self.datapipe` and `self.reading_service_state`

3 reset `datapipe_adapter_fn` and `_datapipe_before_reading_service_adapt`

Detailed discussion can be found in doc https://docs.google.com/document/d/1KcEJh51NBFIFTsrHbos8eYxhlklYucIxIvssHfwL-60/edit?usp=sharing

Reviewed By: Miiira

Differential Revision: D35942272

fbshipit-source-id: dcd89a1df74b4ac12c8d88d9ce61ce35a79383a7",Ning Li (Seattle),ningli@fb.com,2022-05-12 17:31:22,['torchdata/dataloader2/dataloader2.py'],False
2be83243ed18c77efe2fd926c0fd7b5998d13d38,"add aws-sdk-cpp as sub-module (#380)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes #{issue number}

This is the second follow-up task among https://github.com/pytorch/data/issues/349

### Changes

- Add `aws-sdk-cpp` as sub-module
-

Pull Request resolved: https://github.com/pytorch/data/pull/380

Reviewed By: NivekT

Differential Revision: D36314778

Pulled By: ejguan

fbshipit-source-id: 592a4ee1c261281778eae15bf4f6bfd5459b2607",Daiming Yang,ydaiming@outlook.com,2022-05-12 15:09:57,"['.github/workflows/ci.yml', '.gitmodules', 'CMakeLists.txt', 'third_party/CMakeLists.txt', 'third_party/aws-sdk-cpp', 'tools/setup_helpers/extension.py', 'torchdata/csrc/CMakeLists.txt']",False
0e6554a5cb2747f01e39dc529e21009ff12e4e7a,"Update ReadingService Comments (#398)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/398

per title

Reviewed By: ejguan

Differential Revision: D36322514

fbshipit-source-id: f17a29dfa380a8c25397b48b165873ab1965c74d",Yingxin Kang,yingxinkang@fb.com,2022-05-12 02:28:43,['torchdata/dataloader2/reading_service.py'],False
d28a2fc2b5ef454803b9ea7385d4aef6150968fe,"Fix lint and test Error introduced by DataLoader2 (#394)

Summary:
Per title
- For lint, auto generated by `pre-commit run --all-files`
- For test Error, add `fork` as the start method for multiprocessing. And, skip this test for windows because there is no `fork` on windows system.

Pull Request resolved: https://github.com/pytorch/data/pull/394

Reviewed By: NivekT

Differential Revision: D36289308

Pulled By: ejguan

fbshipit-source-id: c81364e3ecba225cde074ab76c5f7c7d637c7656",Erjia Guan,erjia@fb.com,2022-05-11 20:23:49,"['test/_utils/_common_utils_for_test.py', 'test/test_dataloader2_checkpoint_utils.py', 'test/test_graph.py', 'torchdata/dataloader2/_graph_utils.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/dataloader2_checkpoint_utils.py', 'torchdata/dataloader2/error.py', 'torchdata/dataloader2/graph.py', 'torchdata/dataloader2/reading_service.py']",False
a7f89365d380bc72da42766c47e20cc2191d9e83,"add support for `**kwargs` in `HttpReader` (#392)

Summary:
Please read through our [contribution guide](https://github.com/pytorch/data/blob/main/CONTRIBUTING.md) prior to
creating your pull request.

- Note that there is a section on requirements related to adding a new DataPipe.

Fixes https://github.com/pytorch/data/issues/391

### Changes

- Added support for `**kwarg` for `request` parameters in `HttpReader`

Although it doesn't look like the HTTP dataset pipe is tested anywhere so I'll take a closer look and add one

Pull Request resolved: https://github.com/pytorch/data/pull/392

Reviewed By: NivekT, ejguan

Differential Revision: D36287860

Pulled By: msaroufim

fbshipit-source-id: daac6c6e3a57608928c8e262f7cdc4d5a349ee03",Mark Saroufim,marksaroufim@gmail.com,2022-05-11 19:26:57,"['CONTRIBUTING.md', 'test/test_remote_io.py', 'torchdata/datapipes/iter/load/online.py']",False
e0d0aa977c9a5f6111d70a6e7bb1ecb8d3b09db6,"dataloader v2 checkpoint utils rename (#396)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/396

* Rename the dataloader v2 checkpoint utils to be specific and to avoid overwhelming the file dataloader2_utils.py.
* Modify the tests accordingly.
* Minor format fix for dataloader v2 checkpoint utils.

Differential Revision: D36296496

fbshipit-source-id: 2c51945ab4067f51d1deaa08fc14a85f58f771e7",Danny Huang,dannyhuang@fb.com,2022-05-11 08:39:26,"['test/test_dataloader2_checkpoint_utils.py', 'torchdata/dataloader2/dataloader2_checkpoint_utils.py']",False
55348db3d127ff55032efa5fa31b47e46638ef4c,"Update serialization test due to changes from Core (#385)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/385

This should be landed with https://github.com/pytorch/pytorch/pull/74984

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36265722

Pulled By: NivekT

fbshipit-source-id: 52de5a11e08408c68be9e04192d4cefd40b110ac",Kevin Tse,ktse@fb.com,2022-05-10 15:37:24,['test/test_serialization.py'],False
0501f56323c09814c6c60a4bee4ffb6ca3d601d4,"Moving DataLoader2 into the OpenSource

Reviewed By: dahsh, ejguan, Miiira

Differential Revision: D36258356

fbshipit-source-id: 43b7807d300f0e8858d6a70b667f041856113b26",Vitaly Fedyunin,vitalyf@fb.com,2022-05-10 07:31:34,"['test/test_dataloader2_utils.py', 'test/test_graph.py', 'torchdata/dataloader2/__init__.py', 'torchdata/dataloader2/_graph_utils.py', 'torchdata/dataloader2/dataloader2.py', 'torchdata/dataloader2/dataloader2_utils.py', 'torchdata/dataloader2/error.py', 'torchdata/dataloader2/graph.py', 'torchdata/dataloader2/reading_service.py', 'torchdata/dataloader2/shuffle_spec.py']",False
8b95954ce431ade5905448ebd9a2909e30566377,"Fix lint Error on main branch (#389)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/389

Reviewed By: NivekT

Differential Revision: D36247532

Pulled By: ejguan

fbshipit-source-id: 8bfb4fed3f74958b77f1d2a893a879f45046745c",Erjia Guan,erjia@fb.com,2022-05-09 19:32:05,"['torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/mux_longest.py', 'torchdata/datapipes/iter/util/zip_longest.py']",False
dfbd4b6dc41076a4bc25d7d9be02507f7dcdad53,"Added CI tests for torcharrow (#345)

Summary:
Fixes https://github.com/pytorch/data/issues/301

### Changes

-Added torcharrow config to domain_ci.yml
-

Pull Request resolved: https://github.com/pytorch/data/pull/345

Reviewed By: wenleix, ejguan

Differential Revision: D35450129

Pulled By: NivekT

fbshipit-source-id: 90e4c19ed7578bd61e334c0266d7265e6896687e",Lezwon Castelino,lezwon@gmail.com,2022-05-09 15:37:36,['.github/workflows/domain_ci.yml'],False
0d8301696719094acc410bec8e3d8996e9ff847f,"Update `zip_longest` data pipe (#373)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/373

OSS issue discussion: https://github.com/pytorch/data/issues/346
This diff updates `zip` and `zip_longest` data pipe.
`zip`: Aggregates elements into a tuple from each of the input DataPipes (functional name: ``zip``).
    The output is stopped as soon as the shortest input DataPipe is exhausted.

`zip` example:

```
>>> from torchdata.datapipes.iter import IterableWrapper
>>> dp1, dp2, dp3 = IterableWrapper(range(5)), IterableWrapper(range(10, 15)), IterableWrapper(range(20, 25))
>>> list(dp1.zip(dp2, dp3))
[(0, 10, 20), (1, 11, 21), (2, 12, 22), (3, 13, 23), (4, 14, 24)]

```

`zip_longest`: Aggregates elements into a tuple from each of the input DataPipes (functional name: `zip_longest`). The output is stopped until all input DataPipes are exhausted, and skips over the finished datapipes.

`zip_longest` example:

```
 >>> from torchdata.datapipes.iter import IterableWrapper
>>> dp1, dp2, dp3 = IterableWrapper(range(3)), IterableWrapper(range(10, 15)), IterableWrapper(range(20, 25))
>>> list(dp1.zip_longest(dp2, dp3))
[(0, 10, 20), (1, 11, 21), (2, 12, 22), (13, 23), (14, 24)]
```

Reviewed By: NivekT, ejguan

Differential Revision: D35760498

fbshipit-source-id: ed0df1eff77f67c1d2c5fe7b831e157ba835ab83",Ning Li (Seattle),ningli@fb.com,2022-05-09 04:52:52,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/zip_longest.py']",False
3af7615c8ab7229f73aa0feb156e23ac1020c173,"Update `mux_longest` data pipe (#372)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/372

OSS issue discussion: https://github.com/pytorch/data/issues/346
This diff updates `mux_longest` data pipe.

`mux_longest`: Yields one element at a time from each of the input Iterable DataPipes (functional name: ``mux_longest``). As in, one element from the 1st input DataPipe, then one element from the 2nd DataPipe in the next iteration, and so on. It skips over DataPipes that are exhausted, and ends when all input DataPipes are exhausted. This is  same as current `MultiplexerIterDataPipe` in pytorch (https://github.com/pytorch/pytorch/blob/4fb7fa081e4fb5df3bf7bc85dcb9a3a9a3ac7133/torch/utils/data/datapipes/iter/combining.py#L375-L390)

`mux_longest` example:

```
>>> from torchdata.datapipes.iter import IterableWrapper
>>> dp1, dp2, dp3 = IterableWrapper(range(5)), IterableWrapper(range(10, 15)), IterableWrapper(range(20, 25))
>>> list(dp1.mux_longest(dp2, dp3))
[0, 10, 20, 1, 11, 21, 2, 12, 22, 3, 13, 23, 4, 14, 24]
```

Reviewed By: NivekT, ejguan

Differential Revision: D35805772

fbshipit-source-id: c67347ed21156409703915516b6b2c12547dcfaa",Ning Li (Seattle),ningli@fb.com,2022-05-07 02:40:11,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_iterdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/mux_longest.py']",False
963033e914d59feb1cf94b86b80f62b03d262b77,"Small documentation fixes (#381)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/381

Fixing strings that aren't rendered correctly and add the ones that are missing from documentation (e.g. S3 DataPipes).

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36076937

Pulled By: NivekT

fbshipit-source-id: 572c9f136e971ad9852f9a5a1130fb16a82163dc",Kevin Tse,ktse@fb.com,2022-05-04 01:23:04,"['docs/source/conf.py', 'docs/source/torchdata.datapipes.iter.rst', 'docs/source/torchdata.datapipes.map.rst', 'torchdata/datapipes/iter/load/s3io.py', 'torchdata/datapipes/iter/util/converter.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/webdataset.py', 'torchdata/datapipes/map/util/converter.py']",False
92d18b088eb43b9805bed5c90a0afca87292a338,"Generate pyi file for MapDataPipes defined in this library (#329)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/329

I ran the script locally and the output pyi file works as expected.

Note that I plan to add some edits to our documentation to talk about our plan for `MapDataPipe`, best practices (e.g. encourage users to use `IterDataPipe` and then convert to `MapDataPipe` when necessary`), and etc.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35979904

Pulled By: NivekT

fbshipit-source-id: 3fb49f559ef1528aafa3f5bcc7b79da709a08c31",Kevin Tse,ktse@fb.com,2022-05-02 14:53:36,"['.gitignore', 'setup.py', 'tools/gen_pyi.py', 'torchdata/datapipes/map/__init__.pyi.in']",False
ce4cf8042375288763887ff197aa27db4792a07d,"Adding InMemoryCacheHolderMapDataPipe (#328)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/328

I think it will be useful to have a `MapDataPipe` for caching data, especially right before shuffling and etc. The use case should be common enough that we should support it rather than asking users to use the `iter` version.

This also have the added functionality for users to customize the wrapper around their data (e.g. user numpy array instead of list).

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35979905

Pulled By: NivekT

fbshipit-source-id: 8ff2d1f23152f9e33f4ccc22084a59e4fb25c178",Kevin Tse,ktse@fb.com,2022-05-02 14:53:36,"['docs/source/torchdata.datapipes.map.rst', 'test/test_mapdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/map/__init__.py', 'torchdata/datapipes/map/util/cacheholder.py']",True
2745b2d6a42a59a7a93b743420bf712e6571fbc9,"Adding MapToIterConverter (#327)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/327

I think this converter is necessary regardless if we decide to add more `MapDataPipe`.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35979908

Pulled By: NivekT

fbshipit-source-id: b7cd3d24de4309a2b61f0fa6130b90d184bef954",Kevin Tse,ktse@fb.com,2022-05-02 14:53:36,"['docs/source/torchdata.datapipes.map.rst', 'test/test_mapdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/map/util/converter.py']",True
412efa9af27b7c911f75d7d7ee6f3f6ba3043c06,"Small refactor to ensure 'to_map_datapipe' is generated as a method in IterDataPipe's pyi interface (#326)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/326

Previously, `.to_map_datapipe` didn't show up as a hint due to how the file crawling/parsing work in `gen_pyi.py`. This fixes it.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35979907

Pulled By: NivekT

fbshipit-source-id: d36fb9d36805d97f9ae8db378f6c4beb437443b6",Kevin Tse,ktse@fb.com,2022-05-02 14:53:36,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_serialization.py', 'tools/gen_pyi.py', 'torchdata/datapipes/iter/util/converter.py', 'torchdata/datapipes/map/__init__.py']",True
47e6fcc3eda9e3183866724739938b52f1faff61,"Adding UnZipperMapDataPipe (#325)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/325

This `MapDataPipe` seems simple enough to add but we should talk about what is the general guideline for adding `MapDataPipe` before actually doing it.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35979906

Pulled By: NivekT

fbshipit-source-id: fce7bad9b6c2dad10c815a3d708f12349519823f",Kevin Tse,ktse@fb.com,2022-05-02 14:53:36,"['docs/source/torchdata.datapipes.map.rst', 'test/test_iterdatapipe.py', 'test/test_mapdatapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/map/__init__.py', 'torchdata/datapipes/map/util/unzipper.py']",True
1171ec2215590acfe5ec0b7583578aa87f8250f4,"Updating contributing guide, small fixes, and adding guidance for MapDataPipe (#379)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/379

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D36014738

Pulled By: NivekT

fbshipit-source-id: 2e198622ace74da59f7156facec1d7dc3361cf28",Kevin Tse,ktse@fb.com,2022-04-29 01:56:04,"['CONTRIBUTING.md', 'docs/source/conf.py', 'docs/source/examples.rst', 'docs/source/torchdata.datapipes.map.rst', 'torchdata/datapipes/iter/util/unzipper.py']",False
1022be8d7ac55a24efc7d2f50dbcf2204b07b4f2,"add support for WebDataset-style archives (#367)

Summary:
WebDataset is a simple convention for representing datasets in sequentially read archives (like tar archives). It is supported natively by the [webdataset/webdataset ](https://github.com/webdataset/webdataset/) library. Torchdata contains most of the functionality of the webdataset/webdataset library already except for the grouping of samples. This PR adds a filter that groups files inside tar files into samples according to WebDataset conventions.

### Changes

- adds WebDatasetIterDataPipe
- adds test cases
- adds test case file generator to _create_fake_data.py

Pull Request resolved: https://github.com/pytorch/data/pull/367

Reviewed By: msaroufim

Differential Revision: D35943392

Pulled By: NivekT

fbshipit-source-id: 0b7dc441e536750ee77dca0677bc0d4893dbb884",Tom,tmbdev+github@gmail.com,2022-04-28 21:35:27,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_local_io.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/webdataset.py']",False
b6ade8f097bc9ac08460cd403034a35daff09cfa,"Fixes mypy problems with tfrecord_loader implementation (#374)

Summary:
This PR fixes mypy errors with TFRecord implementation.

Fixes  https://github.com/pytorch/data/issues/308

### Changes
- Example and ExampleSpec renamed to TFExample and TFExampleSpec and exported to `torchdata.datapipes.iter`

Pull Request resolved: https://github.com/pytorch/data/pull/374

Reviewed By: msaroufim

Differential Revision: D35943347

Pulled By: NivekT

fbshipit-source-id: 65b728225b21f7b36262d88a2a03e6121689488d",Jonas Kulhanek,jonas.kulhanek@live.com,2022-04-27 14:56:34,"['torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/tfrecordloader.py']",False
41e16d287af63f6a1dab999bf7a765d91f299b92,"Override wrong python https proxy on Windows (#371)

Summary:
Fixes https://github.com/pytorch/data/issues/355

This is patch to fix a bug embedded in Python `urllib` in TorchData. See: https://bugs.python.org/issue42627

Simply speaking, python uses `https` proxy for urls with `https` but windows platform expects `http` proxy for these urls.

I have no idea how to create such test for windows, I am open for suggestions

Pull Request resolved: https://github.com/pytorch/data/pull/371

Reviewed By: NivekT

Differential Revision: D35935252

Pulled By: ejguan

fbshipit-source-id: 3a23f1e60916942901a2f6aeb05f9d7a8014c5ed",Erjia Guan,erjia@fb.com,2022-04-26 20:42:19,"['test/test_remote_io.py', 'torchdata/datapipes/iter/load/online.py']",False
8d40227bba0b29451e84032a714f64b036f85761,"Add functional APIs for OnlineReader (#369)

Summary:
Changes:
- Add functional names for online readers

Pull Request resolved: https://github.com/pytorch/data/pull/369

Reviewed By: NivekT

Differential Revision: D35898806

Pulled By: ejguan

fbshipit-source-id: c0e5938631f1d5b27e12a4d615139178298bfa3a",Erjia Guan,erjia@fb.com,2022-04-25 19:34:48,['torchdata/datapipes/iter/load/online.py'],False
d9bbbecf64d0149795dc65ba390b50bc9e176e95,"Add tfrecord_loader implementation (#308)

Summary:
Fixes https://github.com/pytorch/data/issues/306

### Changes
- Added `TFRecordLoaderIterDataPipe` that parses opened tfrecord streams and yields the individual records.  It supports both `tf.train.Example` and `tf.train.SequenceExample` and users can additionally specify shape/dtype for each feature in the dict.
- Added tests for  `TFRecordLoaderIterDataPipe`.

Pull Request resolved: https://github.com/pytorch/data/pull/308

Reviewed By: VitalyFedyunin

Differential Revision: D35815993

Pulled By: NivekT

fbshipit-source-id: bd115df802634636805d79c0c10bd6965c0e9bcd",Jonas Kulhanek,jonas.kulhanek@live.com,2022-04-25 19:10:58,"['.github/workflows/_build_test_upload.yml', '.github/workflows/ci.yml', 'test/_fakedata/_create_fake_data.py', 'test/_fakedata/tfrecord/example.tfrecord', 'test/_fakedata/tfrecord/sequence_example.tfrecord', 'test/test_serialization.py', 'test/test_tfrecord.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/protobuf_template/__init__.py', 'torchdata/datapipes/iter/util/protobuf_template/_tfrecord_example_pb2.py', 'torchdata/datapipes/iter/util/protobuf_template/example.proto', 'torchdata/datapipes/iter/util/protobuf_template/feature.proto', 'torchdata/datapipes/iter/util/tfrecordloader.py']",False
c1d89fe9a1b06e610f32f823359771557b1ca12a,"Fix data-related public API (#368)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/368

This is PR aims to expose the right data-relate API.

There are two more changes made in this PR to convert public api to private api
`check_lambda_fn` -> `_check_lambda_fn`
`deprecation_warning` -> `_deprecation_warning`

X-link: https://github.com/pytorch/pytorch/pull/76143

Reviewed By: albanD, NivekT

Differential Revision: D35798311

Pulled By: ejguan

fbshipit-source-id: b13fded5c88a533c706702fb2070c918c839dca4",Erjia Guan,erjia@fb.com,2022-04-21 21:10:06,"['torchdata/datapipes/iter/transform/callable.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py', 'torchdata/datapipes/map/util/utils.py']",False
6da391e3d342248a6005c74c61499a3209bda010,"Add pybind11 as submodule (#365)

Summary:
This is the first follow-up task among https://github.com/pytorch/data/issues/349

Pull Request resolved: https://github.com/pytorch/data/pull/365

Reviewed By: VitalyFedyunin

Differential Revision: D35790044

Pulled By: ejguan

fbshipit-source-id: 7293a74374e3c7276b24e8f6f61eed8f4bef0107",Erjia Guan,erjia@fb.com,2022-04-21 13:41:03,"['.github/workflows/ci.yml', '.gitmodules', 'CMakeLists.txt', 'setup.py', 'third_party/CMakeLists.txt', 'third_party/pybind11', 'tools/setup_helpers/__init__.py', 'tools/setup_helpers/extension.py', 'torchdata/csrc/CMakeLists.txt']",False
732307a1dcea8686bff9a855bcd67c32d2087f8e,"Add input_col to flatmap (#363)

Summary:
This change is required to align DataPipe and DataFrame API

Pull Request resolved: https://github.com/pytorch/data/pull/363

Reviewed By: wenleix

Differential Revision: D35724620

Pulled By: ejguan

fbshipit-source-id: 04f25a016e8d4b52462d2b43dec22ada813b5def",Erjia Guan,erjia@fb.com,2022-04-19 13:54:25,"['test/test_datapipe.py', 'torchdata/datapipes/iter/transform/callable.py']",False
314b6f68a92c26768ea21f480c0266a068fe678b,"Fixing interface generation issue (#357)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/357

This needs to wait until https://github.com/pytorch/pytorch/pull/75602 lands

Fixes #343

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35578969

Pulled By: NivekT

fbshipit-source-id: 96df4563a8f07b179e80d78b3d5ae12bf9ff62d7",Kevin Tse,ktse@fb.com,2022-04-13 22:46:38,"['.github/workflows/ci.yml', 'setup.py', 'torchdata/datapipes/iter/__init__.pyi.in']",False
68b997f782324015baf301ac7737abc4ac711f81,"Prevent any release workflow running on fork (#361)

Summary:
This PR would prevent the nightly workflow being run on forked repo
See the action on my fork: https://github.com/ejguan/data/actions/runs/2160757127

Pull Request resolved: https://github.com/pytorch/data/pull/361

Reviewed By: NivekT

Differential Revision: D35614902

Pulled By: ejguan

fbshipit-source-id: f27e659622d75419aa134dfaf58b670d1df05bcd",Erjia Guan,erjia@fb.com,2022-04-13 21:01:13,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml', '.github/workflows/release.yml', '.github/workflows/test_release.yml']",False
6a7420b4f7c35ace56bb53e0354e0b33d7d46342,"Implement map_batches to align with TorchArrow API (#359)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/359

Reviewed By: NivekT

Differential Revision: D35581905

Pulled By: ejguan

fbshipit-source-id: 27253d59541fcae2150db3d739870f3d8f6e0a8f",Erjia Guan,erjia@fb.com,2022-04-13 19:57:21,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_datapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/callable.py', 'torchdata/datapipes/iter/transform/flatmap.py']",False
fd942eec986db373f76f521528570bfef2f1d22f,"fix deprecation warning for datapipes (#324)

Summary:
Sister PR to pytorch/pytorch#74685. Fixes https://github.com/pytorch/data/issues/322. CI will fail until the change is merged upstream.

Pull Request resolved: https://github.com/pytorch/data/pull/324

Reviewed By: ejguan

Differential Revision: D35549848

Pulled By: NivekT

fbshipit-source-id: 143f0fd9e656bd93ea540c985105b8c0d014c50f",Philip Meier,github.pmeier@posteo.de,2022-04-11 19:04:40,"['torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py']",False
9ad73d85b398828a919aef692c27f77182716aa1,"Replace with built-in write header. (#356)

Summary:
Replace the hand-crafted write header with a built-in write header.

### Changes

- Replace `writer.writerow({col: col for col in fieldnames})` with `writer.writeheader()`

Pull Request resolved: https://github.com/pytorch/data/pull/356

Reviewed By: ejguan

Differential Revision: D35548833

Pulled By: NivekT

fbshipit-source-id: ba800727f4c9a1edfc1d729db3badf2e1411f6b2",zh-plus,zhenghaosustc@gmail.com,2022-04-11 15:47:43,['docs/source/tutorial.rst'],False
4d80bc6bbf30a76ea4421b21ca4e208738c43595,"Expanding the contribution guide, especially including instructions to add a new DataPipe (#354)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/354

Expanding the contribution guide, especially including instructions to add a new DataPipe

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D35509619

Pulled By: NivekT

fbshipit-source-id: 00202ec1978f08c7024522b40235e9711c600266",Kevin Tse,ktse@fb.com,2022-04-11 14:55:59,"['.github/PULL_REQUEST_TEMPLATE.md', 'CONTRIBUTING.md']",False
88df25cb9165cf53d7d84c324e3c31f1b4899179,"Fix conda build for awssdk (#353)

Summary:
Fixes https://github.com/pytorch/data/issues/350

This is caused by `machinery` not initialized when we import `importlib`.

Pull Request resolved: https://github.com/pytorch/data/pull/353

Reviewed By: NivekT

Differential Revision: D35479982

Pulled By: ejguan

fbshipit-source-id: 44927a0b67c4027b51a22ae360d752b33d6f510f",Erjia Guan,erjia@fb.com,2022-04-08 17:56:50,"['.gitignore', 'torchdata/_extension.py']",False
93712febcdf506d2efa56c0ce08921b61a7ec8a7,"Add Examples from blog (#340)

Summary:
Adding the examples after the discussion [here](https://github.com/pytorch/data/pull/332)

Pull Request resolved: https://github.com/pytorch/data/pull/340

Reviewed By: ejguan

Differential Revision: D35501470

Pulled By: NivekT

fbshipit-source-id: 39bed9a8644d5316f5cb22550220caff68ea1807",Thomas Capelle,tcapelle@pm.me,2022-04-08 17:29:07,['docs/source/examples.rst'],False
2623265ed3cfcbb039d8e0c28c183d2cdca1a4b6,"Update license header for pytorch/data (#351)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/351

This diff is automatically generated via
```
arc lint --apply-patches --take LICENSELINT --paths-cmd ""hg files pytorch/data""
```

All files are updated or attached with new license

Reviewed By: wenleix, Miiira

Differential Revision: D35444604

fbshipit-source-id: f96985215f9ec7979c7716a70029628170706c98",Erjia Guan,erjia@fb.com,2022-04-07 19:02:45,"['CMakeLists.txt', 'docs/make.bat', 'docs/source/_static/css/custom.css', 'docs/source/conf.py', 'examples/__init__.py', 'examples/audio/librispeech.py', 'examples/text/ag_news.py', 'examples/text/amazonreviewpolarity.py', 'examples/text/imdb.py', 'examples/text/squad1.py', 'examples/text/squad2.py', 'examples/text/utils.py', 'examples/vision/__init__.py', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'examples/vision/imagefolder.py', 'packaging/build_conda.sh', 'packaging/build_wheel.sh', 'packaging/pkg_helpers.bash', 'packaging/torchdata/bld.bat', 'packaging/torchdata/build.sh', 'setup.py', 'test/_fakedata/_create_fake_data.py', 'test/_utils/__init__.py', 'test/_utils/_common_utils_for_test.py', 'test/test_audio_examples.py', 'test/test_dataframe.py', 'test/test_datapipe.py', 'test/test_fsspec.py', 'test/test_local_io.py', 'test/test_period.py', 'test/test_remote_io.py', 'test/test_serialization.py', 'test/test_text_examples.py', 'tools/gen_pyi.py', 'tools/setup_helpers/__init__.py', 'tools/setup_helpers/extension.py', 'torchdata/__init__.py', 'torchdata/_extension.py', 'torchdata/_torchdata/__init__.pyi', 'torchdata/csrc/CMakeLists.txt', 'torchdata/csrc/pybind/S3Handler/S3Handler.cpp', 'torchdata/csrc/pybind/S3Handler/S3Handler.h', 'torchdata/csrc/pybind/S3Handler/precompile.h', 'torchdata/csrc/pybind/pybind.cpp', 'torchdata/datapipes/__init__.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/__init__.py', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/load/s3io.py', 'torchdata/datapipes/iter/transform/__init__.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/transform/flatmap.py', 'torchdata/datapipes/iter/util/__init__.py', 'torchdata/datapipes/iter/util/bz2fileloader.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/dataframemaker.py', 'torchdata/datapipes/iter/util/decompressor.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/plain_text_reader.py', 'torchdata/datapipes/iter/util/rararchiveloader.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/unzipper.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py', 'torchdata/datapipes/map/__init__.py', 'torchdata/datapipes/map/load/__init__.py', 'torchdata/datapipes/map/load/transform.py', 'torchdata/datapipes/map/transform/__init__.py', 'torchdata/datapipes/map/util/__init__.py', 'torchdata/datapipes/map/util/utils.py', 'torchdata/datapipes/utils/__init__.py', 'torchdata/datapipes/utils/common.py']",False
88b23334fad6991f15457293c65cfa8690bcb36f,"S3 datapipes (#165)

Summary:
### Changes
- Added S3FileLister and S3FileLoader IterDataPipes.
- Added pybind11 build for s3 io cpp files and python scripts.
### TODO
- [x] clean up setup files and link pybind11 in CMAKE_PREFIX automatically.
- [x] remove `aws-cpp-sdk` dependency at build with `BUILD_S3` env var & pop exceptions when missing dependencies at usage.
- [x] new api changes for list_files.
- [x] clean up cpp files (naming, new structure, new logic etc.)
- [x] expose timeouts, regions.
- [x] thorough tests
  - [x] different correct usage: bucket (with or without / at last), folder (with or without / at last), prefix, item.
  - [x] different incorrect usage: non-existing files, wrong s3 urls, etc.
  - [x] region changes
  - [x] choice of public datasets
- [x] benchmarks
  - [x] performance test
- [x] README.md
  - [x] user guide & recommendations
  - [x] dependencies

Pull Request resolved: https://github.com/pytorch/data/pull/165

Reviewed By: wenleix

Differential Revision: D35376608

Pulled By: ejguan

fbshipit-source-id: d17c1814af2ae0d8e0c73eee7606fd33f9f9480e",Daiming Yang,ydaiming@outlook.com,2022-04-05 15:39:38,"['.flake8', '.github/workflows/ci.yml', '.gitignore', 'CMakeLists.txt', 'setup.py', 'test/test_remote_io.py', 'tools/__init__.py', 'tools/gen_pyi.py', 'tools/setup_helpers/__init__.py', 'tools/setup_helpers/extension.py', 'torchdata/__init__.py', 'torchdata/_extension.py', 'torchdata/_torchdata/__init__.pyi', 'torchdata/csrc/CMakeLists.txt', 'torchdata/csrc/pybind/S3Handler/S3Handler.cpp', 'torchdata/csrc/pybind/S3Handler/S3Handler.h', 'torchdata/csrc/pybind/S3Handler/precompile.h', 'torchdata/csrc/pybind/pybind.cpp', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/README.md', 'torchdata/datapipes/iter/load/s3io.py']",False
71a16a3b63966af0f60af74d3044b3c963cfc5fb,"Add additional examples for graphs, meshes and point clouds (#337)

Summary:
This PR adds additional examples of `DataPipes` for loading graphs, meshes and point clouds as part of my recent efforts to bring [`torchdata` support to PyTorch Geometric](https://github.com/pyg-team/pytorch_geometric/blob/master/examples/datapipe.py).

Pull Request resolved: https://github.com/pytorch/data/pull/337

Reviewed By: ejguan

Differential Revision: D35228267

Pulled By: NivekT

fbshipit-source-id: c83f75e88c612a5e5cd972eba4f786f5a8a64058",rusty1s,matthias.fey@tu-dortmund.de,2022-03-30 17:28:42,['docs/source/examples.rst'],False
99dc849238b361d8d75bb3ffade480f3ea2c2bab,"Force removing previous nightly (#338)

Summary:
Adding `-f` to remove terminal prompt when removing old nightly release

Pull Request resolved: https://github.com/pytorch/data/pull/338

Reviewed By: NivekT

Differential Revision: D35217744

Pulled By: ejguan

fbshipit-source-id: 180b09fa374d5fa2308344c0108d84d3fd3f932e",Erjia Guan,erjia@fb.com,2022-03-29 18:31:11,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml']",False
198cffe7e65a633509ca36ad744f7c3059ad1190,"Removing old nightly build when uploading (#333)

Summary:
Add extra logic to list all previous nightly release from conda and remove the corresponding conda packages if there is new package built based on the same Python version and platform

Pull Request resolved: https://github.com/pytorch/data/pull/333

Reviewed By: NivekT

Differential Revision: D35159258

Pulled By: ejguan

fbshipit-source-id: d7ccadd2444e09643343d6fc626a6334cad18e32",Erjia Guan,erjia@fb.com,2022-03-28 16:20:57,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml']",False
2f66c15deeadebfd10d4893553e9ba8d8de52190,"Forward conda nightly token to workflow (#331)

Summary:
- Fix another bug in the workflow (I completely missed this point as I couldn't test it)
- Add a manual trigger for nightly-release as a fail-over method

Pull Request resolved: https://github.com/pytorch/data/pull/331

Reviewed By: NivekT

Differential Revision: D35143291

Pulled By: ejguan

fbshipit-source-id: 7a7346d282c6f65ec216b3b4694478cf81739e58",Erjia Guan,erjia@fb.com,2022-03-25 14:56:17,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml']",False
e735861ca88bb386076c5cca3b7c9cc1a7332b72,"TorchData README.md typo fix (#320)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/320

* Fix typo in TorchData README.md.

Reviewed By: wenleix, NivekT

Differential Revision: D35095635

fbshipit-source-id: 992d44b0ee3939e1f85f83f33472a1d4f1595099",Danny Huang,dannyhuang@fb.com,2022-03-24 17:22:15,['README.md'],False
0f936166dddd03c92d5af15001e8af9504edd47e,"Fix conda linux release and trigger uploading with partial wheel/conda build (#323)

Summary:
Changes:
- For conda package, we need to enforce testing using cpuonly version of PyTorch, since we don't have cuda on CI machines.
- Remove all `if` condition to make sure that wheel/conda uploading happens even when a few wheels/conda packages are not built successfully.

See the failing workflow last night: https://github.com/pytorch/data/actions/runs/2034148892

Pull Request resolved: https://github.com/pytorch/data/pull/323

Reviewed By: NivekT

Differential Revision: D35114599

Pulled By: ejguan

fbshipit-source-id: 6e66dba8b368a9579b40a7d6aed87a55eaaeec5b",Erjia Guan,erjia@fb.com,2022-03-24 15:59:52,"['.github/workflows/_build_test_upload.yml', 'packaging/torchdata/meta.yaml']",True
6165258b23c6a1b16de46af1bc95e4aaf54fb265,"Change nightly time and trigger doc gen until nighyly release (#319)

Summary:
- Changing the nightly time to UTC 12:00 to make sure all CI machines share the same date.
- Removing `doc.yml` as the doc gen for nightly release is currently working (see the workflow below)
- Add `CONDA_NIGHTLY_PYTORCHBOT_TOKEN` for conda uploading to `pytorch-nightly`. ~It's blocked by DevInfra team to provide the right Token for the uploading.~

The scheduled workflow last night: https://github.com/pytorch/data/runs/5653050846?check_suite_focus=true

Pull Request resolved: https://github.com/pytorch/data/pull/319

Reviewed By: NivekT

Differential Revision: D35086310

Pulled By: ejguan

fbshipit-source-id: 064afa7fb481037ccde3b69c874f9366192d996d",Erjia Guan,erjia@fb.com,2022-03-23 23:41:21,"['.github/workflows/_build_test_upload.yml', '.github/workflows/docs.yml', '.github/workflows/nightly_release.yml']",False
5be740fe468c3ab49431c40db5dfa56fba1cb7ee,"Fix a typo in docs (#313)

Summary:
Fixes #{issue number}

### Changes

-
-

Pull Request resolved: https://github.com/pytorch/data/pull/313

Reviewed By: ejguan

Differential Revision: D35047484

Pulled By: NivekT

fbshipit-source-id: 334d1808390275d85b0477a2169488b20f50b25b",zhouzaida,zhouzaida@163.com,2022-03-23 18:08:49,['docs/source/tutorial.rst'],False
14c4c4263e22c7b21c4cf3c33deb8f2fc8a7d951,"Fix doc generation Github action again (#317)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/317

Tested on my fork and it works.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35078504

Pulled By: NivekT

fbshipit-source-id: a3a9cd173fd6c74b05dae78986ba1950af547c9c",Kevin Tse,ktse@fb.com,2022-03-23 15:37:37,['.github/workflows/docs.yml'],True
76733df6a8903bf95b938cf611355f05f5c2f821,"decompressor bzip2 support (#312)

Summary:
Fixes https://github.com/pytorch/data/issues/309

### Changes

- Added bzip2 support in decompressor
- Added Bz2FileLoader

Pull Request resolved: https://github.com/pytorch/data/pull/312

Reviewed By: VitalyFedyunin

Differential Revision: D35016515

Pulled By: NivekT

fbshipit-source-id: 76cebe497dda8b77322d1582bf08c93f4a56c923",Lezwon Castelino,lezwon@gmail.com,2022-03-23 00:46:25,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_local_io.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/bz2fileloader.py', 'torchdata/datapipes/iter/util/decompressor.py']",False
4cd744f4a6efa815d4549dff2c0cfb228f8aaa13,"Enable release workflow for both conda and wheel and enable nightly release (#300)

Summary:
Changes:
- Remove redundant logic to compare commits between release wheels
- Add `version.txt` as the single source of truth for the version of TorchData.
  - Reason: Conda needs the version without running `python setup.py ...`. Without this PR, the version of TorchData is determined by running `python setup.py ...`.
- Fix a bug in `setup.py` that pytorch version is incorrect
- Add `packaging/build_conda.sh` and `packaging/build_wheel.sh` and related utility for TorchData to build packages and wheels. (taking reference from TorchVision and TorchText)
  - Files in `packaging/torchdata/...` are required by conda-build
  - Reason: Conda won't to run `python setup.py ...`
  - Remove --release/--nightly option for `setup.py` as we would use the script above to do so.
- Add conda package build/upload workflow
- Enable nightly build (Example: https://github.com/pytorch/data/runs/5647039889?check_suite_focus=true)
  - Validated the version number for nightly release (wheel/conda)
  - Validated the dependency for nightly release (wheel/conda)

Pull Request resolved: https://github.com/pytorch/data/pull/300

Reviewed By: NivekT

Differential Revision: D35050961

Pulled By: ejguan

fbshipit-source-id: 41a805d271f6862e031ff145419729efba0a01ec",Erjia Guan,erjia@fb.com,2022-03-22 22:40:59,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml', '.github/workflows/release.yml', '.github/workflows/test_release.yml', '.prettierignore', 'mypy.ini', 'packaging/README.md', 'packaging/build_conda.sh', 'packaging/build_wheel.sh', 'packaging/pkg_helpers.bash', 'packaging/torchdata/bld.bat', 'packaging/torchdata/build.sh', 'packaging/torchdata/meta.yaml', 'setup.py', 'version.txt']",False
fda2c3f9d2306910911b2c645dd6dcad5c8cdd44,"Fixing doc build workflow (#314)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/314

Fixing the issue [mentioned here](https://github.com/pytorch/data/pull/290#issuecomment-1075241231).

I have ran it on my fork and the build worked:
https://github.com/NivekT/data/actions/runs/2023027716

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D35048050

Pulled By: NivekT

fbshipit-source-id: dcacd514c0138519e4581539fb4b019989d96a2a",Kevin Tse,ktse@fb.com,2022-03-22 19:21:48,['.github/workflows/docs.yml'],False
3368cedbec55e887e50e755109b8cf47ba67318d,"Rename BucketBatcher argument to avoid name collision (#304)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/304

We have a DataPipe using the functional API name `in_batch_shuffle`. Therefore, this DataPipe should **not** have a class variable with the same name to avoid confusion.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34939045

Pulled By: NivekT

fbshipit-source-id: 8e5ea1a48f90596ca10d5dbb5f23756a350ff510",Kevin Tse,ktse@fb.com,2022-03-21 19:40:10,"['test/test_datapipe.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py']",False
55ac7e3a0c9e002e02ee6611e1ce2d25132acea9,"Automatically generate datapipe.pyi in setup.py (#290)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/290

This should only land after https://github.com/pytorch/pytorch/pull/73991

~~CI will fail until that PR is landed into Core's nightly.~~ This is working now.

Automatically run the generation of `datapipe.pyi` in `setup.py` and remove the interface (.pyi) file from version control

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34939044

Pulled By: NivekT

fbshipit-source-id: fa4cdcc01274ea8728b38b13a1410556ef85d8cb",Kevin Tse,ktse@fb.com,2022-03-21 19:40:10,"['.github/workflows/domain_ci.yml', '.gitignore', 'setup.py', 'torchdata/datapipes/__init__.py', 'torchdata/datapipes/gen_pyi.py', 'torchdata/datapipes/iter/__init__.pyi', 'torchdata/datapipes/iter/__init__.pyi.in']",True
0a13dab45616f63b9ff7cd9c57794711f5032eec,"fix typo in transforms.RandomResizedCrop (#311)

Summary:
Fixes #{issue number}

### Changes

-
-

Pull Request resolved: https://github.com/pytorch/data/pull/311

Reviewed By: NivekT

Differential Revision: D35008984

Pulled By: ejguan

fbshipit-source-id: 7a50e9bdcb25b0610c47d850ca641c976a054a04",Hu Ye,xiaohuzc@gmail.com,2022-03-21 17:19:36,['examples/vision/imagefolder.py'],False
0cf73aa40e5975a634f22bd725d12c71fb05c86c,"Small update to README wording to beta (#305)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/305

Confirmed the updated linking works in [this branch](https://github.com/pytorch/data/tree/gh/NivekT/64/orig#beta-usage-and-feedback)

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34936230

Pulled By: NivekT

fbshipit-source-id: 23a5ac6b58038068941918ed81fb1b4722921db0",Kevin Tse,ktse@fb.com,2022-03-17 15:08:37,['README.md'],False
8992d0986b0361d7676cfc3acd62be23b7fac833,"Fix Lint for Bucketizer (#296)

Summary:
Fix mypy Error introduced by `max_token_bucketize`

Pull Request resolved: https://github.com/pytorch/data/pull/296

Reviewed By: NivekT

Differential Revision: D34895420

Pulled By: ejguan

fbshipit-source-id: 531210ea9e008320998231df8c3569d8ef7696fc",Erjia Guan,erjia@fb.com,2022-03-15 17:53:53,['torchdata/datapipes/iter/transform/bucketbatcher.py'],True
a78843b81e998663e1e5f797de46fe1292d05215,"Fix build_docs_job due to the change of security protocal for GitHub (#297)

Summary:
Fixes the error for build_docs_job workflow:
https://github.com/pytorch/data/runs/5555336090?check_suite_focus=true

Pull Request resolved: https://github.com/pytorch/data/pull/297

Reviewed By: NivekT

Differential Revision: D34896055

Pulled By: ejguan

fbshipit-source-id: 03eb4eb46e5135862ed90f061db3bc38b5e939de",Erjia Guan,erjia@fb.com,2022-03-15 16:19:03,['docs/requirements.txt'],False
62704b46bc8727f3967704e281957e2413cf5cb9,"DataSet -> Dataset (#292)

Summary:
I was reading over the docs and got a bit confused about `DataSet` -- I thought it might be a new class introduced here but then figured this referred to the existing PyTorch `Dataset`. I thought others could have a similar experience, so I went ahead and changed that in the Readme.

### Changes

- Spelling changes

Pull Request resolved: https://github.com/pytorch/data/pull/292

Reviewed By: NivekT

Differential Revision: D34874315

Pulled By: ejguan

fbshipit-source-id: a1968d46d4fb50b0cb285f919b38eb248ebc304f",rasbt,mail@sebastianraschka.com,2022-03-15 14:28:06,['README.md'],False
652986b14e893e08edaea2c519e21bc61706de5c,"Implement BucketBatcher with max token (#283)

Summary:
Add `max_token_bucketizer`

There are two options to do streaming bucketizer:
- Using `buffer` as a priority queue to keep yielding the shortest token dynamically. Whenever a token is fetched from buffer, a new token is pushed into the buffer.
- Sort `buffer` and yield batches from `buffer` without adding new tokens from DataPipe until the batches are yielded from `buffer`.

The time complexity of these two methods should be the same as `O(N log(buffer_size)`. I prefer the first approach as we would reduce the potential skewness of data within local buffer.

Added `in_batch_shuffle` as the syntax sugar and for future deterministic data preprocessing.

Pull Request resolved: https://github.com/pytorch/data/pull/283

Reviewed By: NivekT, nateanl

Differential Revision: D34699689

Pulled By: ejguan

fbshipit-source-id: 1a9dff1c633d8ab743c9c482feb2e80e140288a9",Erjia Guan,erjia@fb.com,2022-03-11 00:14:36,"['.github/workflows/domain_ci.yml', 'docs/source/torchdata.datapipes.iter.rst', 'test/test_datapipe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py']",False
7f59a2b4d336c637935528a2eb639d8562443819,"README: Add version compatibility table (#262)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/262

Reviewed By: NivekT

Differential Revision: D34792658

Pulled By: ejguan

fbshipit-source-id: 2a85f48b9fc8a4cb9372541e5aaa16596ac79fe2",Erjia Guan,erjia@fb.com,2022-03-10 21:31:10,"['README.md', 'setup.py']",False
e8b010bf91ecce55c17f8a954d0d33d5054a578a,"Change PyTorch path to official PYPI (#287)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/287

Reviewed By: NivekT

Differential Revision: D34789965

Pulled By: ejguan

fbshipit-source-id: b39d24be753d50dbb5a284c2079eb977f2d00538",Erjia Guan,erjia@fb.com,2022-03-10 18:31:36,['.github/workflows/_build_test_upload.yml'],False
b73970199af8e0b9fbc4bb134e2791ea98ffabcd,"Updating README for beta release (#264)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/264

Updating README for beta release. If you have time, please read through the whole file and let me know what should change.

ejguan - anything to change for installation?

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34488942

Pulled By: NivekT

fbshipit-source-id: 5920df5b176666d3b0ac6e226de37a4be15ff397",Kevin Tse,ktse@fb.com,2022-03-10 15:36:34,"['README.md', 'docs/README.md']",False
823d216535782a2c31a19bcfaeb450597a53f8c4,"Switching to use TorchArrow's new DataFrame API (#281)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/281

Fixes #280

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D34693433

Pulled By: NivekT

fbshipit-source-id: f8a15649e7fabd61e258bbefb11e7d93c354551e",Kevin Tse,ktse@fb.com,2022-03-08 15:17:07,"['test/test_dataframe.py', 'torchdata/datapipes/iter/util/dataframemaker.py']",False
39e48da2a8a076f4a00715f82f761b606ba416f1,"Ensuring DataFrame DataPipes are serializable (#276)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/276

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34625706

Pulled By: NivekT

fbshipit-source-id: 3f9627c35f41193a3e9bc919e4651facf1acf985",Kevin Tse,ktse@fb.com,2022-03-07 15:56:39,"['test/test_dataframe.py', 'test/test_serialization.py', 'torchdata/datapipes/iter/util/dataframemaker.py']",False
895489aaea6966b63191ca9cd1500d80acd33b67,"Adding serialization test for all IterDataPipes (#275)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/275

Related to this issue:
* #106

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34625707

Pulled By: NivekT

fbshipit-source-id: 896761a9d7c01efc172e579930ae75489ac2d5a0",Kevin Tse,ktse@fb.com,2022-03-07 15:56:39,"['test/test_serialization.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py']",True
ffc6683f8160ca979c40e41c886f596567e395f8,"Revamp release CI to support artifact cache and conda uploading (#270)

Summary:
Changes:
1. Add a pre-check job to determine the release type based on the combination of `pre_dev_release` and `branch`
    - Use the release type to determine if skip a certain step

| pre_dev_release \ branch | ""release/*"" | ""main""    |
|--------------------------|-------------|-----------|
| true                     | test        | nightly   |
| false                    | official    | Error Out |

2. Enforce PyTorch version based on the argument of `pytorch_version`
3. Automatically determine the download link for `pip install` based on the release type (step 1)
4. Add a step to determine if we want to build new TorchData wheel
    - Always build and upload for `official` release
    - For `nightly` and `rc`, we only build release if there is new commit in the main/release branch.
    - Using the output of this step reduces the same and complicated if-condition for every step
5. Automatically determine the flag to build torchdata `nightly` or `release`
6. Add steps to upload/download wheel to enable the workflow to upload all wheels for different platform in a single time.
    - Upload all artifacts based on the build matrix to a single place
    - Download artifacts from github and upload them to the corresponding channels based on the release type
7. Add a step to upload wheel to conda (needs follow up with devinfra to provide `CONDA_PYTORCHBOT_TOKEN`

Pull Request resolved: https://github.com/pytorch/data/pull/270

Reviewed By: NivekT

Differential Revision: D34580941

Pulled By: ejguan

fbshipit-source-id: ba905f8a77e5d58cd24702be78e1b1d6f6fc6717",Erjia Guan,erjia@fb.com,2022-03-04 16:54:14,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml', '.github/workflows/release.yml', '.github/workflows/test_release.yml']",False
b07b86c01b6e3cded84a153852e3d4741c038d7b,"Adding more usage examples (#277)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/277

Should this be added to `0.3.0` as well?

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34627748

Pulled By: NivekT

fbshipit-source-id: 4ff7c70eb21c1e5a3f1b07d1103a268fdfbc5d16",Kevin Tse,ktse@fb.com,2022-03-04 15:42:09,['docs/source/examples.rst'],False
19cf4530084820c54264141f22b82ba0e2997cfd,"Adding deprecation warnings for archive readers (#272)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/272

Tracked by https://github.com/pytorch/data/issues/163

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34562086

Pulled By: NivekT

fbshipit-source-id: c930c190da57a82c491da265da5848f94aadd85e",Kevin Tse,ktse@fb.com,2022-03-02 15:55:38,"['torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py']",True
5445b48a1d875276a226841d1f64b975c8d0be0b,"Adding detailed comments for Amazon Review example (#271)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/271

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34562198

Pulled By: NivekT

fbshipit-source-id: 4d3a6f04679da59f1dd94c0d9f9b86eef639c616",Kevin Tse,ktse@fb.com,2022-03-02 15:53:44,['examples/text/amazonreviewpolarity.py'],True
26fbceec86ee2390dc91ba4dff548a11f35de916,"Fix bugs for setup and CI (Dep & PyTorch Version) (#266)

Summary:
### Changes

- Fix dependency requirements for setup (urlliib3)
- Add condition to prevent workflow executed on PRs to upload wheel
- Add env to specify PyTorch version

Pull Request resolved: https://github.com/pytorch/data/pull/266

Reviewed By: NivekT

Differential Revision: D34525935

Pulled By: ejguan

fbshipit-source-id: 918dcf4dc46c0c10f7a359db7851b9f3136204de",Erjia Guan,erjia@fb.com,2022-03-01 14:38:31,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml', '.github/workflows/release.yml', '.github/workflows/test_release.yml', 'setup.py']",True
e02773d5c1f6b9a24ac55fd8beb79fcc048995d0,"Remove custom __getstate__, __setstate__ for FlatMapper (#240)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/240

After https://github.com/pytorch/pytorch/pull/72896 lands, custom __getstate__, __setstate__ are no longer needed here because there will be default methods in `IterDataPipe`.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34398870

Pulled By: NivekT

fbshipit-source-id: 6e1c3d10c81151e7096cde1670529d0ba2297c45",Kevin Tse,ktse@fb.com,2022-02-28 17:05:21,['torchdata/datapipes/iter/transform/flatmap.py'],True
2371f84dcc58c73e880ec4915a49ba66c3f20f2b,"Re-enable ufmt with pre-commit (#261)

Summary:
Revert https://github.com/pytorch/data/pull/241

Pull Request resolved: https://github.com/pytorch/data/pull/261

Reviewed By: NivekT

Differential Revision: D34480543

Pulled By: ejguan

fbshipit-source-id: 1f17845a09bb349fdc35266f92ec340abf6189d4",Erjia Guan,erjia@fb.com,2022-02-25 19:08:33,"['.github/workflows/lint.yml', '.pre-commit-config.yaml']",True
af52b42dca55907509475c3903d4671786b3d886,"Bump version to 0.4.0 (#258)

Summary:
Main branch should bump to 0.4.0

Pull Request resolved: https://github.com/pytorch/data/pull/258

Reviewed By: NivekT

Differential Revision: D34479168

Pulled By: ejguan

fbshipit-source-id: 9a9b85857b7943011d196f4709a707514bf3938b",Erjia Guan,erjia@fb.com,2022-02-25 18:04:29,['setup.py'],True
7804eca402409b16910e45c41aa784f8b55b144a,"Documentation issue form update (#215)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/215

Merge this after the website is live.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34478899

Pulled By: NivekT

fbshipit-source-id: d3c0a98944ae39d19a8f9ed440e040be26458770",Kevin Tse,ktse@fb.com,2022-02-25 17:56:04,['.github/ISSUE_TEMPLATE/documentation.yml'],True
0917fc05d04ff83c80d79a6a520d34eceab5c35b,"Implement auto doc gen for release (#254)

Summary:
https://pytorch.org/data/0.3.0/index.html

This goes to main branch for future release.

Pull Request resolved: https://github.com/pytorch/data/pull/254

Reviewed By: NivekT

Differential Revision: D34465203

Pulled By: ejguan

fbshipit-source-id: 3110f4b58b8ad3ab46270809d48c6da436683690",Erjia Guan,erjia@fb.com,2022-02-25 15:28:39,"['.github/workflows/_build_test_upload.yml', '.github/workflows/docs.yml']",True
2cf1f208e76301f3e013b7569df0d75275f1aaee,"Adding usage examples to all IterDataPipes (#249)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/249

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34433825

Pulled By: NivekT

fbshipit-source-id: c2bd60eb2ea957f064486064baf5978e7dcb3441",Kevin Tse,ktse@fb.com,2022-02-24 14:51:48,"['docs/source/conf.py', 'docs/source/torchdata.datapipes.iter.rst', 'torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/transform/flatmap.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/dataframemaker.py', 'torchdata/datapipes/iter/util/decompressor.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/plain_text_reader.py', 'torchdata/datapipes/iter/util/rararchiveloader.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/unzipper.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py']",True
ebee4cad3dad6b833b309bbe8f235fd0abbcdc20,"Renaming Archive readers to loaders, and extractor to decompressor (#243)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/243

Note that the old ones are still functional, but excluded from the documentation and .pyi file. There is no deprecation warnings for them (we can add them after the first release).

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34403884

Pulled By: NivekT

fbshipit-source-id: a6a71eebcc5b34e316420e6dc35db2c85b75b763",Kevin Tse,ktse@fb.com,2022-02-23 21:31:58,"['docs/source/torchdata.datapipes.iter.rst', 'examples/audio/librispeech.py', 'examples/text/amazonreviewpolarity.py', 'examples/text/imdb.py', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'test/test_local_io.py', 'test/test_remote_io.py', 'torchdata/datapipes/gen_pyi.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/__init__.pyi', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/decompressor.py', 'torchdata/datapipes/iter/util/tararchiveloader.py', 'torchdata/datapipes/iter/util/xzfileloader.py', 'torchdata/datapipes/iter/util/ziparchiveloader.py']",True
98030beabca6be5fd815a362ce89db9ca5555d18,"Forward secrets to workflow_call (#248)

Summary:
See title. Otherwise, the `workflow_call` can not upload wheels to aws.

See the workflow https://github.com/pytorch/data/runs/5307999775?check_suite_focus=true
![image](https://user-images.githubusercontent.com/68879799/155379643-50b97b1f-7752-49a5-985f-a4b3194cc043.png)
`AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` are available

Pull Request resolved: https://github.com/pytorch/data/pull/248

Reviewed By: NivekT

Differential Revision: D34423449

Pulled By: ejguan

fbshipit-source-id: 56334b836c6c445d639f7a2bd01a9d062d72020b",Erjia Guan,erjia@fb.com,2022-02-23 19:36:08,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml', '.github/workflows/release.yml', '.github/workflows/test_release.yml']",True
246cf55c43a5ab14c3e14e36e55592c6a50d45d0,"Fix upload workflow (#244)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/244

Reviewed By: NivekT

Differential Revision: D34410400

Pulled By: ejguan

fbshipit-source-id: a1131bb2a034df5e02138a092e38f6274da5d80e",Erjia Guan,erjia@fb.com,2022-02-23 15:14:49,['.github/workflows/_build_test_upload.yml'],True
8ac64e5a53dd27c65cc0cfe4b82c0c247150f917,"Fix meta header for gen_pyi (#239)

Summary:
per title

Pull Request resolved: https://github.com/pytorch/data/pull/239

Reviewed By: NivekT

Differential Revision: D34397799

Pulled By: ejguan

fbshipit-source-id: 4815ff0ecc95f8150d3e9b5b52dcc50cf7f7596f",Erjia Guan,erjia@fb.com,2022-02-23 01:47:16,"['torchdata/datapipes/gen_pyi.py', 'torchdata/datapipes/iter/__init__.pyi.in']",False
0afe7e2840c1d17fb6734654b6a7510ff2f3883b,"Run ufmt without pre-commit (#241)

Summary:
Copycat of https://github.com/pytorch/vision/pull/5454

Pull Request resolved: https://github.com/pytorch/data/pull/241

Reviewed By: NivekT

Differential Revision: D34399601

Pulled By: ejguan

fbshipit-source-id: d1b5914542934b82ed0c7c8f77eba8682ae1ac5b",Erjia Guan,erjia@fb.com,2022-02-22 22:02:46,"['.github/workflows/lint.yml', '.pre-commit-config.yaml']",True
cf2f1ee49f5c68428d5ddd8298253063ba8a922f,"Adding version number to sidebar and updating metadata (#236)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/236

This adds the version number to the sidebar and updates a few metadata to match other repos.

We will need to see if the number still looks correct when we are on a release branch.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34347606

Pulled By: NivekT

fbshipit-source-id: ee9ad689a35f7ce848ea82481477261fb7d26381",Kevin Tse,ktse@fb.com,2022-02-18 20:45:02,"['docs/source/conf.py', 'docs/source/index.rst']",False
8cd89342038bc778e602277a4f2978f0c056fd70,"Specify urllib3 version for HTTPReader (#235)

Summary:
Fixes https://github.com/pytorch/data/issues/232

Pull Request resolved: https://github.com/pytorch/data/pull/235

Reviewed By: wenleix, NivekT

Differential Revision: D34346928

Pulled By: ejguan

fbshipit-source-id: a4b6840baeaf319ce3abf88aa6b56ea790afd153",Erjia Guan,erjia@fb.com,2022-02-18 20:16:52,['requirements.txt'],True
cfebb355ee25c14e039646c2d519edaa990b9c37,"Generating .pyi file for IterDataPipes within the module (#224)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/224

This attempts to allow method hints to be shown to users when TorchData DataPipe is imported and used. See the comment below for one issue. It may be the best we can do for now.

If this change can lead to confusion, maybe we should land this PR instead: https://github.com/pytorch/pytorch/pull/70012
That PR adds all method hints to PyTorch Core, but the downside is that users will be suggested to use methods that are only available with TorchData installed.

In the long term, it will likely be better for all DataPipes to be in one single library.

Note: the Mypy error will disappear when this PR lands: https://github.com/pytorch/pytorch/pull/72829

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34243814

Pulled By: NivekT

fbshipit-source-id: b481d4c6e95eae8be91bdfa1690dc5711ee3b503",Kevin Tse,ktse@fb.com,2022-02-18 16:15:07,"['torchdata/datapipes/gen_pyi.py', 'torchdata/datapipes/iter/__init__.pyi', 'torchdata/datapipes/iter/__init__.pyi.in', 'torchdata/datapipes/iter/util/dataframemaker.py', 'torchdata/datapipes/iter/util/unzipper.py']",True
274e7b81c21a2da7a21b4a4c77fe786b544c6d29,"Adding version numbers to left side menu (#233)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/233

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D34320352

Pulled By: NivekT

fbshipit-source-id: 1ab12550f2f8c5c34dd7f9b8624379f732bfbf6f",Kevin Tse,ktse@fb.com,2022-02-18 15:52:51,['docs/source/_templates/layout.html'],True
638b8bb897b3f918c894322beb0eabcb4f5d7e64,"Upgrade deployment action (#231)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/231

Upgrade deployment action and change target location to `main` folder in `gh-pages` branch

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34320351

Pulled By: NivekT

fbshipit-source-id: 3f014aa6cc2e6999aa0dff02db8c4d14850a263f",Kevin Tse,ktse@fb.com,2022-02-18 15:52:51,['.github/workflows/docs.yml'],True
6c5a9cb040740db1c5385fe9cc6ca3e5307d49f0,"Enable CI workflow for release branch (#230)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/230

Reviewed By: NivekT

Differential Revision: D34314188

Pulled By: ejguan

fbshipit-source-id: 6323b85ab156095eb4e317ac6d39521bc5c6c0d9",Erjia Guan,erjia@fb.com,2022-02-17 22:16:47,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml']",True
826f56ab08236f4bfd453699d5dbbc899f1ac51a,"Expand/reordering tutorial (#227)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/227

Changing the order of tutorial, expanding the usage section, and put more emphasis on using the functional form of DataPipes

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D34308018

Pulled By: NivekT

fbshipit-source-id: 736efe713615ca5f26ef208c7e5b0e2dffa2c16d",Kevin Tse,ktse@fb.com,2022-02-17 21:23:23,"['docs/source/tutorial.rst', 'torchdata/datapipes/map/util/utils.py']",True
42236bc4dc74dfc6e430472578e175c42d33a93c,"Disable RC release on main branch (#228)

Summary:
Due to the limitation of current GHA, scheduled workflow can't run on release branch. I have to switch the workflow to manually trigger for release branch. Please check: https://github.community/t/scheduled-builds-of-non-default-branch/16306

The right workflow will be created in release branch rather than main branch.

Pull Request resolved: https://github.com/pytorch/data/pull/228

Reviewed By: NivekT

Differential Revision: D34306993

Pulled By: ejguan

fbshipit-source-id: de7108928a0be4e16eb724ba12bb0c1cdee89189",Erjia Guan,erjia@fb.com,2022-02-17 19:19:56,['.github/workflows/test_release.yml'],False
59fdd6eeb362f1fb8dd3c70b0b7347047994169a,"Create daily workflow to upload release binary only if changes present (#226)

Summary:
### Changes

- Switch to `cron` to run workflow daily
- Using `git_version` to determine if new changes exist in the branch. Only upload new wheel if changes present.

Please check the result of the following workflow
- Official release (https://github.com/pytorch/data/runs/5223365922?check_suite_focus=true)
  - Install Official PyTorch
  - Checkout release branch of TorchData
  - Build Wheel and Install Wheel
  - Test
  - Upload to PyPi
  - Upload to Conda [TODO]
- Test release (https://github.com/pytorch/data/runs/5223365862?check_suite_focus=true)
  - Install RC-release PyTorch from test-channel
  - Install RC-release TorchData from test-channel
  - Checkout release branch of TorchData
  - Compare last commit of release branch and RC-release of TorchData
  - Build Wheel and Install Wheel
  - Test
  - Upload to S3
- Nightly release (https://github.com/pytorch/data/runs/5223365860?check_suite_focus=true)
  - Install nightly-release PyTorch
  - Install nightly-release TorchData
  - Checkout main branch of TorchData
  - Compare last commit of main branch and nightly-release of TorchData
  - Build Wheel and Install Wheel
  - Test
  - Upload to S3
  - Upload to Conda [TODO]

Pull Request resolved: https://github.com/pytorch/data/pull/226

Reviewed By: NivekT

Differential Revision: D34284000

Pulled By: ejguan

fbshipit-source-id: 919cfe7f56e93b4f512953a5d552137266cbbab2",Erjia Guan,erjia@fb.com,2022-02-16 23:32:10,"['.github/workflows/_build_test_upload.yml', '.github/workflows/nightly_release.yml', '.github/workflows/release.yml', '.github/workflows/test_release.yml', 'setup.py']",True
d15c8f91c9297a62c42cbe26c0e31579962ba92c,"Categorizing IterDataPipes (#219)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/219

Categorizing IterDataPipes into more specific categories. Still need to add category descriptions.

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D34221378

Pulled By: NivekT

fbshipit-source-id: 98d833bee75c1d99f8b1c574b3266d5ef29cf75a",Kevin Tse,ktse@fb.com,2022-02-16 21:03:56,['docs/source/torchdata.datapipes.iter.rst'],True
bd51d9ce8c454884c4d99a02d7c76611525a9664,"Adding domain specific examples (#216)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/216

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin, ejguan

Differential Revision: D34174183

Pulled By: NivekT

fbshipit-source-id: 29e805dbe171940adcbb9f56c4585965291e798f",Kevin Tse,ktse@fb.com,2022-02-16 21:03:56,"['docs/source/examples.rst', 'docs/source/tutorial.rst', 'torchdata/datapipes/iter/util/plain_text_reader.py']",True
009452977269c7ac832108c5cc0229997f01b2d7,"Adding TorchData tutorial (#212)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/212

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34144164

Pulled By: NivekT

fbshipit-source-id: f75cc0daac978a3619bf6895d88b19910f08d7e7",Kevin Tse,ktse@fb.com,2022-02-16 21:03:56,"['README.md', 'docs/source/index.rst', 'docs/source/tutorial.rst']",True
e86cedc5ffd024ea293f541fc77e8a3b4856c8c9,"Add release GHA (#221)

Summary:
Copy of https://github.com/pytorch/data/issues/220 in order to access env secrets

### Changes
- Update `setup.py` to generate right version for different types of releases (nightly, rc, official release)
- Add GHA workflow to enable to release uploading for testing and nightly
- Currently using manually dispatch to trigger this upload for now. And, manual trigger can only be carried out when this PR is landed.  Please check this test run to validate the workflow: https://github.com/pytorch/data/actions/runs/1843730857

Pull Request resolved: https://github.com/pytorch/data/pull/221

Reviewed By: wenleix, VitalyFedyunin

Differential Revision: D34213354

Pulled By: ejguan

fbshipit-source-id: 014fadcba11660199b52b20bc11a53be0b357015",Erjia Guan,erjia@fb.com,2022-02-15 14:58:34,"['.github/workflows/nightly_release.yml', '.github/workflows/release.yml', 'setup.py']",True
44b70f3349b4a7a5bbb442885fa146417eb1c64e,"Update docs.yml (#223)

Summary:
Changes docs build to run on merge to main.

Fixes https://github.com/pytorch/data/issues/222

Pull Request resolved: https://github.com/pytorch/data/pull/223

Reviewed By: ejguan

Differential Revision: D34218691

Pulled By: NivekT

fbshipit-source-id: 72d844207d8602fc1b5f1f3197515a19dc1ccc53",Brian Johnson,brianjo@fb.com,2022-02-14 20:16:13,['.github/workflows/docs.yml'],True
be1a4346c1fa25c3e39a169e4b2ddec2a7e13c6a,"Removing Iter/MapDataPipe examples since they have been moved into the classes' docstrings (#211)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/211

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34144165

Pulled By: NivekT

fbshipit-source-id: 61d7b5b57a1fc47aee26a04bdc63e870d24e2e92",Kevin Tse,ktse@fb.com,2022-02-11 17:20:58,"['docs/source/torchdata.datapipes.iter.rst', 'docs/source/torchdata.datapipes.map.rst']",True
9c6e5ddfcdf1061e3968ed5cd9d55754cc713965,"Revamp librispeech dataset (#202)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/202

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D34085742

fbshipit-source-id: 79cd4f053f308595cef211770431f1000821ee28",Erjia Guan,erjia@fb.com,2022-02-10 21:08:54,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', 'examples/audio/librispeech.py', 'test/test_audio_examples.py', 'test/test_text_examples.py']",True
d36674621bc416de3e1ec6ee5cd9d729fc3ee222,"Fixing docstrings for IterDataPipes (#209)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/209

Rewriting a lot of docstrings for clarity. The first sentence is now always a summary (with functional name when available).

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34093681

Pulled By: NivekT

fbshipit-source-id: a957d7595493714456e6629bf391738c8099f5ce",Kevin Tse,ktse@fb.com,2022-02-10 20:14:01,"['torchdata/datapipes/iter/load/fsspec.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/dataframemaker.py', 'torchdata/datapipes/iter/util/extractor.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/plain_text_reader.py', 'torchdata/datapipes/iter/util/rararchiveloader.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py']",False
7995941d66d3f9a920b3a210bf5d9368c3ccf9a8,"Fixing flatmap signature and documentation (#208)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/208

Fixing `flatmap` signature and documentation because it is more flexible than the previous documentation indicates.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34093682

Pulled By: NivekT

fbshipit-source-id: 6c8418d7275bc3f20d611039c682247fb688f9b0",Kevin Tse,ktse@fb.com,2022-02-10 20:14:01,['torchdata/datapipes/iter/transform/flatmap.py'],True
312b5b51b02d5f05ea9781b87050362ecc89e1b0,"Adding more signature replacements (#207)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/207

Replacing long signature types with more readable ones. Using regular expression should be better here but I left it as a TODO.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34093685

Pulled By: NivekT

fbshipit-source-id: 7d1b76830b94d714f53ad30facec5fb4f7974cf4",Kevin Tse,ktse@fb.com,2022-02-10 20:14:01,['docs/source/conf.py'],True
f90a02f988d4ea177d2509d89132596bd540dfb6,"Override upper-case conversion of titles (#206)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/206

Adding CSS file to override the default setting where all titles are in UPPER CASE.

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin, ejguan

Differential Revision: D34093683

Pulled By: NivekT

fbshipit-source-id: bdf3d83d3d75aa6be35fca3215527818acc83114",Kevin Tse,ktse@fb.com,2022-02-10 20:14:01,"['docs/source/_static/css/custom.css', 'docs/source/_templates/datapipe.rst', 'docs/source/conf.py']",True
a964a83d9690f33baf5989dd15645d1257729cdf,"Adding documentation for utility functions (#205)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/205

Setup documentation for utility function and added some links to PyTorch Core documentation.

Let me know what else should be added here.

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin, ejguan

Differential Revision: D34093684

Pulled By: NivekT

fbshipit-source-id: b6e1a3c111570140c5a3ae8c6a5f0a4ec15d8303",Kevin Tse,ktse@fb.com,2022-02-10 20:14:01,"['docs/source/torchdata.datapipes.iter.rst', 'docs/source/torchdata.datapipes.utils.rst']",True
37bd84f6adccce3bee7520a034d68ec1296d85f3,"Fix OnDiskCacheHolder to list all files for decompressing operations (#203)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/203

Add `FileLister` to make sure `OnDiskCacheHolder` can list all of files after any 1-to-N operations like decompression.

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D34085743

Pulled By: ejguan

fbshipit-source-id: 3f2461b0e77eb015ec4e8b5b5a936505380f5a76",Erjia Guan,erjia@fb.com,2022-02-10 14:21:33,"['test/test_remote_io.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/saver.py']",True
8e4dd06c6ad27c396f655ddea38107261d4a07df,"Implement DataPipe to convert Iter to Map (#201)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/201

This DataPipe is used to lazily load data from `IterDataPipe` to a `MapDataPipe`.

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D34085744

Pulled By: ejguan

fbshipit-source-id: 1918a695077a9faf9aed7f891ea30aef8c99c50c",Erjia Guan,erjia@fb.com,2022-02-10 04:22:53,"['docs/source/torchdata.datapipes.map.rst', 'test/test_datapipe.py', 'torchdata/datapipes/iter/load/.exists', 'torchdata/datapipes/iter/transform/.exists', 'torchdata/datapipes/map/__init__.py', 'torchdata/datapipes/map/load/.exists', 'torchdata/datapipes/map/load/transform.py', 'torchdata/datapipes/map/transform/.exists', 'torchdata/datapipes/map/util/__init__.py', 'torchdata/datapipes/map/util/utils.py']",True
7c7bafc46352845f3bd4e06dc1fc62b0aeec609b,"Adding UnZipperIterDataPipe (#198)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/198

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D34014294

Pulled By: NivekT

fbshipit-source-id: 36fee95cd517b3050f0241e800618aa2a872f5cd",Kevin Tse,ktse@fb.com,2022-02-08 19:08:43,"['docs/source/torchdata.datapipes.iter.rst', 'test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/unzipper.py']",False
8942cf1d6cdb71013e7b93330a6b0d41445c5e6c,"Prevent RarArchiveLoader reading nested RAR explicitly (#197)

Summary:
Fixes https://github.com/pytorch/data/issues/189

### Changes

- ~Rename `RarArchiveLoader` to `RarArchvieReader` and corresponding functional API~
- Raise Error when reading nested RAR
- Add tests for nested RAR and nested TAR.

cc: pmeier There is a BC-breaking naming change.

Pull Request resolved: https://github.com/pytorch/data/pull/197

Reviewed By: NivekT

Differential Revision: D34044798

Pulled By: ejguan

fbshipit-source-id: 0cee051d9e6c2517db8bfbeeab5077a852556872",Erjia Guan,erjia@fb.com,2022-02-08 15:20:07,"['test/test_local_io.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/rararchiveloader.py']",False
3b06d7d2e59a350e4f5825abb7b18003e76f8ce1,"Requires Python>=3.7 (#199)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/199

Test Plan: Imported from OSS

Reviewed By: wenleix, ejguan

Differential Revision: D34015425

Pulled By: NivekT

fbshipit-source-id: e5ce5757a1ca4d9d9a96a63f55bb7e2973675a28",Kevin Tse,ktse@fb.com,2022-02-07 15:30:15,['setup.py'],False
1cc1839d82712e462c7beee8815643e00481a6bc,"Generating documentation for TorchData (#193)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/193

This PR contain changes that will generate documentation for the library. Other improvements will be needed. I will make a new issue to track those milestones. Those issues can be addressed in follow up PRs.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33986028

Pulled By: NivekT

fbshipit-source-id: b3c221d4b5da0ac35b9a8bd725f0efdb43f527cc",Kevin Tse,ktse@fb.com,2022-02-04 18:49:57,"['.github/workflows/docs.yml', '.gitignore', 'README.md', 'docs/Makefile', 'docs/README.md', 'docs/make.bat', 'docs/requirements.txt', 'docs/source/_templates/datapipe.rst', 'docs/source/conf.py', 'docs/source/docutils.conf', 'docs/source/examples.rst', 'docs/source/index.rst', 'docs/source/torchdata.datapipes.iter.rst', 'docs/source/torchdata.datapipes.map.rst', 'docs/source/torchdata.datapipes.utils.rst', 'docs/source/tutorial.rst', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/flatmap.py']",False
e53afb723de8ce761c0fabc8c8f5c066e83cb50a,"Fix OOM when traverse IterDataPipe due to pickling (#72209)

Summary:
Pull Request resolved: https://github.com/pytorch/pytorch/pull/72209

This PR would fix https://fburl.com/jtfyksyr

Test Plan: Imported from OSS

Reviewed By: dagitses, NivekT

Differential Revision: D33955933

Pulled By: ejguan

fbshipit-source-id: 120203a3c2323a0c7081715bb6628d1768f8b1c4",Erjia Guan,erjia@fb.com,2022-02-03 22:49:32,['torchdata/datapipes/iter/util/cacheholder.py'],False
c4a091858fa800a395145a4a27568ac43ca06215,"Adding ParquetDFIterDataPipe (#181)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/181

Part of DataLoader v2 hackathon, this PR implements a new DataPipe that can read Parquet files and return TorchArrow DataFrames for each row group within the Parquet files.

This PR is dependent on a change from TorchArrow

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33803733

Pulled By: NivekT

fbshipit-source-id: 22ba5f16fb36ba0a3f6c164e2a97bba17075b569",Kevin Tse,ktse@fb.com,2022-02-02 15:48:08,"['mypy.ini', 'test/test_dataframe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/dataframemaker.py']",True
9184f831d3e84d4f442c2fc5a3ce9d5c46c2bed5,"Adding DataFrameMakerDataPipe (#180)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/180

Part of DataLoader v2 hackathon, this PR implements a new DataPipe that can convert a DataPipe to a TorchArrow DataFrame.

Test Plan: Imported from OSS

Reviewed By: wenleix, ejguan

Differential Revision: D33803734

Pulled By: NivekT

fbshipit-source-id: b1dc1df51e89337f1ce83e0c8633ee5642886d57",Kevin Tse,ktse@fb.com,2022-02-02 15:48:08,"['mypy.ini', 'test/test_dataframe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/dataframemaker.py']",True
443ae5c610d8c284dcec68ec9648ffef44ff20e5,"Import MapDataPipes from Core (#190)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/190

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33929357

Pulled By: NivekT

fbshipit-source-id: 0deba5e00d294dcdab24fb8d7912aa8bbfc3de83",Kevin Tse,ktse@fb.com,2022-02-02 15:30:14,['torchdata/datapipes/map/__init__.py'],True
fb29c810e6e8881e5a3558743d9573cb82134cd6,"Fix copyright headers (#187)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/187

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D33892328

Pulled By: NivekT

fbshipit-source-id: 895854b2c16d06bc08b04ab7501322d638735c1c",Kevin Tse,ktse@fb.com,2022-02-01 15:19:29,"['test/_fakedata/_create_fake_data.py', 'torchdata/datapipes/iter/util/rar_archive_loader.py']",True
256a5123d3692f371ae4280eceee4dbafd1150a1,"Fix ShardingFilter import (#186)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/186

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D33892329

Pulled By: NivekT

fbshipit-source-id: 24d64fec26e747ce4dc8ff22a3b713f83e830184",Kevin Tse,ktse@fb.com,2022-02-01 15:19:29,['torchdata/datapipes/iter/__init__.py'],True
cdcb1ba84cc53e4ed3ce5182475a207b0eeee545,"add h5py to torchvision test requirements (#188)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/188

Reviewed By: ejguan

Differential Revision: D33892513

Pulled By: NivekT

fbshipit-source-id: 9fd4bf797ee5c7e668849b0849592d99ed08599a",Philip Meier,github.pmeier@posteo.de,2022-01-31 18:10:19,['.github/workflows/domain_ci.yml'],False
160ce809f8c3ee686af0e3e701d7341827841eeb,"fixing amazonreviewpolarity example (#169)

Summary:
This PR fixes couple of things:
1. It introduces caching for extracted files. It will help avoid repetitive extractions with every iteration
2. It fixed the parsed CSV content

Pull Request resolved: https://github.com/pytorch/data/pull/169

Reviewed By: VitalyFedyunin

Differential Revision: D33826180

Pulled By: ejguan

fbshipit-source-id: eee6831d2403b16c469215969f53d48182bdbed0",Parmeet Singh Bhatia,parmeetbhatia@fb.com,2022-01-27 21:30:38,['examples/text/amazonreviewpolarity.py'],False
1ec936b8954f9a525e5e2c2363708cdc388eb5d2,"Fix reference test from torchtext (#182)

Summary:
SST is moved from prototype to datasets in https://github.com/pytorch/text/pull/1538. The reference in TorchData needs to be moved correspondingly.

cc: Nayef211 Let me know when you have unit test for each Dataset. Then, I can directly use the test inside TorchText.

Pull Request resolved: https://github.com/pytorch/data/pull/182

Reviewed By: NivekT

Differential Revision: D33819115

Pulled By: ejguan

fbshipit-source-id: 951534e4285414032c3666204b6a67991fd80ed8",Erjia Guan,erjia@fb.com,2022-01-27 17:21:00,['test/test_text_examples.py'],False
481e8ea496d707a8bbf7d370f2cc740ea49dbfd2,"adds flatmap datapipe. (#179)

Summary:
Fixes https://github.com/pytorch/data/issues/178

### Changes

- Adds a `FlatMapDataPipe` which applies a function to each nested data pipe and yields from them to flatten lazily.

Pull Request resolved: https://github.com/pytorch/data/pull/179

Reviewed By: wenleix

Differential Revision: D33791087

Pulled By: ejguan

fbshipit-source-id: 9412d2e7a8f7c38ade66df8f7f46e46ae9535af8",Elijah Rippeth,elijah.rippeth@gmail.com,2022-01-27 15:01:44,"['test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/transform/flatmap.py']",False
68774207c3a39a2559114a6a6fa3ff00d66855d7,"Add DL tests to Text examples & Add lambda fn warning to cache (#168)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/168

This PR needs to wait until https://github.com/pytorch/pytorch/pull/71311 is landed.

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D33589170

Pulled By: ejguan

fbshipit-source-id: 2d70efedd9c55b43362f0ebfe80b251a9ad2ea18",Erjia Guan,erjia@fb.com,2022-01-26 02:49:09,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', 'mypy.ini', 'test/test_text_examples.py', 'torchdata/datapipes/iter/util/cacheholder.py']",False
bc0e88a8d3543bba93901af05ef832754bc54a70,"Remove duplicated DataPipe reference from bucketbatcher (#177)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/177

Fixes #136

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D33719657

Pulled By: ejguan

fbshipit-source-id: c53eccc07bcca4063905713ba7e822772fd877d8",Erjia Guan,erjia@fb.com,2022-01-24 16:20:14,"['test/test_datapipe.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py']",False
31ab2d6807a5b653d42147384370b2e79eaa7dca,"fix newline stripping in plain text readers (#174)

Summary:
Fixes https://github.com/pytorch/data/issues/173

Note that the [input to `strip`](https://docs.python.org/3/library/stdtypes.html#str.strip)

> is a string specifying the **set of characters** to be removed. [Emphasis mine]

Thus, stripping works something like

```python
for char in chars:
    string.replace(char, """")
```

rather than

```python
string.replace(chars, """")
```

This means that always stripping `""\r\n""` is harmless even if the line terminator is only `""\n""` or `\""r""`.

Pull Request resolved: https://github.com/pytorch/data/pull/174

Reviewed By: ejguan

Differential Revision: D33684458

Pulled By: NivekT

fbshipit-source-id: 9821b77d60d3afe038ae698965beefe319783aa1",Philip Meier,github.pmeier@posteo.de,2022-01-20 22:03:10,"['test/test_datapipe.py', 'torchdata/datapipes/iter/util/plain_text_reader.py']",False
c06066ae360fc6054fb826ae041b1cb0c09b2f3b,"Fixing HeaderIterDP's __len__ function (#166)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/166

The previous implementation simply return the limit as the length for `HeaderIterDataPipe`. This updated implementation takes it a step further to account for the different possible scenarios.

Fixes #123
Fixes #134

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33589168

Pulled By: NivekT

fbshipit-source-id: a1b20357031a8a606e1ba2fa40032cf48f91e145",Kevin Tse,ktse@fb.com,2022-01-18 15:18:21,"['test/test_datapipe.py', 'torchdata/datapipes/iter/util/header.py']",True
24c25c030e1fce6c75c41b18c837c049a14410f1,"Remove all Loaders from this library (#162)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/162

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33531857

Pulled By: NivekT

fbshipit-source-id: 0c7606cb5a7b53e72d2b80450d9cbec1b236f74a",Kevin Tse,ktse@fb.com,2022-01-13 15:30:25,"['test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/iopath.py']",True
ec32ee42983760640280c937868611355e6ed281,"Adding timeout option for GDriveReader (#153)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/153

Fixes #132
Fixes #137

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33370399

Pulled By: NivekT

fbshipit-source-id: d20d6b3b17103bbeee79c788732c76bfb4f29f76",Kevin Tse,ktse@fb.com,2022-01-07 21:27:38,"['torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/util/hashchecker.py']",True
7899c86a12613748d14a4fbb352edfb3409afa46,"Improve on_disk_cache and fix notebook (#159)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/159

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D33437356

Pulled By: ejguan

fbshipit-source-id: 21ccb7a0d08c230f2faaf5be9ee89798a3c2e8db",Erjia Guan,erjia@fb.com,2022-01-06 17:02:27,"['examples/text/CC100.ipynb', 'torchdata/datapipes/iter/util/cacheholder.py']",True
72e58f970683019eff34e3e0b70856c92fe22dd1,"Renaming IoPathFileLoader to IoPathFileOpener (#151)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/151

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33368186

Pulled By: NivekT

fbshipit-source-id: 8ca5d52f10060934cb593f8dfc3b281cb1cf927f",Kevin Tse,ktse@fb.com,2022-01-05 21:17:44,"['test/test_local_io.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/iopath.py']",True
bf071150c673ab18e087dc8dcb8d27f0c70c60ed,"Switching to use FileOpener instead of FileLoader (#148)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/148

This PR is dependent on https://github.com/pytorch/pytorch/pull/70367, which renames `FileLoader` to `FileOpener` in PyTorch. Core library. Then, this PR switches all `TorchData` usage of `FileLoader` to `FileOpener`, as well as renaming `IoPathFileLoader` to `IoPathFileOpener` (the functional name changes as well). Downstream users of those DataPipes please be aware of that.

Fixes #103.

Reviewed By: ejguan

Differential Revision: D33368187

fbshipit-source-id: aabb545c002c04f1fd305fd64e9982088d6a81a8",Kevin Tse,ktse@fb.com,2022-01-05 21:17:44,"['README.md', 'examples/text/CC100.ipynb', 'examples/text/amazonreviewpolarity.py', 'examples/text/imdb.py', 'examples/text/squad1.py', 'examples/text/squad2.py', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'test/test_local_io.py', 'test/test_remote_io.py', 'torchdata/datapipes/iter/__init__.py']",True
058e9baeed33278f745f8dfb56a31d12a8b1edca,"Fixing test error related to file hash change and warnings related to the usage of lambda function (#157)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/157

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33417107

Pulled By: NivekT

fbshipit-source-id: c68636a110eab1bd544a0f5ce8e5283d7c3d2589",Kevin Tse,ktse@fb.com,2022-01-05 15:15:42,"['test/test_datapipe.py', 'test/test_period.py', 'test/test_remote_io.py']",False
c3ad9c069f2c1fcaf4e0c292559e4c26b54d6e33,"Add auto-formatters as pre-commit hooks (#147)

Summary:
This adds a couple of [`pre-commit` hooks](https://pre-commit.com) for auto-formatting files in the repository. The include mainly [`black`](https://github.com/psf/black) and [`usort`](https://github.com/facebookexperimental/usort) that are run through [`ufmt`](https://ufmt.omnilib.dev/en/stable/) and are fully compatible with Meta internal workflows. In addition, [`flake8`](https://github.com/pycqa/flake8) can also be run through this framework.

To install the hooks `pip install pre-commit first` and afterwards run `pre-commit install` inside the repository. Now, every time you `git commit` something, these hooks will run and make sure the code format is correct. You can also invoke them manually with `pre-commit run`, which will check all staged files.

For now I only included the configuration files. If they are approved, I'll pull the trigger and push all changes that need to be made to the repository to be compatible with the format.

Pull Request resolved: https://github.com/pytorch/data/pull/147

Reviewed By: VitalyFedyunin

Differential Revision: D33404517

Pulled By: ejguan

fbshipit-source-id: 42ccc8c5a83dc6fc1f674323fb6eed4cb383fe74",Philip Meier,github.pmeier@posteo.de,2022-01-05 00:04:17,"['.github/ISSUE_TEMPLATE/bug-report.yml', '.github/ISSUE_TEMPLATE/documentation.yml', '.github/ISSUE_TEMPLATE/feature-request.yml', '.github/PULL_REQUEST_TEMPLATE.md', '.github/workflows/ci.yml', '.github/workflows/lint.yml', '.pre-commit-config.yaml', '.prettierrc.yaml', 'CODE_OF_CONDUCT.md', 'CONTRIBUTING.md', 'LICENSE', 'README.md', 'examples/text/CC100.ipynb', 'examples/text/ag_news.py', 'examples/text/amazonreviewpolarity.py', 'examples/text/imdb.py', 'examples/text/squad1.py', 'examples/text/squad2.py', 'examples/text/utils.py', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'examples/vision/imagefolder.py', 'pyproject.toml', 'setup.py', 'test/_fakedata/README.md', 'test/_utils/_common_utils_for_test.py', 'test/test_datapipe.py', 'test/test_fsspec.py', 'test/test_local_io.py', 'test/test_period.py', 'test/test_remote_io.py', 'torchdata/datapipes/__init__.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/extractor.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/plain_text_reader.py', 'torchdata/datapipes/iter/util/rar_archive_loader.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py', 'torchdata/datapipes/utils/common.py']",False
6b5a959da788626e5531dbb6f7fbb6a590d1c0d7,"drop Python 3.6 (#156)

Summary:
Python 3.6 reached EOL [last month](https://endoflife.date/python). `torchvision` already dropped support for it in pytorch/vision#5152 and there is pytorch/pytorch#69005 to do the same for PyTorch core.

Pull Request resolved: https://github.com/pytorch/data/pull/156

Reviewed By: malfet, VitalyFedyunin

Differential Revision: D33404751

Pulled By: ejguan

fbshipit-source-id: 8cb8ab50307eeac49c85197fdbb46282f5daa7fa",Philip Meier,github.pmeier@posteo.de,2022-01-04 17:31:15,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', 'mypy.ini', 'setup.py']",True
20e7f015cc75a66d076b222bc46ac1d24b066ca8,"Removing TODO as issue has been resolved (#152)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/152

Fixes #128
Fixes #135

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D33370398

Pulled By: NivekT

fbshipit-source-id: 9d86e7869c6136cc1c13955c42f3765c9716774b",Kevin Tse,ktse@fb.com,2022-01-04 16:27:52,['torchdata/datapipes/iter/transform/bucketbatcher.py'],True
3a50e3f4fe0944b4333fcaa8c0601865ccb8d9d4,"Fix circular reference within OnDiskCacheHolder (#154)

Summary:
Fixes https://github.com/pytorch/data/issues/149

### Changes

In previous implementation, following DataPipe would use the function attribute of `OnDiskCacheHolder` instance. This creates circular reference of `OnDiskCacheHolder` then leads to the infinite recursion.

Currently, using a temporary dictionary to hold such functions. And, following DataPipe can retrieve these functions using `OnDiskCacheHolder` instance as the key.

Pull Request resolved: https://github.com/pytorch/data/pull/154

Reviewed By: NivekT

Differential Revision: D33370590

Pulled By: ejguan

fbshipit-source-id: a3ee6a151fd0ab9b5c970f6e703426c8c165c20d",Erjia Guan,erjia@fb.com,2021-12-31 00:22:08,['torchdata/datapipes/iter/util/cacheholder.py'],True
25530cf95878047f23e8f820d0ac5a00d539364f,"fix package exclusion (#143)

Summary:
Fixes https://github.com/pytorch/data/issues/140. I took the liberty to also remove `""build""` and `""third_party""` since they are currently not used by `torchdata`.

Pull Request resolved: https://github.com/pytorch/data/pull/143

Reviewed By: NivekT

Differential Revision: D33160428

Pulled By: ejguan

fbshipit-source-id: 1ce3782ab3797507796cc10fcd6a371af620b837",Philip Meier,github.pmeier@posteo.de,2021-12-16 17:04:14,['setup.py'],True
8ddb04858c64a7f43c00e86db4052ced1b8a9f5e,"temporary fix ShardingFilter import (#142)

Summary:
Without this `import torchdata` fails with the latest `torch` nightly installed.

Pull Request resolved: https://github.com/pytorch/data/pull/142

Reviewed By: NivekT

Differential Revision: D33160424

Pulled By: ejguan

fbshipit-source-id: d82e19b1ca92c5afd9d7fe5771c74f763d4433f6",Philip Meier,github.pmeier@posteo.de,2021-12-16 17:04:14,['torchdata/datapipes/iter/__init__.py'],True
6bad0e5fd400fc502b60f5d3aa7212e28de4363f,"expose ShardingFilter (#139)

Summary:
Blocked by pytorch/pytorch#69844.

Pull Request resolved: https://github.com/pytorch/data/pull/139

Reviewed By: NivekT

Differential Revision: D33069882

Pulled By: ejguan

fbshipit-source-id: 506419fba1239b3593d3971f6dab199e079017e4",Philip Meier,github.pmeier@posteo.de,2021-12-14 19:36:46,['torchdata/datapipes/iter/__init__.py'],False
643a31b174f38acdfffa32a13d7fc04beeb97db7,"Autogenerated issues for TODO lines (#121)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/121

Reviewed By: wenleix

Differential Revision: D33029480

Pulled By: VitalyFedyunin

fbshipit-source-id: df23f62ed24b735ebbe27218d667c1ac7a0c1a75",Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2021-12-13 20:23:15,"['examples/vision/imagefolder.py', 'test/test_datapipe.py', 'test/test_examples.py', 'test/test_local_io.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py']",True
98b6208f8361e853e751b41c2c7a2a499758c96a,"Minor change to Collab installation link (#138)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/138

Reviewed By: ejguan

Differential Revision: D33053366

fbshipit-source-id: 6a441832ed653e4016eb48d4e0cb2fcfc10921be",Wenlei Xie,wxie@fb.com,2021-12-13 17:12:18,['README.md'],True
f102d25f9f444de3380c6d49bf7aaf52c213bb1f,"torchdata/datapipes/iter/load/fsspec: added fsspec datapipes (#116)

Summary:
This adds fsspec datapipes that are equivalent to the existing iopath ones. The tests are largely equivalent and test the `file://` and `memory://` filesystems to ensure compatibility.

Closes https://github.com/pytorch/data/issues/114

Pull Request resolved: https://github.com/pytorch/data/pull/116

Test Plan: pytest tests/test_fsspec.py

Reviewed By: ejguan

Differential Revision: D32933676

Pulled By: d4l3k

fbshipit-source-id: 30a0b9da385f5d9328d07105234a92d7259ae05d",Tristan Rice,rice@fn.lc,2021-12-10 03:31:22,"['.github/workflows/ci.yml', 'mypy.ini', 'test/test_fsspec.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/fsspec.py']",True
6309113c68c1334bd3e352beba0557ddb71f7ce2,"Replace issue templates with new issue forms (#115)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/115

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D32883988

Pulled By: NivekT

fbshipit-source-id: b8d289142bc8048266ad494dfce40ce1008308e4",Kevin Tse,ktse@fb.com,2021-12-07 15:16:18,"['.github/ISSUE_TEMPLATE/bug-report.md', '.github/ISSUE_TEMPLATE/bug-report.yml', '.github/ISSUE_TEMPLATE/config.yml', '.github/ISSUE_TEMPLATE/documentation.yml', '.github/ISSUE_TEMPLATE/feature-request.md', '.github/ISSUE_TEMPLATE/feature-request.yml', '.github/ISSUE_TEMPLATE/questions-help-support.md']",True
8075b0ba3813bc374fdf241720ccac1abf874f87,"add RarArchiveReader (#41)

Summary:
This works as expected, but will be harder to test than the other archive readers. The problem is that since the `rarfile` package can only read rar archives but not write them, we cannot generate the test data at runtime. One option would be to put fixed data in say `test/assets/test_rar.rar` and use this.

Pull Request resolved: https://github.com/pytorch/data/pull/41

Reviewed By: NivekT

Differential Revision: D32831804

Pulled By: ejguan

fbshipit-source-id: fc8bc488be9f829b648e89f978d2b811194ec5d4",Philip Meier,github.pmeier@posteo.de,2021-12-03 21:38:32,"['.github/workflows/ci.yml', 'mypy.ini', 'test/test_local_io.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/rar_archive_loader.py']",False
c0103a2c9655e683b145bbcb410b9c1716a5e89b,"Bump version to 0.3.0 (#111)

Summary:
Per title

Pull Request resolved: https://github.com/pytorch/data/pull/111

Reviewed By: NivekT

Differential Revision: D32808734

Pulled By: ejguan

fbshipit-source-id: 27fb43ba3b246086489c83c0e478e19da0385aba",Erjia Guan,erjia@fb.com,2021-12-02 21:19:36,['setup.py'],False
58ec0c405ada6e4603ac1365d7ca343c18fe59b2,"Closing streams for DataPipe that doesn't yield stream (#93)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/93

Fixes #86

The goal of this change is to close opened streams within `DataPipes` that read from streams but do not yield streams. #86 describes the issue in more details.

Aside from these ones, I don't believe any other `IterDataPipes` require this change.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D32152883

Pulled By: NivekT

fbshipit-source-id: 100837d27cdf2ddb8f75b5d86f9b133dbb10073a",Kevin Tse,ktse@fb.com,2021-12-02 15:38:13,"['torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/plain_text_reader.py']",False
9096c953c38af99938c6555f7915244043f35222,"add pycocotools to torchvision CI requirements (#110)

Summary:
This is now a dependency to run the `torchvision` prototype tests. We are refactoring how dependencies are installed, so something like this should not happen anymore in the future.

Pull Request resolved: https://github.com/pytorch/data/pull/110

Reviewed By: NivekT

Differential Revision: D32772216

Pulled By: ejguan

fbshipit-source-id: 4d572213a3acb138d85341c71d2205992da66269",Philip Meier,github.pmeier@posteo.de,2021-12-01 23:54:49,['.github/workflows/domain_ci.yml'],False
2d94ebc6e95d4bd475a98e947781e58410386a10,"Refactor OnDiskCache (#61)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/61

Fixes https://github.com/facebookexternal/torchdata/issues/114 and https://github.com/facebookexternal/torchdata/issues/140

* #59

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D31734382

Pulled By: ejguan

fbshipit-source-id: 16d10bace2a473e3878ac8dd5f7b6885bd924105",Erjia Guan,erjia@fb.com,2021-11-22 21:41:00,"['examples/text/amazonreviewpolarity.py', 'examples/text/imdb.py', 'examples/text/squad1.py', 'examples/text/squad2.py', 'test/_utils/_common_utils_for_test.py', 'test/test_examples.py', 'test/test_remote_io.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/utils/common.py']",False
673d3b210d16367fc944afed30971bf76c26e9e5,"Adding 'Key' to Zipper DataPipe Class Names (#107)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/107

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D32360806

Pulled By: NivekT

fbshipit-source-id: 11a1b5d644054e3b8539d9c0d28f3ba254426bfb",Kevin Tse,ktse@fb.com,2021-11-12 18:03:51,"['torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/combining.py']",True
47bfeaa5f467b1299fc000034843bfc15d051f1c,"Add IoPathSaver and unify the mode for Saver (#105)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/105

Fixes #91

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D32317606

Pulled By: ejguan

fbshipit-source-id: e479f1809c678998b0e5d8067d4978ce3a4dce13",Erjia Guan,erjia@fb.com,2021-11-12 17:16:46,"['test/test_local_io.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/util/saver.py']",True
2ed8e3898abb0809f2d3cb4aa5147af2c9efc8ec,"Refactor IoPath FileLister and FileLoader (#104)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/104

Fixes #52

This PR is going to add all existing PathHandlers from iopath to make sure it can handle the following data sources:
- Local File Path
- HTTP Url
- OneDrive Url
- S3 Url (iopath 0.1.9)

Before this PR, these two DataPipes only work with NativePathHandler, which would handle the local file.

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D32317605

Pulled By: ejguan

fbshipit-source-id: af5dc07f6c6ee73c13bfdfca76330ba34305f35f",Erjia Guan,erjia@fb.com,2021-11-12 17:16:46,"['.flake8', '.github/workflows/ci.yml', 'test/test_local_io.py', 'torchdata/datapipes/iter/load/iopath.py']",True
b0dece34d4df2035e0186a49ebc46d706ebc18ed,"fix IoPathFileLoader in conjunction with buffered datapipes (#97)

Summary:
If we keep the context manager, the file will be closed as soon as we hit the first `StopIteration`. This happens for example if a datapipe is loaded completely into a buffer.

Pull Request resolved: https://github.com/pytorch/data/pull/97

Reviewed By: VitalyFedyunin, NivekT

Differential Revision: D32205272

Pulled By: ejguan

fbshipit-source-id: 7bb2ee9bdc698228e2b461f365d2f8c22a713962",Philip Meier,github.pmeier@posteo.de,2021-11-10 16:14:14,"['test/test_local_io.py', 'torchdata/datapipes/iter/load/iopath.py']",True
3f2fee6e2dea07fd4f262c156ff52bdf9cb639fb,"Refactoring and renaming to KeyZipper to IterKeyZipper and MapZipper to MapKeyZipper (#50)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/50

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31487393

Pulled By: NivekT

fbshipit-source-id: 80fbd6e837ff0b82f5c5a4087d9e3a8cbf88fe7b",Kevin Tse,ktse@fb.com,2021-11-09 15:53:55,"['examples/vision/caltech101.py', 'test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/combining.py']",False
6d0c6207d574ac8ae6cd5d26858648108b486ef8,"Switching to CUDA 11.3 (#100)

Summary:
### Changes

  - Update readme to switch from CUDA 11.1 to 11.3

Pull Request resolved: https://github.com/pytorch/data/pull/100

Reviewed By: ejguan

Differential Revision: D32246445

Pulled By: datumbox

fbshipit-source-id: d973a3da2c3d624ad3bc28d61a06c2a9d7fb679b",Vasilis Vryniotis,vvryniotis@fb.com,2021-11-09 09:16:36,['README.md'],True
81b25e8ba2a83c8238409de21ffab6c41a9432e3,"Fix bug for GDriveReader (#99)

Summary:
`self.source_datapip` -> `self.source_datapipe`

Pull Request resolved: https://github.com/pytorch/data/pull/99

Reviewed By: NivekT

Differential Revision: D32218481

Pulled By: ejguan

fbshipit-source-id: 05bd14a01911eb56b97a7f1098e1771fd6cdc5e9",Erjia Guan,erjia@fb.com,2021-11-07 19:14:09,"['examples/text/amazonreviewpolarity.py', 'torchdata/datapipes/iter/load/online.py']",True
ac54cae8bfa171fae3f43577040e7a66f0975ec5,"Improve ci (#98)

Summary:
- Remove `mypy` for tests
- Add `3.8`
- Remove requirements

Pull Request resolved: https://github.com/pytorch/data/pull/98

Reviewed By: NivekT

Differential Revision: D32212697

Pulled By: ejguan

fbshipit-source-id: fcbaf0d0175be25646a77ec53cfa2eb0e3a2d65a",Erjia Guan,erjia@fb.com,2021-11-05 20:27:04,"['.github/workflows/ci.yml', 'mypy.ini', 'requirements.txt']",True
012d8f279e313e4b21a387cc9bf10449ce7b3f4e,"Improve torchvision ci (#96)

Summary:
Addresses https://github.com/pytorch/data/issues/69 for `torchvision`. Note that the workflow will fail for another ~24 hours, since pytorch/vision#4682 will only then be included in the nightly release.

Pull Request resolved: https://github.com/pytorch/data/pull/96

Reviewed By: wenleix

Differential Revision: D32171429

Pulled By: ejguan

fbshipit-source-id: 3b5cd0a56bbcc86672a62d047e4491a433811d6a",Philip Meier,github.pmeier@posteo.de,2021-11-05 16:46:48,['.github/workflows/domain_ci.yml'],True
4802a350d1bf954d0785e0f22fd1fcde2deded76,"Adding annotations to IterDataPipes (#89)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/89

Remaking due to an issue with `ghstack`. For detailed discussions, see #78

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31964867

Pulled By: NivekT

fbshipit-source-id: 80ac0a8811e4cfb8880d0d60548dd2166e69d1e3",Kevin Tse,ktse@fb.com,2021-10-27 21:09:24,"['test/test_datapipe.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/plain_text_reader.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py']",True
74530e8d4bd27169d7d5b861609525e0142a8010,"Use StreamWrapper for iopath, online readers, and hash checker IterDataPipes (#88)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/88

Remaking due to an issue with `ghstack`. For detailed discussions, see #87

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31964866

Pulled By: NivekT

fbshipit-source-id: 94e0a01e01fdc9e2b55cb5661357053afdef47c3",Kevin Tse,ktse@fb.com,2021-10-27 21:09:24,"['torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/util/hashchecker.py']",True
ab4a956cbd998278f13eb9471d01f1d98cb00b5e,"Adding ExtractorIterDataPipe (#84)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/84

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31867738

Pulled By: NivekT

fbshipit-source-id: 54d2858676cda9128a27c3dc49b0dd48ab1a5b89",Kevin Tse,ktse@fb.com,2021-10-27 15:11:08,"['test/test_local_io.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/extractor.py']",True
cad3cfe653b716b43e45f5954b3709375d92f06b,"Fixed CI run on windows (#83)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/83

Fixed the environment variable to be set in a right way.

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D31869171

Pulled By: ejguan

fbshipit-source-id: cd27eb57d23d3da2b75857baef7d15acd4ec64d5",Erjia Guan,erjia@fb.com,2021-10-26 20:45:47,['.github/workflows/ci.yml'],True
542d8c5c7d5f9a1fbb3b44541d3aec89b2a1bb66,"Moving MapZipper test to correct location (#85)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/85

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31869766

Pulled By: NivekT

fbshipit-source-id: c220f7a4a56df3e655154bc8b3bc99ee6694aaa2",Kevin Tse,ktse@fb.com,2021-10-25 13:55:14,"['test/test_datapipe.py', 'test/test_local_io.py']",True
0778c000de61cb741ab7f9e530af1130b6c7e26a,"Adding EnumeratorIterDataPipe (#79)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/79

This is adding a new DataPipe as mentioned in #46

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31863337

Pulled By: NivekT

fbshipit-source-id: 454ea6e47d4e2950d1700110278ef125490bf729",Kevin Tse,ktse@fb.com,2021-10-22 21:23:16,"['test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/indexadder.py']",True
78c47be7468771682a79102af52f756fb7564857,"CI Improvement (#70)

Summary:
- Add CI matrix for different python versions/machines to validate the behavior is consistent
- Change CI only run on `pytorch/data` not any forked repo
- Remove vision tests since TorchVision tests have been referenced.

Pull Request resolved: https://github.com/pytorch/data/pull/70

Reviewed By: NivekT

Differential Revision: D31839999

Pulled By: ejguan

fbshipit-source-id: 06e6c78cf9e520aaf0c927e8d7206103214b3ade",Erjia Guan,erjia@fb.com,2021-10-22 15:53:09,"['.github/workflows/ci.yml', '.github/workflows/domain_ci.yml', '.github/workflows/lint.yml', 'test/test_examples.py']",True
72a52f3dc28a1f8679039eb0d31a91474d80d870,"Adding merge function as an optional input for KeyZipper (#76)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/76

Fixes #44 by adding merge function as an optional input for `KeyZipper`. It allows user to specify how the items yielded from the DataPipes will be combined before they are yielded.

This PR changes the default behavior when `keep_key=True` and that may be BC breaking.
Previously, when `keep_key=True`, the output will be `(key, item1, item2)`, now it will default to `(key, (item1, item2)`. It is possible to leave the default behavior unchanged.

Note that `KeyZipper` may be renamed to `IterZipper` in #50 to provide users with better clarity.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31820203

Pulled By: NivekT

fbshipit-source-id: 670941e03595f0b0013c1162cfe1c22ec3ce6064",Kevin Tse,ktse@fb.com,2021-10-22 14:44:30,"['test/test_datapipe.py', 'torchdata/datapipes/iter/util/combining.py']",True
5764128277d8e6417bbf5631529142245e6beed9,"Remove unused LineReader (#77)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/77

The new one that is being use exists in `plain_test_reader.py`

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31845619

Pulled By: NivekT

fbshipit-source-id: b96556569e797fea1a48b17b54581bfa9db37153",Kevin Tse,ktse@fb.com,2021-10-22 14:27:16,['torchdata/datapipes/iter/util/linereader.py'],True
56e28cd3c7a67dfe82c41bd300f886ead830ef42,"Add label to trigger slow tests (#74)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/74

Fixes #33

* #72

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D31797764

Pulled By: ejguan

fbshipit-source-id: b13a834e48e34b7f87aa522edbf0dddf5c2dfdcb",Erjia Guan,erjia@fb.com,2021-10-21 16:57:20,"['.github/workflows/ci.yml', 'test/test_period.py', 'test/test_remote_io.py']",True
d28a139cd99f2a50d41354ba738bd4b15eaccaec,"Fix ArchiveReader to keep archive path (#73)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/73

Previous implementation of `ArchiveReader` has a bug. Please take a reference from https://github.com/pytorch/pytorch/pull/65424#issuecomment-945479647

Reviewed By: NivekT

Differential Revision: D31797765

fbshipit-source-id: 494e1a49b43d5a846de971a67586089e6d7ebafc",Erjia Guan,erjia@fb.com,2021-10-20 23:51:12,"['examples/text/amazonreviewpolarity.py', 'examples/text/sst2.py', 'test/test_examples.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py']",True
289463662035a2b64951fdee74f00d94d5b617e9,"Fix TorchText examples (#72)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/72

There is a bug that `HTTPResponse` doesn't have correct `read` method. We need to use `__iter__` to get data. Then, the bytes are also needed to be decoded as string.

Reviewed By: NivekT

Differential Revision: D31797766

fbshipit-source-id: 1d7f462b68ab0666a127f9b58c5d9ff51031c044",Erjia Guan,erjia@fb.com,2021-10-20 23:51:12,"['examples/text/squad1.py', 'examples/text/squad2.py']",True
4e48de45c28159054589eb017d2e9445e079b0bf,"add CI job to run torchvision tests that use datapipes (#71)

Summary:
As discussed in our last sync, this adds a CI workflow to run `torchvision` tests that use `torchdata` against each PR. This ensures that changes in `torchdata` don't break `torchvision` or at least we can get notified about them.

cc fmassa

Pull Request resolved: https://github.com/pytorch/data/pull/71

Reviewed By: NivekT

Differential Revision: D31794842

Pulled By: ejguan

fbshipit-source-id: 4ac3311911d2e92a73c9ece58d637d236dee35ea",Philip Meier,github.pmeier@posteo.de,2021-10-20 15:05:54,['.github/workflows/ci.yml'],True
be239dca44e135e1bb01222f76010c595f976145,"Fix a bug for hashchecker (#65)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/65

Test Plan: Imported from OSS

Reviewed By: VitalyFedyunin

Differential Revision: D31734383

Pulled By: ejguan

fbshipit-source-id: b70ac80eb86869e280aa51ca3a9a6b49e3f1dd2e",Erjia Guan,erjia@fb.com,2021-10-19 04:23:20,"['test/test_remote_io.py', 'torchdata/datapipes/iter/util/hashchecker.py']",False
56119fe31fb26a15517eccbe450a94ce290382c6,"Some types for data_preproc and pytorch/data (#66)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/66

Fix some easy types with find+replace

Reviewed By: NivekT

Differential Revision: D31708213

fbshipit-source-id: 0eda12e53f82b17eb873094725952ef9deacf991",Richard Barnes,rbarnes@fb.com,2021-10-18 21:02:24,"['README.md', 'examples/text/squad1.py', 'examples/text/squad2.py', 'examples/vision/imagefolder.py', 'test/_utils/_common_utils_for_test.py', 'test/test_datapipe.py', 'test/test_examples.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/linereader.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py']",False
f3c4c0b8a8f0ba7ae62dd0b9254717945cdf2822,"Refactor tempdir/temfiles helper function (#60)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/60

Test Plan: Imported from OSS

Reviewed By: wenleix

Differential Revision: D31734384

Pulled By: ejguan

fbshipit-source-id: a4996c924317f75303f9e473c284cb33f93d780d",Erjia Guan,erjia@fb.com,2021-10-18 19:27:03,"['test/_utils/_common_utils_for_test.py', 'test/test_local_io.py', 'test/test_remote_io.py']",False
5d1a2f576bdc8575889b39401ba5a3404a872ded,"Import StreamWrapper to exist within the module (#68)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/68

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31731048

Pulled By: NivekT

fbshipit-source-id: f1ae09cc272c93875561f402a1efbb233fb654b6",Kevin Tse,ktse@fb.com,2021-10-18 18:45:51,"['torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py', 'torchdata/datapipes/utils/__init__.py', 'torchdata/datapipes/utils/common.py']",False
896d7ea2659cc7fc685d275b046c13b04a09b18b,"Fakedata (#67)

Summary:
Replace https://github.com/pytorch/data/pull/59 because `ghimport` doesn't work with binary files.

Pull Request resolved: https://github.com/pytorch/data/pull/67

Reviewed By: NivekT

Differential Revision: D31730182

Pulled By: ejguan

fbshipit-source-id: 8168d3eec8129befb63cfc7ff88a14e837f86155",Erjia Guan,erjia@fb.com,2021-10-18 16:24:03,"['test/_fakedata/README.md', 'test/_fakedata/_create_fake_data.py', 'test/_fakedata/bytes.tar', 'test/_fakedata/bytes.tar.gz', 'test/_fakedata/bytes/0.bt', 'test/_fakedata/bytes/1.bt', 'test/_fakedata/bytes/2.bt', 'test/_fakedata/csv.tar', 'test/_fakedata/csv.tar.gz', 'test/_fakedata/csv/0.csv', 'test/_fakedata/csv/1.csv', 'test/_fakedata/csv/2.csv', 'test/_fakedata/json.tar', 'test/_fakedata/json.tar.gz', 'test/_fakedata/json/0.json', 'test/_fakedata/json/1.json', 'test/_fakedata/json/2.json', 'test/_fakedata/txt.tar', 'test/_fakedata/txt.tar.gz', 'test/_fakedata/txt/0.txt', 'test/_fakedata/txt/1.txt', 'test/_fakedata/txt/2.txt', 'test/test_datapipe.py', 'test/test_local_io.py', 'test/test_remote_io.py']",False
db216c1b444ada168bf920de011c2b77fc00d60b,"Adding StreamWrapper to ensure file object will be closed (#66715)

Summary:
Pull Request resolved: https://github.com/pytorch/pytorch/pull/66715

Adding StreamWrapper to streams produced by DataPipes within PyTorch Core and TorchData

Reviewed By: ejguan

Differential Revision: D31695248

fbshipit-source-id: c26fa1bc1688d5597851ad265f667fafdcd64c59",Kevin Tse,ktse@fb.com,2021-10-18 14:29:40,"['torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py', 'torchdata/datapipes/utils/common.py']",False
730b8bce9d1b5bd6333c330a603499600021c0b1,"Run ci with PR created by ghstack (#63)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/63

Fixes #62

Tests have been carried on on CI successfully.

Test Plan: Imported from OSS

Reviewed By: NivekT

Differential Revision: D31674237

Pulled By: ejguan

fbshipit-source-id: 530d4d7b94e689146eb776ba79975649ad21b5e1",Erjia Guan,erjia@fb.com,2021-10-15 14:16:21,['.github/workflows/ci.yml'],True
cbd19f01fe92b7039583ea9fff29df2c6a898a9c,"Cleaning unused codes from common.py (#57)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/57

These code snippets were copied over from Core and used by `FileLoader` in Core. Since there is no plan to move that DataPipe to this repo. These code snippets can be removed.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31659772

Pulled By: NivekT

fbshipit-source-id: 36b20b815d3ddaac937691392ad508cca713e91a",Kevin Tse,ktse@fb.com,2021-10-14 22:01:20,['torchdata/datapipes/utils/common.py'],True
77724065d8c3b0c269dafd1e01efbf94af6796f8,"Remove duplicated CSVReader (#53)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/53

Fixes #43.

#29 has landed so the content in this file has become duplicate and is no longer needed.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31552790

Pulled By: NivekT

fbshipit-source-id: c1b6735fb4b81aa306a9b7a0780eacd24e9ca595",Kevin Tse,ktse@fb.com,2021-10-12 17:22:27,['torchdata/datapipes/iter/util/csvparser.py'],True
c8b77731228923cee7d428d56610164e4a6fe464,"Adding MapZipperIterDataPipe (#49)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/49

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31450886

Pulled By: NivekT

fbshipit-source-id: 5ff144d48a08c720eb6343d2a096fdc0835e4ca8",Kevin Tse,ktse@fb.com,2021-10-11 18:07:03,"['test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/combining.py']",True
aa93f483e2191ddcc76276fcbed1a17dff502d39,"Change HTTPReader to use requests module and enable streaming, minor change to test case (#51)

Summary:
Pull Request resolved: https://github.com/pytorch/data/pull/51

Fixes #42. I plan to add more test in #40 that will test online readers in connection to the various archive readers.

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31515974

Pulled By: NivekT

fbshipit-source-id: 065261aeac5863971d94c4949ed0e6b5df201fa7",Kevin Tse,ktse@fb.com,2021-10-11 17:16:25,"['test/test_datapipe.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/utils/common.py']",True
44f2f8e1ac83f4e70d9e7d03931198edb5c5a223,"adding pull request and issue templates (#48)

Summary:
Stack from [ghstack](https://github.com/ezyang/ghstack):
* __->__ https://github.com/pytorch/data/issues/48

Pull Request resolved: https://github.com/pytorch/data/pull/48

Reviewed By: ejguan

Differential Revision: D31445329

Pulled By: NivekT

fbshipit-source-id: 9837d9a30ee6dcdf2c849e2842d3f569eba4a144",Kevin Tse,NivekT@users.noreply.github.com,2021-10-07 00:44:58,"['.github/ISSUE_TEMPLATE/bug-report.md', '.github/ISSUE_TEMPLATE/feature-request.md', '.github/ISSUE_TEMPLATE/questions-help-support.md', '.github/PULL_REQUEST_TEMPLATE.md']",True
58798a47d8acc75c5d68f1785d789b3e6d94ff26,"Adds skipIfNoPillow decorator (#47)

Summary:
Resolves https://github.com/pytorch/data/issues/13.

Pull Request resolved: https://github.com/pytorch/data/pull/47

Reviewed By: NivekT

Differential Revision: D31434337

Pulled By: ejguan

fbshipit-source-id: 78f59096aff97d2720ce77ac77f886a32998e280",Alex Gregory,alex.gregory1@outlook.com,2021-10-06 18:15:46,['test/test_examples.py'],True
e6044b2ba289832de5ff78214f6202c549bba893,"Make flake8 configuration more strict (#39)

Summary:
Fixes https://github.com/pytorch/data/issues/17

This is mainly used to prevent flake8 error when importing to internal codebase.

Pull Request resolved: https://github.com/pytorch/data/pull/39

Reviewed By: NivekT

Differential Revision: D31392355

Pulled By: ejguan

fbshipit-source-id: 51a3fb82424a5f9bc7566355d21f0100ee875c75",Erjia Guan,erjia@fb.com,2021-10-05 17:40:29,"['.flake8', 'examples/.exists', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'examples/vision/imagefolder.py', 'test/test_examples.py', 'torchdata/datapipes/iter/util/rows2columnar.py']",True
85d8bbe235cd58f270c17367a5577de107b0095f,"Cleaning up comments and unused arguments in setup.py (#37)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/37

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31381731

Pulled By: NivekT

fbshipit-source-id: 31bb2d351f270ce8c8209ac8dbe2b518121b9076",Kevin Tse,ktse@fb.com,2021-10-05 15:27:56,['setup.py'],True
700b6a3b032491dea2608f2df1d59517591439ce,"Make CI test in verbose mode (#38)

Summary:
Have all test name printed.

![image](https://user-images.githubusercontent.com/68879799/135896027-588dc0ce-dfd7-4597-828f-c09114d9a5d0.png)

Pull Request resolved: https://github.com/pytorch/data/pull/38

Reviewed By: NivekT

Differential Revision: D31392353

Pulled By: ejguan

fbshipit-source-id: 5a6e6981dbd7a2e6754c99c92daf0ad8431380be",Erjia Guan,erjia@fb.com,2021-10-05 15:26:44,['.github/workflows/ci.yml'],True
0d6d0c0fff9bc43f570691acb5de9d042872b718,"unify plain text readers (#29)

Summary:
Fixes https://github.com/pytorch/data/issues/28.

Pull Request resolved: https://github.com/pytorch/data/pull/29

Reviewed By: wenleix

Differential Revision: D31345647

Pulled By: ejguan

fbshipit-source-id: da3fba34473cb59f5b7afc68e5b3c3ab5df8888a",Philip Meier,github.pmeier@posteo.de,2021-10-05 13:53:01,"['examples/text/sst2.py', 'test/test_datapipe.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/util/plain_text_reader.py']",True
c45dffc6ff763f45a2b949d1e7a65f8ce4318945,"expose native PyTorch datapipes (#31)

Summary:
Closes https://github.com/pytorch/data/issues/27. The following datapipes are exposed by both projects:

- `TarArchiveReader`
- `ZipArchiveReader`
- `IterableWrapper`
- `HttpReader`
- `LineReader`
- `BucketBatcher`

Pull Request resolved: https://github.com/pytorch/data/pull/31

Reviewed By: wenleix, NivekT

Differential Revision: D31340912

Pulled By: ejguan

fbshipit-source-id: a0cbf386c367d70be2667c68754fddfe98967e82",Philip Meier,github.pmeier@posteo.de,2021-10-01 21:26:31,"['examples/text/CC100.ipynb', 'examples/text/squad1.py', 'examples/text/squad2.py', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'examples/vision/imagefolder.py', 'test/_utils/_common_utils_for_test.py', 'test/test_datapipe.py', 'torchdata/datapipes/__init__.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/csvparser.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/linereader.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py']",True
9d95aa63ba2d65befc73cea6e4a6aeba76bc2beb,"Added tests for IoPathFileLister and IoPathFileLoader (#32)

Summary:
- Added unit tests for `IoPathFileLister` and `IoPathFileLoader`
- Added decorator to skip tests if `iopath` is not installed
- Note that tests need to be modified once data can be hosted on online storage systems (gdrive/s3/onedrive)

Pull Request resolved: https://github.com/pytorch/data/pull/32

Reviewed By: ejguan

Differential Revision: D31340051

Pulled By: Nayef211

fbshipit-source-id: 933c2611a180a20e3832eec13b48a1095e8873d6",nayef211,n63ahmed@edu.uwaterloo.ca,2021-10-01 15:57:33,['test/test_datapipe.py'],True
66b7ac07f75c45f1cc6aed71423fdb5d29a9648f,"Add tests specific dependencies to CI (#30)

Summary:
Add
- Pillow
- Scipy
- iopath -> For https://github.com/facebookexternal/torchdata/pull/182

Pull Request resolved: https://github.com/pytorch/data/pull/30

Reviewed By: NivekT

Differential Revision: D31338970

Pulled By: ejguan

fbshipit-source-id: d7e826ce845c4d3747d0e7e0d7c267ef95034857",Erjia Guan,erjia@fb.com,2021-10-01 14:46:12,['.github/workflows/ci.yml'],True
77c07bffb83516fe11eaa425d1d1bb3b5a731174,"Fixes an issue where TarArchiveReader closes stream when read into a buffer (#24)

Summary: Pull Request resolved: https://github.com/pytorch/data/pull/24

Test Plan: Imported from OSS

Reviewed By: ejguan

Differential Revision: D31296100

Pulled By: NivekT

fbshipit-source-id: c200a8761c20259103d2a70ffe42f62229f6832c",Kevin Tse,ktse@fb.com,2021-09-30 14:40:29,['torchdata/datapipes/iter/util/tararchivereader.py'],True
bc9903a3ae1fd44e00c333e73e17f61dd7b3a6ff,"Update README.md (#25)

Summary:
typo ""nighly"" to ""nightly""

Pull Request resolved: https://github.com/pytorch/data/pull/25

Reviewed By: dongreenberg

Differential Revision: D31306065

Pulled By: ejguan

fbshipit-source-id: a1fc59fedae4faef84359bb8717ba4298ec4124d",Woo Kim,80921489+woo-kim@users.noreply.github.com,2021-09-30 14:28:15,['README.md'],True
97c05d868f1e6d9350df728d5527bbf0cb962a76,"Setup ShipIt

fbshipit-source-id: b4f3c58a4685f0b55445b415b7d0b5419de28580",erjia,erjia@fb.com,2021-09-29 16:26:59,[],True
97cabe15588d322b23f8a2989a40c78c20e54dde,"Make test_JSON_parser reads files in a consistent order

[ghstack-poisoned]",Kevin Tse,ktse@fb.com,2021-09-28 23:09:09,['test/test_datapipe.py'],True
8a917b82d32ffaebe6ebc1345884167a00fed8d4,"Change test_datapipe to run with unittest.main()

[ghstack-poisoned]",Kevin Tse,ktse@fb.com,2021-09-28 23:09:07,['test/test_datapipe.py'],True
2fd07f8907c984aaddb0a43b5b8ef050d0de781b,make pytorch version detection more robust,Philip Meier,github.pmeier@posteo.de,2021-09-29 12:05:41,['setup.py'],True
116443308b60409084ad8f97e10ced082efb9123,Convert ListDirFiles to FileLister,erjia,erjia@fb.com,2021-09-28 16:45:35,['examples/vision/imagefolder.py'],True
f83b8a112c94a9b3711ac82f58ac712f68923b92,Fix internal Lint,erjia,erjia@fb.com,2021-09-27 19:21:03,"['CODE_OF_CONDUCT.md', 'CONTRIBUTING.md', 'README.md', 'examples/text/imdb.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/utils/common.py']",True
8cee8bc0803a547662fca60c71869021acb6dfb4,"Merge pull request #11 from pytorch/ConnectionTest

adding tests that require file downloads and @slowTest",Kevin Tse,NivekT@users.noreply.github.com,2021-09-27 19:09:59,"['test/test_datapipe.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/linereader.py']",True
5088ea6ec62f31ff7fbd199f4f1554d786a4a1da,Finalize install instructions and colab,Donny Greenberg,dongreenberg2@gmail.com,2021-09-27 18:40:06,['README.md'],True
e2ec0178de4dee36d90a35ce194e7b8338b8abd3,adding slowTest for tests that require file downloads,Kevin Tse,ktse@fb.com,2021-09-23 22:08:28,"['test/test_datapipe.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/linereader.py']",True
5210201ff970e9af60af9c5fc3bf5ff23b7f6017,A new start,Vitaly Fedyunin,vitaly.fedyunin@gmail.com,2021-09-27 15:39:56,"['.flake8', '.github/workflows/ci.yml', '.github/workflows/lint.yml', '.gitignore', 'CODE_OF_CONDUCT.md', 'CONTRIBUTING.md', 'LICENSE', 'README.md', 'examples/.exists', 'examples/__init__.py', 'examples/text/CC100.ipynb', 'examples/text/ag_news.py', 'examples/text/amazonreviewpolarity.py', 'examples/text/examples_usage.ipynb', 'examples/text/imdb.py', 'examples/text/squad1.py', 'examples/text/squad2.py', 'examples/text/sst2.py', 'examples/text/utils.py', 'examples/vision/__init__.py', 'examples/vision/caltech101.py', 'examples/vision/caltech256.py', 'examples/vision/fakedata/caltech101/101_ObjectCategories.tar.gz', 'examples/vision/fakedata/caltech101/Annotations.tar', 'examples/vision/fakedata/caltech256/256_ObjectCategories.tar', 'examples/vision/fakedata/imagefolder/cat/1.jpg', 'examples/vision/fakedata/imagefolder/cat/2.jpg', 'examples/vision/fakedata/imagefolder/cat/3.jpg', 'examples/vision/fakedata/imagefolder/dog/1.jpg', 'examples/vision/fakedata/imagefolder/dog/2.jpg', 'examples/vision/fakedata/imagefolder/dog/3.jpg', 'examples/vision/imagefolder.py', 'mypy.ini', 'requirements.txt', 'setup.py', 'test/_utils/__init__.py', 'test/_utils/_common_utils_for_test.py', 'test/test_datapipe.py', 'test/test_examples.py', 'torchdata/__init__.py', 'torchdata/datapipes/__init__.py', 'torchdata/datapipes/iter/__init__.py', 'torchdata/datapipes/iter/load/.exists', 'torchdata/datapipes/iter/load/__init__.py', 'torchdata/datapipes/iter/load/iopath.py', 'torchdata/datapipes/iter/load/online.py', 'torchdata/datapipes/iter/transform/.exists', 'torchdata/datapipes/iter/transform/__init__.py', 'torchdata/datapipes/iter/transform/bucketbatcher.py', 'torchdata/datapipes/iter/util/__init__.py', 'torchdata/datapipes/iter/util/cacheholder.py', 'torchdata/datapipes/iter/util/combining.py', 'torchdata/datapipes/iter/util/csvparser.py', 'torchdata/datapipes/iter/util/cycler.py', 'torchdata/datapipes/iter/util/hashchecker.py', 'torchdata/datapipes/iter/util/header.py', 'torchdata/datapipes/iter/util/indexadder.py', 'torchdata/datapipes/iter/util/jsonparser.py', 'torchdata/datapipes/iter/util/linereader.py', 'torchdata/datapipes/iter/util/paragraphaggregator.py', 'torchdata/datapipes/iter/util/rows2columnar.py', 'torchdata/datapipes/iter/util/samplemultiplexer.py', 'torchdata/datapipes/iter/util/saver.py', 'torchdata/datapipes/iter/util/tararchivereader.py', 'torchdata/datapipes/iter/util/xzfilereader.py', 'torchdata/datapipes/iter/util/ziparchivereader.py', 'torchdata/datapipes/map/__init__.py', 'torchdata/datapipes/map/load/.exists', 'torchdata/datapipes/map/load/__init__.py', 'torchdata/datapipes/map/load/transform.py', 'torchdata/datapipes/map/transform/.exists', 'torchdata/datapipes/map/transform/__init__.py', 'torchdata/datapipes/utils/__init__.py', 'torchdata/datapipes/utils/common.py']",True
